"use strict";const getGlobalThis=function(){if("undefined"!=typeof globalThis)return globalThis;if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==this)return this;throw new Error("Unable to locate global `this`")},globalObject=getGlobalThis();var loader;!function(v){let S=0;const A=[],E=[],R={baseUrl:""},O={};function c(v,A,E){let R=null,z={},B=null;"function"==typeof v?z=v:"string"==typeof v?(R=v,"function"==typeof A?z=A:A instanceof Array&&(B=A,z=E)):v instanceof Array&&(B=v,"function"==typeof A&&(z=A)),B=B||["require","exports","module"],null===R&&(R="unnamed-module-"+S++),R=g(R),B=(B||[]).map((v=>function(v,S){return v?b(S,v):S}(R,v))),O[R]||(O[R]={name:R,parent:null,dclamd:1,dependencies:B,handlers:[],exports:{},dependants:new Set}),O[R].dependencies=B,p(B,(function(v){const S=O[R];if(!S)throw new Error("Could not access registered module "+R);let A=S.exports;A="function"==typeof z?z.apply(globalObject,v)||A:z,S.exports=A,d(R)}),(v=>{if("function"!=typeof onerror)throw v;onerror(v)}),R)}function d(v){const S=O[v];if(!S)throw new Error("Could not access registered module "+v);S.dclamd=2;const A=S.handlers;if(A&&A.length)for(let S=0;S<A.length;S++)A[S](O[v])}function u(v,S,A){if(!O[v])return null;if(v===S||50===A)return[v];const E=O[v].dependencies;for(let R=0,O=E.length;R<O;R++){const O=u(E[R],S,A+1);if(null!==O)return O.push(v),O}return null}function a(v,S){const A=O[v];if(!A)return!1;const E={};for(const v in O)E[v]=!1;const R=[];for(R.push(A),E[v]=!0;R.length>0;){const v=R.shift().dependencies;if(v)for(let A=0,z=v.length;A<z;A++){const z=v[A];if(z===S)return!0;const B=O[z];B&&!E[z]&&(E[z]=!0,R.push(B))}}return!1}function p(v,S,A,R){const z=new Array(v.length).fill(null);let B=0,M=!1;if("string"==typeof v){if(O[v]){if(1===O[v].dclamd)throw new Error(`Trying to load ${v} from ${R}. The first module is still loading.`);return O[v]}throw new Error(v+" has not been defined. Please include it as a dependency in "+R+"'s define()")}const V=v.length;for(let W=0;W<V;W++)switch(v[W]){case"require":const h=function(v,S,A){return p(v,S,A,R)};h.toUrl=function(v){return b(v,R)},z[W]=h,B++;break;case"exports":if(!O[R])throw new Error("Parent module "+R+" not registered yet");z[W]=O[R].exports,B++;break;case"module":z[W]={id:R,uri:b(R)},B++;break;default:{const H=v[W],m=()=>{z[W]=O[H].exports,B++,B===V&&S&&(M=!0,S(z))};if(a(H,R)){const v=u(H,R,0);v&&(v.reverse(),v.push(H),E.push(v)),w(H,(()=>{}),A,R),m()}else w(H,m,A,R);break}}!M&&B===V&&S&&S(z)}function h(v,S){return function(){return dcl.callRpc(v,S.name,A.slice.call(arguments,0))}}function w(v,S,A,E){if(O[v])return O[v].dependants.add(E),void(1===O[v].dclamd?S&&O[v].handlers.push(S):S&&S(O[v]));if(O[v]={name:v,parent:E,dclamd:1,handlers:[S],dependencies:[],dependants:new Set([E]),exports:{}},0===v.indexOf("@")){const S=O[v].exports;if("function"!=typeof dcl.loadModule)throw new Error("Asynchronous modules will not work because loadModule function is not present");dcl.loadModule(v,S).then((A=>{for(const v in A.methods){const E=A.methods[v];S[E.name]=h(A.rpcHandle,E)}d(v)})).catch((v=>{A(v)}))}}function g(v){let S,A=v;for(S=/\/\.\//;S.test(A);)A=A.replace(S,"/");for(A=A.replace(/^\.\//g,""),S=/\/(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//;S.test(A);)A=A.replace(S,"/");return A=A.replace(/^(([^\/])|([^\/][^\/\.])|([^\/\.][^\/])|([^\/][^\/][^\/]+))\/\.\.\//,""),A=A.replace(/^\//g,""),A}function b(v,S){switch(v){case"require":case"exports":case"module":return v}return S?function(v,S){let A=v;if(!A.startsWith("@")&&(A.startsWith("./")||A.startsWith("../"))){const v=S.split("/");v.pop(),A=g(v.join("/")+"/"+A)}return A}(v,S):g(v)}v.config=function(v){if("object"==typeof v)for(const S in v)v.hasOwnProperty(S)&&(R[S]=v[S])},v.define=c,function(v){v.amd={},v.modules=O}(c=v.define||(v.define={})),v.require=p,"undefined"!=typeof dcl&&dcl.onStart((()=>{const v=new Set,S=[];for(const A in O)O[A]&&(1===O[A].dclamd&&S.push(O[A]),O[A].dependencies.forEach((S=>{"require"!==S&&"exports"!==S&&"module"!==S&&(O[S]||v.add(S))})));const A=[];if(E.length&&A.push(`\n> Cyclic dependencies: ${E.map((v=>"\n  - "+v.join(" -> "))).join("")}`),v.size&&A.push(`\n> Undeclared/unknown modules: ${Array.from(v).map((v=>"\n  - "+v)).join("")}`),S.length&&A.push(`\n> These modules didn't load: ${S.map((v=>"\n  - "+v.name)).join("")}.\n`),A.length)throw new Error(A.join("\n"))})),p.toUrl=b}(loader||(loader={})),globalObject.define=loader.define,globalObject.dclamd=loader,function(v){var S=function(){function t(){}return t.AVATAR={getEntityRepresentation:function(v){return v.avatarEntity}},t.FIRST_PERSON_CAMERA={getEntityRepresentation:function(v){return v.firstPersonCameraEntity}},t}(),n=function(v,S){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,S){v.__proto__=S}||function(v,S){for(var A in S)Object.prototype.hasOwnProperty.call(S,A)&&(v[A]=S[A])})(v,S)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function i(v,S){if("function"!=typeof S&&null!==S)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function i(){this.constructor=v}n(v,S),v.prototype=null===S?Object.create(S):(i.prototype=S.prototype,new i)}var o=function(){return(o=Object.assign||function(v){for(var S,A=1,E=arguments.length;A<E;A++)for(var R in S=arguments[A])Object.prototype.hasOwnProperty.call(S,R)&&(v[R]=S[R]);return v}).apply(this,arguments)};function r(v,S,A,E){var R,O=arguments.length,z=O<3?S:null===E?E=Object.getOwnPropertyDescriptor(S,A):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,S,A,E);else for(var B=v.length-1;B>=0;B--)(R=v[B])&&(z=(O<3?R(z):O>3?R(S,A,z):R(S,A))||z);return O>3&&z&&Object.defineProperty(S,A,z),z}function s(v,S){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(v,S)}function h(v){var S="function"==typeof Symbol&&Symbol.iterator,A=S&&v[S],E=0;if(A)return A.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(v,S){var A="function"==typeof Symbol&&v[Symbol.iterator];if(!A)return v;var E,R,O=A.call(v),z=[];try{for(;(void 0===S||S-- >0)&&!(E=O.next()).done;)z.push(E.value)}catch(v){R={error:v}}finally{try{E&&!E.done&&(A=O.return)&&A.call(O)}finally{if(R)throw R.error}}return z}function p(v,S){for(var A=0,E=S.length,R=v.length;A<E;A++,R++)v[R]=S[A];return v}var A=0;function c(){for(var v=[],S=0;S<arguments.length;S++)v[S]=arguments[S];"undefined"!=typeof dcl?dcl.log.apply(dcl,p([],l(v))):console.log.apply(console,p(["DEBUG:"],l(v)))}function y(v,S){"undefined"!=typeof dcl?dcl.error(v,S):console.error("ERROR:",v,S)}function f(v){if(A++,0===v.length)throw new Error("newId(type: string): type cannot be empty");return v+A.toString(36)}function m(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(v){var S=16*Math.random()|0;return("x"===v?S:3&S|8).toString(16)}))}var E=[];function _(v){if(!("__event_name__"in v)||"string"!=typeof v.__event_name__)throw new Error("The EventConstructor is not registered");return v.__event_name__}var R=function(){function t(){this.listeners={}}return t.prototype.addListener=function(v,S,A){if(!v||"function"!=typeof v)throw new Error("Invalid EventConstructor");var E=_(v),R=this.listeners[E];R||(R=this.listeners[E]=[]);for(var O=0;O<R.length;O++)if(R[O].listener===S)throw new Error("The provided listener is already registered");return R.push({listener:S,fn:A}),this},t.prototype.removeListener=function(v,S){if(!S||"function"!=typeof S)throw new Error("Invalid EventConstructor");var A=_(S),E=this.listeners[A];if(!E)return!1;for(var R=0;R<E.length;R++)if(E[R].listener===v)return E.splice(R,1),!0;return!1},t.prototype.fireEvent=function(v){var S=_(v.constructor),A=this.listeners[S];if(A)for(var E=0;E<A.length;E++)try{var R=A[E];R.fn.call(R.listener,v)}catch(v){y(v)}return this},t}();function x(){var v=f("EV");if(-1!==E.indexOf(v))throw new Error("The event name "+v+" is already taken");return E.push(v),function(S){return S.__event_name__=v,S}}var O,z=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,S,A){this.entity=v,this.componentName=S,this.component=A})),B=r([x(),s("design:paramtypes",[Object,String,Object])],(function(v,S,A){this.entity=v,this.componentName=S,this.classId=A})),M=r([x(),s("design:paramtypes",[Object,Object])],(function(v,S){this.entity=v,this.parent=S}));v.UIValueType=void 0,(O=v.UIValueType||(v.UIValueType={}))[O.PERCENT=0]="PERCENT",O[O.PIXELS=1]="PIXELS";var V=function(){function e(S){if(this.type=v.UIValueType.PIXELS,"string"==typeof S){var A=S;A.indexOf("px")>-1?this.type=v.UIValueType.PIXELS:A.indexOf("%")>-1&&(this.type=v.UIValueType.PERCENT),this.value=parseFloat(A)}else this.value=S}return e.prototype.toString=function(){var S=this.value.toString();return this.type===v.UIValueType.PERCENT?S+="%":S+="px",S},e}(),W="__name__symbol_",H="__classId__symbol_",X="__component__id_",Q=r([x(),s("design:paramtypes",[String,String,Number])],(function(v,S,A){this.componentId=v,this.componentName=S,this.classId=A})),Z=r([x(),s("design:paramtypes",[String])],(function(v){this.componentId=v})),J=r([x(),s("design:paramtypes",[String,Object])],(function(v,S){this.componentId=v,this.component=S}));function P(v,S){return function(A){if(A.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+A.originalClassName+" with: "+v);var E=A,o=function(){var A=Array.prototype.slice.call(arguments),R=new(E.bind.apply(E,p([void 0],l(A))));return Object.defineProperty(R,W,{enumerable:!1,writable:!1,configurable:!1,value:v}),void 0!==S&&Object.defineProperty(R,H,{enumerable:!1,writable:!1,configurable:!1,value:S}),R};return void 0!==S&&(o.__classId__symbol_=S),o.__name__symbol_=v,o.isComponent=!0,o.originalClassName=v,(o.prototype=A.prototype).constructor=A,o}}function N(v,S){return function(A){if(A.isComponent)throw new TypeError("You cannot extend a component. Trying to extend "+A.originalClassName+" with: "+v);if("number"!=typeof S||isNaN(S))throw new Error("classId: "+S+" is an invalid integer");var E=A,o=function(){if(!N.engine)throw new Error("You need to set a DisposableComponent.engine before creating disposable components");var A=Array.prototype.slice.call(arguments),R=new(E.bind.apply(E,p([void 0],l(A)))),O=f("C");return Object.defineProperty(R,W,{enumerable:!1,writable:!1,configurable:!1,value:v}),Object.defineProperty(R,X,{enumerable:!1,writable:!1,configurable:!1,value:O}),void 0!==S&&Object.defineProperty(R,H,{enumerable:!1,writable:!1,configurable:!1,value:S}),N.engine&&N.engine.registerComponent(R),R};return void 0!==S&&(o.__classId__symbol_=S),o.__name__symbol_=v,o.isComponent=!0,o.isDisposableComponent=!0,o.originalClassName=v,(o.prototype=A.prototype).constructor=A,o}}function F(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__name__symbol_)return v.__name__symbol_;throw new TypeError(v+" is not a registered component.")}function L(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__classId__symbol_)return v.__classId__symbol_;if(!v.__name__symbol_)throw new TypeError(v+" is not a registered component.");return null}function D(v){if(!v)throw new TypeError(v+" is not a component.");if(v.__component__id_)return v.__component__id_;throw new TypeError(v+" is not a registered disposable component.")}!function(v){v.engine=null}(N||(N={}));var K=function(){function t(){this.dirty=!1,this.data={},this.subscriptions=[]}return t.component=function(v,S){if(delete v[S]){var A=S+"_"+Math.random();v[A]=void 0,Object.defineProperty(v,A,o(o({},Object.getOwnPropertyDescriptor(v,A)),{enumerable:!1})),Object.defineProperty(v,S.toString(),{get:function(){return this[A]},set:function(v){var E=this[A];if(this.data[S]=v?D(v):null,this[A]=v,v!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](S,v,E)}},enumerable:!0})}},t.field=function(v,S){delete v[S]&&Object.defineProperty(v,S.toString(),{get:function(){return this.data[S]},set:function(v){var A=this.data[S];if(this.data[S]=v,v!==A){this.dirty=!0;for(var E=0;E<this.subscriptions.length;E++)this.subscriptions[E](S,v,A)}},enumerable:!0})},t.uiValue=function(v,S){delete v[S]&&Object.defineProperty(v,S.toString(),{get:function(){return this.data[S].toString()},set:function(v){var A=this.data[S],E=new V(v);if(this.data[S]=E,E!==A){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](S,E,A)}},enumerable:!0})},t.readonly=function(v,S){delete v[S]&&Object.defineProperty(v,S.toString(),{get:function(){if(S in this.data==0)throw new Error("The field "+S+" is uninitialized");return this.data[S]},set:function(v){if(S in this.data)throw new Error("The field "+S+" is readonly");this.data[S]=v,this.dirty=!0},enumerable:!0,configurable:!1})},t.prototype.onChange=function(v){return this.subscriptions.push(v),this},t.prototype.toJSON=function(){return this.data},t}();function U(v){return X in v}var $=function(){function t(){for(var v=[],S=0;S<arguments.length;S++)v[S]=arguments[S];if(this.entities=[],this.active=!1,this._requiresNames=[],!v)throw new Error("ComponentGroup: Could not load the requires list");if(!(v instanceof Array))throw new Error("ComponentGroup: requires list is not an Array");Object.defineProperty(this,"requires",{get:function(){return v.slice()}}),Object.defineProperty(this,"requiresNames",{get:function(){return this._requiresNames.slice()}});for(var n=function(S){var E=v[S],R=null;if(!E)throw new Error("ComponentGroup: the required component at location "+S+" is invalid");try{R=F(E)}catch(v){throw new Error("ComponentGroup: the required component at location "+S+" is not registered as a @Component. Remember to provide the class of the component, not the name")}if(A._requiresNames.some((function(v){return v===R})))throw new Error("ComponentGroup: the required component list has a repeated name "+R);A._requiresNames.push(R)},A=this,E=0;E<v.length;E++)n(E)}return t.prototype.hasEntity=function(v){return!!v.isAddedToEngine()&&-1!==this.entities.indexOf(v)},t.prototype.addEntity=function(v){if(!v.isAddedToEngine())throw new TypeError("ComponentGroup: Cannot add a entity that is not added to the engine");-1===this.entities.indexOf(v)&&this.entities.push(v)},t.prototype.removeEntity=function(v){var S=this.entities.indexOf(v);-1!==S&&this.entities.splice(S,1)},t.prototype.componentRemoved=function(v,S){-1!==this._requiresNames.indexOf(S)&&this.removeEntity(v)},t.prototype.meetsRequirements=function(v){for(var S=0;S<this._requiresNames.length;S++)if(!(this._requiresNames[S]in v.components))return!1;return!0},t}(),et=function(){function t(v){this.name=v,this.children={},this.eventManager=null,this.alive=!1,this.uuid=f("E"),this.components={},this.engine=null,this._parent=null}return t.prototype.addComponentOrReplace=function(v){if("function"==typeof v)throw new Error("You passed a function or class as a component, an instance of component is expected");if("object"!=typeof v)throw new Error("You passed a "+typeof v+", an instance of component is expected");var S=F(v);if(this.components[S]){if(this.components[S]===v)return v;this.removeComponent(this.components[S],!1)}return this.addComponent(v)},t.prototype.hasComponent=function(v){var S=typeof v;if("string"!==S&&"object"!==S&&"function"!==S)throw new Error("Entity#has(component): component is not a class, name or instance");if(null===v)return!1;var A="string"===S?v:F(v),E=this.components[A];return!!E&&("object"===S?E===v:"function"!==S||E instanceof v)},t.prototype.getComponent=function(v){var S=typeof v;if("string"!==S&&"function"!==S)throw new Error("Entity#get(component): component is not a class or name");var A="string"===S?v:F(v),E=this.components[A];if(!E)throw new Error('Can not get component "'+A+'" from entity "'+this.identifier+'"');if("function"===S){if(E instanceof v)return E;throw new Error('Can not get component "'+A+'" from entity "'+this.identifier+'" (by instance)')}return E},t.prototype.getComponentOrNull=function(v){var S=typeof v;if("string"!==S&&"function"!==S)throw new Error("Entity#getOrNull(component): component is not a class or name");var A="string"===S?v:F(v),E=this.components[A];return E?"function"===S?E instanceof v?E:null:E:null},t.prototype.getComponentOrCreate=function(v){if("function"!=typeof v)throw new Error("Entity#getOrCreate(component): component is not a class");var S=this.getComponentOrNull(v);return S||(F(S=new v),this.addComponentOrReplace(S)),S},t.prototype.addComponent=function(v){if("object"!=typeof v)throw new Error("Entity#add(component): You passed a function or class as a component, an instance of component is expected");var S=F(v),A=L(v);if(this.components[S])throw new Error('A component of type "'+S+'" is already present in entity "'+this.identifier+'"');this.components[S]=v,this.eventManager&&this.eventManager.fireEvent(new B(this,S,A));var E=v;return"function"==typeof E.addedToEntity&&E.addedToEntity(this),v},t.prototype.removeComponent=function(v,S){void 0===S&&(S=!0);var A=typeof v;if("string"!==A&&"function"!==A&&"object"!==A)throw new Error("Entity#remove(component): component is not a class, class or name");var E="string"===A?v:F(v),R=this.components[E];if(R){if("function"===A)return R instanceof v?(delete this.components[E],void(R&&(S&&this.eventManager&&this.eventManager.fireEvent(new z(this,E,R)),"function"==typeof R.removedFromEntity&&R.removedFromEntity(this)))):void c('Entity Warning: Trying to remove wrong (by constructor) component "'+E+'" from entity "'+this.identifier+'"');delete this.components[E],R&&(S&&this.eventManager&&this.eventManager.fireEvent(new z(this,E,R)),"function"==typeof R.removedFromEntity&&R.removedFromEntity(this))}else c('Entity Warning: Trying to remove inexisting component "'+E+'" from entity "'+this.identifier+'"')},t.prototype.isAddedToEngine=function(){return!(!this.engine||!(this.uuid in this.engine.entities)&&this.engine.rootEntity!==this)},t.prototype.setParent=function(v){var S;if(v&&"getEntityRepresentation"in v){if(!this.engine)throw new Error("In order to set an attachable as parent, you first need to add the entity to the engine.");S=v.getEntityRepresentation(this.engine)}else S=!v&&this.engine?this.engine.rootEntity:v;var A=this.getParent();if(S===this)throw new Error('Failed to set parent for entity "'+this.identifier+"\": An entity can't set itself as a its own parent");if(S===A)return this;var E=this.getCircularAncestor(S);if(E)throw new Error('Failed to set parent for entity "'+this.identifier+'": Circular parent references are not allowed (See entity "'+E+'")');return A&&delete A.children[this.uuid],null!==S&&"0"!==S.uuid&&(!S.isAddedToEngine()&&this.isAddedToEngine()&&this.engine.removeEntity(this),S.isAddedToEngine()&&!this.isAddedToEngine()&&S.engine.addEntity(this)),this._parent=S||null,this.registerAsChild(),this.eventManager&&this.engine&&this.eventManager.fireEvent(new M(this,S)),this},t.prototype.getParent=function(){return this._parent},Object.defineProperty(t.prototype,"identifier",{get:function(){return this.name||this.uuid},enumerable:!1,configurable:!0}),t.prototype.getCircularAncestor=function(v){for(var S=this.engine?this.engine.rootEntity:null,A=v;A&&A!==S;){var E=A.getParent();if(E===this)return A.uuid;A=E}return null},t.prototype.registerAsChild=function(){var v=this.getParent();this.uuid&&v&&(v.children[this.uuid]=this)},t}(),nt=function(){function t(v){this.eventManager=new R,this.systems=[],this.entityLists={},this.addedSystems=[],this._entities={},this._disposableComponents={},this._componentGroups={},this.simpleSystems=[],this.eventManager.addListener(B,this,this.componentAddedHandler),this.eventManager.addListener(z,this,this.componentRemovedHandler),this.rootEntity=v,this.firstPersonCameraEntity=new et,this.firstPersonCameraEntity.uuid="FirstPersonCameraEntityReference",this.addEntity(this.firstPersonCameraEntity),this.avatarEntity=new et,this.avatarEntity.uuid="AvatarEntityReference",this.addEntity(this.avatarEntity)}return Object.defineProperty(t.prototype,"entities",{get:function(){return this._entities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"disposableComponents",{get:function(){return this._disposableComponents},enumerable:!1,configurable:!0}),t.prototype.addEntity=function(v){var S=v.getParent();if(v.isAddedToEngine())return v;for(var A in v.eventManager=this.eventManager,v.engine=this,this._entities[v.uuid]=v,this.checkRequirementsAndAdd(v),S?S.isAddedToEngine()||S===this.rootEntity||c("Engine: warning, added an entity with a parent not present in the engine. Parent id: "+S.uuid):v.setParent(this.rootEntity),v.alive=!0,v.children){var E=v.children[A];E&&(E.isAddedToEngine()||this.addEntity(E))}return v},t.prototype.removeEntity=function(v){var S=v.uuid;if(v.isAddedToEngine()){for(var A in v.components){var E=this._componentGroups[A];if(E)for(var R in E)E[R].removeEntity(v);delete this.entityLists[A][S]}for(var O=0;O<this.simpleSystems.length;O++){var z=this.simpleSystems[O];z.onRemoveEntity&&z.onRemoveEntity(v)}for(var O in v.children){var B=v.children[O];B&&this.removeEntity(B)}return v.alive=!1,v.eventManager=null,delete this._entities[S],!0}for(var A in c("Engine: Trying to remove non existent entity from engine."),v.isAddedToEngine()?c("Engine: Entity id: "+S):c('Engine: Entity "'+v.uuid+'" has not been added to any engine yet.'),c("Engine: Entity's components:"),v.components)c(A);return!1},t.prototype.addSystem=function(v,S){if(void 0===S&&(S=0),-1!==this.addedSystems.indexOf(v))return c("Engine: Trying to add a system that is already added. Aborting"),v;if(this.systems.length>0)for(var A=0;A<this.systems.length;A++){var E=this.systems[A],R=A===this.systems.length-1;if(E.priority>S){this.addedSystems.push(v),this.systems.splice(A,0,{system:v,priority:S});break}if(R){this.addedSystems.push(v),this.systems.splice(A+1,0,{system:v,priority:S});break}}else this.addedSystems.push(v),this.systems.splice(1,0,{system:v,priority:S});return this.registerSystem(v),v},t.prototype.removeSystem=function(v){var S=this.addedSystems.indexOf(v);if(-1!==S){v.active=!1,v.deactivate&&v.deactivate(),this.addedSystems.splice(S,1);for(var A=0;A<this.systems.length;A++)this.systems[A].system===v&&this.systems.splice(A,1);return!0}return!1},t.prototype.update=function(v){for(var S in this.systems){var A=this.systems[S].system;if(A.active&&A.update)try{A.update(v)}catch(v){y(v)}}return this},t.prototype.getEntitiesWithComponent=function(v){var S="string"==typeof v?v:F(v);return S in this.entityLists?this.entityLists[S]:this.entityLists[S]={}},t.prototype.registerComponent=function(v){var S=D(v),A=F(v),E=L(v);this._disposableComponents[S]=v,null!==E&&(this.eventManager.fireEvent(new Q(S,A,E)),this.eventManager.fireEvent(new J(S,v)))},t.prototype.disposeComponent=function(v){var S=D(v);return delete this._disposableComponents[S]&&(this.eventManager.fireEvent(new Z(S)),v.onDispose&&v.onDispose(),!0)},t.prototype.updateComponent=function(v){this.eventManager.fireEvent(new J(D(v),v))},t.prototype.getComponentGroup=function(){for(var v=[],S=0;S<arguments.length;S++)v[S]=arguments[S];var A=void 0;if(v.length>0&&(M=this._componentGroups[F(v[0])]))for(var E=v.slice(),R=0;R<M.length;R++){var O=M[R];if(E.length===O.requires.length){for(var z=0;z<E.length&&-1!==O.requires.indexOf(E[z]);z++)z===E.length-1&&(A=O);if(A)break}}if(A)return A;(A=new($.bind.apply($,p([void 0],l(v))))).active=!0;var B=A.requiresNames;for(R=0;R<B.length;R++){var M,V=B[R];(M=this._componentGroups[V])||(this._componentGroups[V]=M=[]),-1===M.indexOf(A)&&M.push(A)}for(var W in this._entities)this.checkRequirements(this._entities[W],A);return A},t.prototype.removeComponentGroup=function(v){if(v.active){v.active=!1;for(var S=v.requiresNames,A=0;A<S.length;A++){var E=S[A],R=this._componentGroups[E];if(R){var O=R.indexOf(v);-1!==O&&R.splice(O,1)}}return!0}return!1},t.prototype.registerSystem=function(v){v.active=!0,v.activate&&v.activate(this),this.simpleSystems.push(v)},t.prototype.checkRequirementsAndAdd=function(v){if(v.isAddedToEngine()){for(var S in v.components){S in this.entityLists||(this.entityLists[S]={}),this.entityLists[S][v.uuid]=v;var A=this._componentGroups[S];if(A)for(var E in A)this.checkRequirements(v,A[E])}for(var R=0;R<this.simpleSystems.length;R++){var O=this.simpleSystems[R];O.onAddEntity&&O.onAddEntity(v)}}},t.prototype.checkRequirements=function(v,S){S.meetsRequirements(v)?S.hasEntity(v)||S.addEntity(v):S.hasEntity(v)&&S.removeEntity(v)},t.prototype.componentAddedHandler=function(v){var S,A=v.entity,E=v.componentName;if(A.isAddedToEngine()){this.entityLists[E]?this.entityLists[E][A.uuid]=A:this.entityLists[E]=((S={})[A.uuid]=A,S);var R=this._componentGroups[E];if(R)for(var O in R)this.checkRequirements(A,R[O])}},t.prototype.componentRemovedHandler=function(v){var S=v.entity,A=v.componentName;if(S.isAddedToEngine()){delete this.entityLists[A][S.uuid];var E=this._componentGroups[A];if(E)for(var R in E)this.checkRequirements(S,E[R])}},t}(),it=Promise.resolve().then.bind(Promise.resolve());function G(v){var S=it(v);return S.isComplete=!1,S.then((function(v){S.isComplete=!0,S.result=v,S.didFail=!1})).catch((function(v){S.isComplete=!0,S.error=v,S.didFail=!0,y("executeTask: FAILED "+v.toString(),v)})),S}var ot,rt,st=function(){function t(v,S,A,E){void 0===S&&(S=!1),this.initalize(v,S,A,E)}return t.prototype.initalize=function(v,S,A,E){return void 0===S&&(S=!1),this.mask=v,this.skipNextObservers=S,this.target=A,this.currentTarget=E,this},t}(),Y=function(v,S,A){void 0===A&&(A=null),this.callback=v,this.mask=S,this.scope=A,this.unregisterOnNextCall=!1,this._willBeUnregistered=!1},at=function(){function t(){this._observers=null,this._observables=null}return t.Watch=function(v,S,A,E){var R,O;void 0===A&&(A=-1),void 0===E&&(E=null);var z=new t;z._observers=new Array,z._observables=v;try{for(var B=h(v),M=B.next();!M.done;M=B.next()){var V=M.value.add(S,A,!1,E);V&&z._observers.push(V)}}catch(v){R={error:v}}finally{try{M&&!M.done&&(O=B.return)&&O.call(B)}finally{if(R)throw R.error}}return z},t.prototype.dispose=function(){if(this._observers&&this._observables)for(var v=0;v<this._observers.length;v++)this._observables[v].remove(this._observers[v]);this._observers=null,this._observables=null},t}(),ht=function(){function t(v){this._observers=new Array,this._onObserverAdded=null,this._eventState=new st(0),v&&(this._onObserverAdded=v)}return t.prototype.add=function(v,S,A,E,R){if(void 0===S&&(S=-1),void 0===A&&(A=!1),void 0===E&&(E=null),void 0===R&&(R=!1),!v)return null;var O=new Y(v,S,E);return O.unregisterOnNextCall=R,A?this._observers.unshift(O):this._observers.push(O),this._onObserverAdded&&this._onObserverAdded(O),O},t.prototype.addOnce=function(v){return this.add(v,void 0,void 0,void 0,!0)},t.prototype.remove=function(v){return!!v&&-1!==this._observers.indexOf(v)&&(this._deferUnregister(v),!0)},t.prototype.removeCallback=function(v,S){for(var A=0;A<this._observers.length;A++)if(this._observers[A].callback===v&&(!S||S===this._observers[A].scope))return this._deferUnregister(this._observers[A]),!0;return!1},t.prototype.notifyObservers=function(v,S,A,E){var R,O;if(void 0===S&&(S=-1),!this._observers.length)return!0;var z=this._eventState;z.mask=S,z.target=A,z.currentTarget=E,z.skipNextObservers=!1,z.lastReturnValue=v;try{for(var B=h(this._observers),M=B.next();!M.done;M=B.next()){var V=M.value;if(!V._willBeUnregistered&&(V.mask&S&&(V.scope?z.lastReturnValue=V.callback.apply(V.scope,[v,z]):z.lastReturnValue=V.callback(v,z),V.unregisterOnNextCall&&this._deferUnregister(V)),z.skipNextObservers))return!1}}catch(v){R={error:v}}finally{try{M&&!M.done&&(O=B.return)&&O.call(B)}finally{if(R)throw R.error}}return!0},t.prototype.notifyObserversWithPromise=function(v,S,A,E){var R=this;void 0===S&&(S=-1);var O=Promise.resolve(v);if(!this._observers.length)return O;var z=this._eventState;return z.mask=S,z.target=A,z.currentTarget=E,z.skipNextObservers=!1,this._observers.forEach((function(A){z.skipNextObservers||A._willBeUnregistered||A.mask&S&&(O=A.scope?O.then((function(S){return z.lastReturnValue=S,A.callback.apply(A.scope,[v,z])})):O.then((function(S){return z.lastReturnValue=S,A.callback(v,z)})),A.unregisterOnNextCall&&R._deferUnregister(A))})),O.then((function(){return v}))},t.prototype.notifyObserver=function(v,S,A){void 0===A&&(A=-1);var E=this._eventState;E.mask=A,E.skipNextObservers=!1,v.callback(S,E)},t.prototype.hasObservers=function(){return this._observers.length>0},t.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},t.prototype.clone=function(){var v=new t;return v._observers=this._observers.slice(0),v},t.prototype.hasSpecificMask=function(v){var S,A;void 0===v&&(v=-1);try{for(var E=h(this._observers),R=E.next();!R.done;R=E.next()){var O=R.value;if(O.mask&v||O.mask===v)return!0}}catch(v){S={error:v}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}return!1},t.prototype._deferUnregister=function(v){var S=this;v.unregisterOnNextCall=!1,v._willBeUnregistered=!0,G((function(){return function(v,S,A,E){return new(A||(A=Promise))((function(S,R){function s(v){try{d(E.next(v))}catch(v){R(v)}}function a(v){try{d(E.throw(v))}catch(v){R(v)}}function d(v){var E;v.done?S(v.value):(E=v.value,E instanceof A?E:new A((function(v){v(E)}))).then(s,a)}d((E=E.apply(v,[])).next())}))}(S,0,void 0,(function(){return function(v,S){var A,E,R,O,z={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return O={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function a(O){return function(B){return function(O){if(A)throw new TypeError("Generator is already executing.");for(;z;)try{if(A=1,E&&(R=2&O[0]?E.return:O[0]?E.throw||((R=E.return)&&R.call(E),0):E.next)&&!(R=R.call(E,O[1])).done)return R;switch(E=0,R&&(O=[2&O[0],R.value]),O[0]){case 0:case 1:R=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,E=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((R=(R=z.trys).length>0&&R[R.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!R||O[1]>R[0]&&O[1]<R[3])){z.label=O[1];break}if(6===O[0]&&z.label<R[1]){z.label=R[1],R=O;break}if(R&&z.label<R[2]){z.label=R[2],z.ops.push(O);break}R[2]&&z.ops.pop(),z.trys.pop();continue}O=S.call(v,z)}catch(v){O=[6,v],E=0}finally{A=R=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,B])}}}(this,(function(S){return[2,this._remove(v)]}))}))}))},t.prototype._remove=function(v){if(!v)return!1;var S=this._observers.indexOf(v);return-1!==S&&(this._observers.splice(S,1),!0)},t}(),lt=r([x(),s("design:paramtypes",[String,Object])],(function(v,S){this.uuid=v,this.payload=S})),ct=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v})),ut=r([x(),s("design:paramtypes",[Object])],(function(v){this.payload=v}));function tt(v){return function(){rt&&rt.subscribe(v)}}var dt=new ht(tt("cameraModeChanged")),pt=new ht(tt("idleStateChanged")),ft=new ht(tt("onEnterScene")),gt=ft,yt=new ht(tt("onLeaveScene")),vt=yt,bt=new ht(tt("sceneStart")),Tt=new ht(tt("playerExpression")),wt=new ht(tt("onPointerLock")),Ct=new ht(tt("videoEvent")),xt=new ht(tt("profileChanged")),St=new ht(tt("playerConnected")),At=new ht(tt("playerDisconnected")),_t=new ht(tt("onRealmChanged")),Pt=new ht(tt("playerClicked"));function mt(v){(rt=v)&&rt.onEvent((function(v){switch(v.type){case"onEnterScene":return void ft.notifyObservers(v.data);case"onLeaveScene":return void yt.notifyObservers(v.data);case"cameraModeChanged":return void dt.notifyObservers(v.data);case"idleStateChanged":return void pt.notifyObservers(v.data);case"sceneStart":return void bt.notifyObservers(v.data);case"playerExpression":return void Tt.notifyObservers(v.data);case"videoEvent":var S=v.data,A=N.engine.disposableComponents[S.componentId];return A&&A.update(S),void Ct.notifyObservers(S);case"profileChanged":return void xt.notifyObservers(v.data);case"onPointerLock":return void wt.notifyObservers(v.data);case"playerConnected":return void St.notifyObservers(v.data);case"playerDisconnected":return void At.notifyObservers(v.data);case"onRealmChanged":return void _t.notifyObservers(v.data);case"playerClicked":return void Pt.notifyObservers(v.data)}}))}var It=function(){function t(v){this.dcl=v,this.cachedComponents={}}return t.prototype.activate=function(v){var S=this;this.engine=v,v.eventManager.addListener(B,this,this.componentAdded),v.eventManager.addListener(z,this,this.componentRemoved),v.eventManager.addListener(Q,this,this.disposableComponentCreated),v.eventManager.addListener(Z,this,this.disposableComponentRemoved),v.eventManager.addListener(J,this,this.disposableComponentUpdated),v.eventManager.addListener(M,this,this.parentChanged);var A=v.rootEntity.uuid;this.dcl.addEntity(A),this.dcl.onUpdate((function(A){v.update(A),S.presentEntities()})),this.dcl.onEvent((function(S){var A=S.data;switch(S.type){case"uuidEvent":v.eventManager.fireEvent(new lt(A.uuid,A.payload));break;case"raycastResponse":("HitFirst"===A.queryType||"HitAll"===A.queryType)&&v.eventManager.fireEvent(new ct(A));break;case"actionButtonEvent":v.eventManager.fireEvent(new ut(A.payload))}}))},t.prototype.onAddEntity=function(v){if(v&&v.isAddedToEngine()){var S=v.uuid,A=v.getParent();for(var E in this.dcl.addEntity(S),A&&this.dcl.setParent(S,A.uuid),this.cachedComponents[S]={},v.components){var R=v.components[E],O=L(R);if(null!==O)if(U(R))this.dcl.attachEntityComponent(v.uuid,E,D(R));else{var z=JSON.stringify(R);this.dcl.updateEntityComponent(S,E,O,z),this.cachedComponents[S][E]=z}}}},t.prototype.onRemoveEntity=function(v){if(v.isAddedToEngine()){var S=v.uuid;this.dcl.removeEntity(S),delete this.cachedComponents[S]}},t.prototype.presentEntities=function(){for(var v in this.engine.entities){var S=this.engine.entities[v];for(var A in S.components){var E=L(z=S.components[A]);if(null!==E&&!U(z)){var R=this.getJsonIfDirty(S.uuid,A,z);R&&(this.dcl.updateEntityComponent(S.uuid,A,E,R),this.clearDirty(S.uuid,A,z,R))}}}for(var O in this.engine.disposableComponents){var z;(z=this.engine.disposableComponents[O])instanceof K&&z.dirty&&(this.dcl.componentUpdated(O,JSON.stringify(z)),z.dirty=!1)}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var S=v.entity.components[v.componentName];if(U(S))this.dcl.attachEntityComponent(v.entity.uuid,v.componentName,D(S));else if(null!==v.classId){var A=JSON.stringify(S);this.dcl.updateEntityComponent(v.entity.uuid,v.componentName,v.classId,A),this.cachedComponents[v.entity.uuid][v.componentName]=A}}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&(this.dcl.removeEntityComponent(v.entity.uuid,v.componentName),delete this.cachedComponents[v.entity.uuid][v.componentName])},t.prototype.disposableComponentCreated=function(v){this.dcl.componentCreated(v.componentId,v.componentName,v.classId)},t.prototype.disposableComponentRemoved=function(v){this.dcl.componentDisposed(v.componentId)},t.prototype.disposableComponentUpdated=function(v){this.dcl.componentUpdated(v.componentId,JSON.stringify(v.component))},t.prototype.parentChanged=function(v){this.dcl.setParent(v.entity.uuid,v.parent?v.parent.uuid:"0")},t.prototype.getJsonIfDirty=function(v,S,A){var E=JSON.stringify(A);return E!==this.cachedComponents[v][S]&&E},t.prototype.clearDirty=function(v,S,A,E){this.cachedComponents[v][S]=E},t}(),Rt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Ot={},zt={};!function(v){var S,A;Object.defineProperty(v,"__esModule",{value:!0}),v.RAD2DEG=v.DEG2RAD=v.Epsilon=v.ToLinearSpace=v.ToGammaSpace=v.Space=v.Orientation=void 0,(S=v.Orientation||(v.Orientation={}))[S.CW=0]="CW",S[S.CCW=1]="CCW",(A=v.Space||(v.Space={}))[A.LOCAL=0]="LOCAL",A[A.WORLD=1]="WORLD",A[A.BONE=2]="BONE",v.ToGammaSpace=1/2.2,v.ToLinearSpace=2.2,v.Epsilon=1e-6,v.DEG2RAD=Math.PI/180,v.RAD2DEG=360/(2*Math.PI)}(zt);var Bt={},Nt={};Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.buildArray=void 0,Nt.buildArray=function(v,S){const A=[];for(let E=0;E<v;++E)A.push(S());return A};var Lt={},kt={},Ft={},Ut={},Vt={};Object.defineProperty(Vt,"__esModule",{value:!0}),Vt.Scalar=void 0;class Et{static WithinEpsilon(v,S,A=1401298e-51){const E=v-S;return-A<=E&&E<=A}static ToHex(v){const S=v.toString(16);return v<=15?("0"+S).toUpperCase():S.toUpperCase()}static Sign(v){const S=+v;return 0===S||isNaN(S)?S:S>0?1:-1}static Clamp(v,S=0,A=1){return Math.min(A,Math.max(S,v))}static Log2(v){return Math.log(v)*Math.LOG2E}static Repeat(v,S){return v-Math.floor(v/S)*S}static Normalize(v,S,A){return(v-S)/(A-S)}static Denormalize(v,S,A){return v*(A-S)+S}static DeltaAngle(v,S){let A=Et.Repeat(S-v,360);return A>180&&(A-=360),A}static PingPong(v,S){const A=Et.Repeat(v,2*S);return S-Math.abs(A-S)}static SmoothStep(v,S,A){let E=Et.Clamp(A);return E=-2*E*E*E+3*E*E,S*E+v*(1-E)}static MoveTowards(v,S,A){let E=0;return E=Math.abs(S-v)<=A?S:v+Et.Sign(S-v)*A,E}static MoveTowardsAngle(v,S,A){const E=Et.DeltaAngle(v,S);let R=0;return R=-A<E&&E<A?S:Et.MoveTowards(v,v+E,A),R}static Lerp(v,S,A){return v+(S-v)*A}static LerpAngle(v,S,A){let E=Et.Repeat(S-v,360);return E>180&&(E-=360),v+E*Et.Clamp(A)}static InverseLerp(v,S,A){let E=0;return E=v!==S?Et.Clamp((A-v)/(S-v)):0,E}static Hermite(v,S,A,E,R){const O=R*R,z=R*O;return v*(2*z-3*O+1)+A*(-2*z+3*O)+S*(z-2*O+R)+E*(z-O)}static RandomRange(v,S){return v===S?v:Math.random()*(S-v)+v}static RangeToPercent(v,S,A){return(v-S)/(A-S)}static PercentToRange(v,S,A){return(A-S)*v+S}static NormalizeRadians(v){return v-Et.TwoPi*Math.floor((v+Math.PI)/Et.TwoPi)}}Vt.Scalar=Et,Et.TwoPi=2*Math.PI,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.Vector4=void 0;const Wt=zt,Ht=Vt,qt=Lt;class Mt{constructor(v,S,A,E){this.x=v,this.y=S,this.z=A,this.w=E}static Add(v,S){return new Mt(v.x,v.y,v.z,v.w).addInPlace(S)}static FromArray(v,S=0){return new Mt(v[S],v[S+1],v[S+2],v[S+3])}static FromArrayToRef(v,S,A){A.x=v[S],A.y=v[S+1],A.z=v[S+2],A.w=v[S+3]}static FromFloatArrayToRef(v,S,A){Mt.FromArrayToRef(v,S,A)}static FromFloatsToRef(v,S,A,E,R){R.x=v,R.y=S,R.z=A,R.w=E}static Zero(){return new Mt(0,0,0,0)}static One(){return new Mt(1,1,1,1)}static Normalize(v){const S=Mt.Zero();return Mt.NormalizeToRef(v,S),S}static NormalizeToRef(v,S){S.copyFrom(v),S.normalize()}static Minimize(v,S){const A=new Mt(v.x,v.y,v.z,v.w);return A.minimizeInPlace(S),A}static Maximize(v,S){const A=new Mt(v.x,v.y,v.z,v.w);return A.maximizeInPlace(S),A}static Distance(v,S){return Math.sqrt(Mt.DistanceSquared(v,S))}static DistanceSquared(v,S){const A=v.x-S.x,E=v.y-S.y,R=v.z-S.z,O=v.w-S.w;return A*A+E*E+R*R+O*O}static Center(v,S){const A=Mt.Add(v,S);return A.scaleInPlace(.5),A}static TransformNormal(v,S){const A=Mt.Zero();return Mt.TransformNormalToRef(v,S,A),A}static TransformNormalToRef(v,S,A){const E=S.m,R=v.x*E[0]+v.y*E[4]+v.z*E[8],O=v.x*E[1]+v.y*E[5]+v.z*E[9],z=v.x*E[2]+v.y*E[6]+v.z*E[10];A.x=R,A.y=O,A.z=z,A.w=v.w}static TransformNormalFromFloatsToRef(v,S,A,E,R,O){const z=R.m;O.x=v*z[0]+S*z[4]+A*z[8],O.y=v*z[1]+S*z[5]+A*z[9],O.z=v*z[2]+S*z[6]+A*z[10],O.w=E}toString(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"}getClassName(){return"Vector4"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,S=0){return v[S]=this.x,v[S+1]=this.y,v[S+2]=this.z,v[S+3]=this.w,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}add(v){return new Mt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addToRef(v,S){return S.x=this.x+v.x,S.y=this.y+v.y,S.z=this.z+v.z,S.w=this.w+v.w,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this.w-=v.w,this}subtract(v){return new Mt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}subtractToRef(v,S){return S.x=this.x-v.x,S.y=this.y-v.y,S.z=this.z-v.z,S.w=this.w-v.w,this}subtractFromFloats(v,S,A,E){return new Mt(this.x-v,this.y-S,this.z-A,this.w-E)}subtractFromFloatsToRef(v,S,A,E,R){return R.x=this.x-v,R.y=this.y-S,R.z=this.z-A,R.w=this.w-E,this}negate(){return new Mt(-this.x,-this.y,-this.z,-this.w)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scale(v){return new Mt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,S){return S.x=this.x*v,S.y=this.y*v,S.z=this.z*v,S.w=this.w*v,this}scaleAndAddToRef(v,S){return S.x+=this.x*v,S.y+=this.y*v,S.z+=this.z*v,S.w+=this.w*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}equalsWithEpsilon(v,S=Wt.Epsilon){return v&&Ht.Scalar.WithinEpsilon(this.x,v.x,S)&&Ht.Scalar.WithinEpsilon(this.y,v.y,S)&&Ht.Scalar.WithinEpsilon(this.z,v.z,S)&&Ht.Scalar.WithinEpsilon(this.w,v.w,S)}equalsToFloats(v,S,A,E){return this.x===v&&this.y===S&&this.z===A&&this.w===E}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this.w*=v.w,this}multiply(v){return new Mt(this.x*v.x,this.y*v.y,this.z*v.z,this.w*v.w)}multiplyToRef(v,S){return S.x=this.x*v.x,S.y=this.y*v.y,S.z=this.z*v.z,S.w=this.w*v.w,this}multiplyByFloats(v,S,A,E){return new Mt(this.x*v,this.y*S,this.z*A,this.w*E)}divide(v){return new Mt(this.x/v.x,this.y/v.y,this.z/v.z,this.w/v.w)}divideToRef(v,S){return S.x=this.x/v.x,S.y=this.y/v.y,S.z=this.z/v.z,S.w=this.w/v.w,this}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return v.x<this.x&&(this.x=v.x),v.y<this.y&&(this.y=v.y),v.z<this.z&&(this.z=v.z),v.w<this.w&&(this.w=v.w),this}maximizeInPlace(v){return v.x>this.x&&(this.x=v.x),v.y>this.y&&(this.y=v.y),v.z>this.z&&(this.z=v.z),v.w>this.w&&(this.w=v.w),this}floor(){return new Mt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fract(){return new Mt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){const v=this.length();return 0===v?this:this.scaleInPlace(1/v)}toVector3(){return new qt.Vector3(this.x,this.y,this.z)}clone(){return new Mt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,S,A,E){return this.x=v,this.y=S,this.z=A,this.w=E,this}set(v,S,A,E){return this.copyFromFloats(v,S,A,E)}setAll(v){return this.x=this.y=this.z=this.w=v,this}}Ut.Vector4=Mt,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.Matrix=void 0;const Gt=Lt,Yt=kt,Qt=Bt,Zt=Ut;class Dt{constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._updateIdentityStatus(!1)}get m(){return this._m}static get IdentityReadOnly(){return Dt._identityReadOnly}static FromArray(v,S=0){const A=new Dt;return Dt.FromArrayToRef(v,S,A),A}static FromArrayToRef(v,S,A){for(let E=0;E<16;E++)A._m[E]=v[E+S];A._markAsUpdated()}static FromFloatArrayToRefScaled(v,S,A,E){for(let R=0;R<16;R++)E._m[R]=v[R+S]*A;E._markAsUpdated()}static FromValuesToRef(v,S,A,E,R,O,z,B,M,V,W,H,X,Q,Z,J,K){const $=K._m;$[0]=v,$[1]=S,$[2]=A,$[3]=E,$[4]=R,$[5]=O,$[6]=z,$[7]=B,$[8]=M,$[9]=V,$[10]=W,$[11]=H,$[12]=X,$[13]=Q,$[14]=Z,$[15]=J,K._markAsUpdated()}static FromValues(v,S,A,E,R,O,z,B,M,V,W,H,X,Q,Z,J){const K=new Dt,$=K._m;return $[0]=v,$[1]=S,$[2]=A,$[3]=E,$[4]=R,$[5]=O,$[6]=z,$[7]=B,$[8]=M,$[9]=V,$[10]=W,$[11]=H,$[12]=X,$[13]=Q,$[14]=Z,$[15]=J,K._markAsUpdated(),K}static Compose(v,S,A){const E=new Dt;return Dt.ComposeToRef(v,S,A,E),E}static ComposeToRef(v,S,A,E){Dt.ScalingToRef(v.x,v.y,v.z,Qt.MathTmp.Matrix[1]),S.toRotationMatrix(Qt.MathTmp.Matrix[0]),Qt.MathTmp.Matrix[1].multiplyToRef(Qt.MathTmp.Matrix[0],E),E.setTranslation(A)}static Identity(){const v=Dt.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return v._updateIdentityStatus(!0),v}static IdentityToRef(v){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,v),v._updateIdentityStatus(!0)}static Zero(){const v=Dt.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return v._updateIdentityStatus(!1),v}static RotationX(v){const S=new Dt;return Dt.RotationXToRef(v,S),S}static Invert(v){const S=new Dt;return v.invertToRef(S),S}static RotationXToRef(v,S){const A=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(1,0,0,0,0,E,A,0,0,-A,E,0,0,0,0,1,S),S._updateIdentityStatus(1===E&&0===A)}static RotationY(v){const S=new Dt;return Dt.RotationYToRef(v,S),S}static RotationYToRef(v,S){const A=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(E,0,-A,0,0,1,0,0,A,0,E,0,0,0,0,1,S),S._updateIdentityStatus(1===E&&0===A)}static RotationZ(v){const S=new Dt;return Dt.RotationZToRef(v,S),S}static RotationZToRef(v,S){const A=Math.sin(v),E=Math.cos(v);Dt.FromValuesToRef(E,A,0,0,-A,E,0,0,0,0,1,0,0,0,0,1,S),S._updateIdentityStatus(1===E&&0===A)}static RotationAxis(v,S){const A=new Dt;return Dt.RotationAxisToRef(v,S,A),A}static RotationAxisToRef(v,S,A){const E=Math.sin(-S),R=Math.cos(-S),O=1-R;v.normalize();const z=A._m;z[0]=v.x*v.x*O+R,z[1]=v.x*v.y*O-v.z*E,z[2]=v.x*v.z*O+v.y*E,z[3]=0,z[4]=v.y*v.x*O+v.z*E,z[5]=v.y*v.y*O+R,z[6]=v.y*v.z*O-v.x*E,z[7]=0,z[8]=v.z*v.x*O-v.y*E,z[9]=v.z*v.y*O+v.x*E,z[10]=v.z*v.z*O+R,z[11]=0,z[12]=0,z[13]=0,z[14]=0,z[15]=1,A._markAsUpdated()}static RotationYawPitchRoll(v,S,A){const E=new Dt;return Dt.RotationYawPitchRollToRef(v,S,A,E),E}static RotationYawPitchRollToRef(v,S,A,E){Yt.Quaternion.RotationYawPitchRollToRef(v,S,A,Qt.MathTmp.Quaternion[0]),Qt.MathTmp.Quaternion[0].toRotationMatrix(E)}static Scaling(v,S,A){const E=new Dt;return Dt.ScalingToRef(v,S,A,E),E}static ScalingToRef(v,S,A,E){Dt.FromValuesToRef(v,0,0,0,0,S,0,0,0,0,A,0,0,0,0,1,E),E._updateIdentityStatus(1===v&&1===S&&1===A)}static Translation(v,S,A){const E=new Dt;return Dt.TranslationToRef(v,S,A,E),E}static TranslationToRef(v,S,A,E){Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v,S,A,1,E),E._updateIdentityStatus(0===v&&0===S&&0===A)}static Lerp(v,S,A){const E=new Dt;return Dt.LerpToRef(v,S,A,E),E}static LerpToRef(v,S,A,E){for(let R=0;R<16;R++)E._m[R]=v._m[R]*(1-A)+S._m[R]*A;E._markAsUpdated()}static DecomposeLerp(v,S,A){const E=new Dt;return Dt.DecomposeLerpToRef(v,S,A,E),E}static DecomposeLerpToRef(v,S,A,E){const R=Qt.MathTmp.Vector3[0],O=Qt.MathTmp.Quaternion[0],z=Qt.MathTmp.Vector3[1];v.decompose(R,O,z);const B=Qt.MathTmp.Vector3[2],M=Qt.MathTmp.Quaternion[1],V=Qt.MathTmp.Vector3[3];S.decompose(B,M,V);const W=Qt.MathTmp.Vector3[4];Gt.Vector3.LerpToRef(R,B,A,W);const H=Qt.MathTmp.Quaternion[2];Yt.Quaternion.SlerpToRef(O,M,A,H);const X=Qt.MathTmp.Vector3[5];Gt.Vector3.LerpToRef(z,V,A,X),Dt.ComposeToRef(W,H,X,E)}static LookAtLH(v,S,A){const E=new Dt;return Dt.LookAtLHToRef(v,S,A,E),E}static LookAtLHToRef(v,S,A,E){const R=Qt.MathTmp.Vector3[0],O=Qt.MathTmp.Vector3[1],z=Qt.MathTmp.Vector3[2];S.subtractToRef(v,z),z.normalize(),Gt.Vector3.CrossToRef(A,z,R);const B=R.lengthSquared();0===B?R.x=1:R.normalizeFromLength(Math.sqrt(B)),Gt.Vector3.CrossToRef(z,R,O),O.normalize();const M=-Gt.Vector3.Dot(R,v),V=-Gt.Vector3.Dot(O,v),W=-Gt.Vector3.Dot(z,v);Dt.FromValuesToRef(R.x,O.x,z.x,0,R.y,O.y,z.y,0,R.z,O.z,z.z,0,M,V,W,1,E)}static LookAtRH(v,S,A){const E=new Dt;return Dt.LookAtRHToRef(v,S,A,E),E}static LookAtRHToRef(v,S,A,E){const R=Qt.MathTmp.Vector3[0],O=Qt.MathTmp.Vector3[1],z=Qt.MathTmp.Vector3[2];v.subtractToRef(S,z),z.normalize(),Gt.Vector3.CrossToRef(A,z,R);const B=R.lengthSquared();0===B?R.x=1:R.normalizeFromLength(Math.sqrt(B)),Gt.Vector3.CrossToRef(z,R,O),O.normalize();const M=-Gt.Vector3.Dot(R,v),V=-Gt.Vector3.Dot(O,v),W=-Gt.Vector3.Dot(z,v);Dt.FromValuesToRef(R.x,O.x,z.x,0,R.y,O.y,z.y,0,R.z,O.z,z.z,0,M,V,W,1,E)}static OrthoLH(v,S,A,E){const R=new Dt;return Dt.OrthoLHToRef(v,S,A,E,R),R}static OrthoLHToRef(v,S,A,E,R){const O=2/v,z=2/S,B=2/(E-A),M=-(E+A)/(E-A);Dt.FromValuesToRef(O,0,0,0,0,z,0,0,0,0,B,0,0,0,M,1,R),R._updateIdentityStatus(1===O&&1===z&&1===B&&0===M)}static OrthoOffCenterLH(v,S,A,E,R,O){const z=new Dt;return Dt.OrthoOffCenterLHToRef(v,S,A,E,R,O,z),z}static OrthoOffCenterLHToRef(v,S,A,E,R,O,z){const B=2/(S-v),M=2/(E-A),V=2/(O-R),W=-(O+R)/(O-R),H=(v+S)/(v-S),X=(E+A)/(A-E);Dt.FromValuesToRef(B,0,0,0,0,M,0,0,0,0,V,0,H,X,W,1,z),z._markAsUpdated()}static OrthoOffCenterRH(v,S,A,E,R,O){const z=new Dt;return Dt.OrthoOffCenterRHToRef(v,S,A,E,R,O,z),z}static OrthoOffCenterRHToRef(v,S,A,E,R,O,z){Dt.OrthoOffCenterLHToRef(v,S,A,E,R,O,z),z._m[10]*=-1}static PerspectiveLH(v,S,A,E){const R=new Dt,O=2*A/v,z=2*A/S,B=(E+A)/(E-A),M=-2*E*A/(E-A);return Dt.FromValuesToRef(O,0,0,0,0,z,0,0,0,0,B,1,0,0,M,0,R),R._updateIdentityStatus(!1),R}static PerspectiveFovLH(v,S,A,E){const R=new Dt;return Dt.PerspectiveFovLHToRef(v,S,A,E,R),R}static PerspectiveFovLHToRef(v,S,A,E,R,O=!0){const z=A,B=E,M=1/Math.tan(.5*v),V=O?M/S:M,W=O?M:M*S,H=(B+z)/(B-z),X=-2*B*z/(B-z);Dt.FromValuesToRef(V,0,0,0,0,W,0,0,0,0,H,1,0,0,X,0,R),R._updateIdentityStatus(!1)}static PerspectiveFovRH(v,S,A,E){const R=new Dt;return Dt.PerspectiveFovRHToRef(v,S,A,E,R),R}static PerspectiveFovRHToRef(v,S,A,E,R,O=!0){const z=A,B=E,M=1/Math.tan(.5*v),V=O?M/S:M,W=O?M:M*S,H=-(B+z)/(B-z),X=-2*B*z/(B-z);Dt.FromValuesToRef(V,0,0,0,0,W,0,0,0,0,H,-1,0,0,X,0,R),R._updateIdentityStatus(!1)}static PerspectiveFovWebVRToRef(v,S,A,E,R=!1){const O=R?-1:1,z=Math.tan(v.upDegrees*Math.PI/180),B=Math.tan(v.downDegrees*Math.PI/180),M=Math.tan(v.leftDegrees*Math.PI/180),V=Math.tan(v.rightDegrees*Math.PI/180),W=2/(M+V),H=2/(z+B),X=E._m;X[0]=W,X[1]=X[2]=X[3]=X[4]=0,X[5]=H,X[6]=X[7]=0,X[8]=(M-V)*W*.5,X[9]=-(z-B)*H*.5,X[10]=-A/(S-A),X[11]=1*O,X[12]=X[13]=X[15]=0,X[14]=-2*A*S/(A-S),E._markAsUpdated()}static GetAsMatrix2x2(v){return[v._m[0],v._m[1],v._m[4],v._m[5]]}static GetAsMatrix3x3(v){return[v._m[0],v._m[1],v._m[2],v._m[4],v._m[5],v._m[6],v._m[8],v._m[9],v._m[10]]}static Transpose(v){const S=new Dt;return Dt.TransposeToRef(v,S),S}static TransposeToRef(v,S){const A=S._m,E=v._m;A[0]=E[0],A[1]=E[4],A[2]=E[8],A[3]=E[12],A[4]=E[1],A[5]=E[5],A[6]=E[9],A[7]=E[13],A[8]=E[2],A[9]=E[6],A[10]=E[10],A[11]=E[14],A[12]=E[3],A[13]=E[7],A[14]=E[11],A[15]=E[15],S._updateIdentityStatus(v._isIdentity,v._isIdentityDirty)}static Reflection(v){const S=new Dt;return Dt.ReflectionToRef(v,S),S}static ReflectionToRef(v,S){v.normalize();const A=v.normal.x,E=v.normal.y,R=v.normal.z,O=-2*A,z=-2*E,B=-2*R;Dt.FromValuesToRef(O*A+1,z*A,B*A,0,O*E,z*E+1,B*E,0,O*R,z*R,B*R+1,0,O*v.d,z*v.d,B*v.d,1,S)}static FromXYZAxesToRef(v,S,A,E){Dt.FromValuesToRef(v.x,v.y,v.z,0,S.x,S.y,S.z,0,A.x,A.y,A.z,0,0,0,0,1,E)}static FromQuaternionToRef(v,S){const A=v.x*v.x,E=v.y*v.y,R=v.z*v.z,O=v.x*v.y,z=v.z*v.w,B=v.z*v.x,M=v.y*v.w,V=v.y*v.z,W=v.x*v.w;S._m[0]=1-2*(E+R),S._m[1]=2*(O+z),S._m[2]=2*(B-M),S._m[3]=0,S._m[4]=2*(O-z),S._m[5]=1-2*(R+A),S._m[6]=2*(V+W),S._m[7]=0,S._m[8]=2*(B+M),S._m[9]=2*(V-W),S._m[10]=1-2*(E+A),S._m[11]=0,S._m[12]=0,S._m[13]=0,S._m[14]=0,S._m[15]=1,S._markAsUpdated()}_markAsUpdated(){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const v=this._m;this._isIdentity=1===v[0]&&0===v[1]&&0===v[2]&&0===v[3]&&0===v[4]&&1===v[5]&&0===v[6]&&0===v[7]&&0===v[8]&&0===v[9]&&1===v[10]&&0===v[11]&&0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const v=this._m,S=v[0],A=v[1],E=v[2],R=v[3],O=v[4],z=v[5],B=v[6],M=v[7],V=v[8],W=v[9],H=v[10],X=v[11],Q=v[12],Z=v[13],J=v[14],K=v[15],$=H*K-J*X,et=W*K-Z*X,nt=W*J-Z*H,it=V*K-Q*X,ot=V*J-H*Q,rt=V*Z-Q*W;return S*+(z*$-B*et+M*nt)+A*-(O*$-B*it+M*ot)+E*+(O*et-z*it+M*rt)+R*-(O*nt-z*ot+B*rt)}toArray(){return this._m}asArray(){return this._m}invert(){return this.invertToRef(this),this}reset(){return Dt.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(v){const S=new Dt;return this.addToRef(v,S),S}addToRef(v,S){for(let A=0;A<16;A++)S._m[A]=this._m[A]+v._m[A];return S._markAsUpdated(),this}addToSelf(v){for(let S=0;S<16;S++)this._m[S]+=v._m[S];return this._markAsUpdated(),this}invertToRef(v){if(!0===this._isIdentity)return Dt.IdentityToRef(v),this;const S=this._m,A=S[0],E=S[1],R=S[2],O=S[3],z=S[4],B=S[5],M=S[6],V=S[7],W=S[8],H=S[9],X=S[10],Q=S[11],Z=S[12],J=S[13],K=S[14],$=S[15],et=X*$-K*Q,nt=H*$-J*Q,it=H*K-J*X,ot=W*$-Z*Q,rt=W*K-X*Z,st=W*J-Z*H,at=+(B*et-M*nt+V*it),ht=-(z*et-M*ot+V*rt),lt=+(z*nt-B*ot+V*st),ct=-(z*it-B*rt+M*st),ut=A*at+E*ht+R*lt+O*ct;if(0===ut)return v.copyFrom(this),this;const dt=1/ut,pt=M*$-K*V,ft=B*$-J*V,gt=B*K-J*M,yt=z*$-Z*V,vt=z*K-Z*M,bt=z*J-Z*B,Tt=M*Q-X*V,wt=B*Q-H*V,Ct=B*X-H*M,xt=z*Q-W*V,St=z*X-W*M,At=z*H-W*B,_t=-(E*et-R*nt+O*it),Pt=+(A*et-R*ot+O*rt),It=-(A*nt-E*ot+O*st),Rt=+(A*it-E*rt+R*st),Ot=+(E*pt-R*ft+O*gt),zt=-(A*pt-R*yt+O*vt),Bt=+(A*ft-E*yt+O*bt),Nt=-(A*gt-E*vt+R*bt),Lt=-(E*Tt-R*wt+O*Ct),kt=+(A*Tt-R*xt+O*St),Ft=-(A*wt-E*xt+O*At),Ut=+(A*Ct-E*St+R*At);return Dt.FromValuesToRef(at*dt,_t*dt,Ot*dt,Lt*dt,ht*dt,Pt*dt,zt*dt,kt*dt,lt*dt,It*dt,Bt*dt,Ft*dt,ct*dt,Rt*dt,Nt*dt,Ut*dt,v),this}addAtIndex(v,S){return this._m[v]+=S,this._markAsUpdated(),this}multiplyAtIndex(v,S){return this._m[v]*=S,this._markAsUpdated(),this}setTranslationFromFloats(v,S,A){return this._m[12]=v,this._m[13]=S,this._m[14]=A,this._markAsUpdated(),this}setTranslation(v){return this.setTranslationFromFloats(v.x,v.y,v.z)}getTranslation(){return new Gt.Vector3(this._m[12],this._m[13],this._m[14])}getTranslationToRef(v){return v.x=this._m[12],v.y=this._m[13],v.z=this._m[14],this}removeRotationAndScaling(){const v=this.m;return Dt.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,v[12],v[13],v[14],v[15],this),this._updateIdentityStatus(0===v[12]&&0===v[13]&&0===v[14]&&1===v[15]),this}multiply(v){const S=new Dt;return this.multiplyToRef(v,S),S}copyFrom(v){v.copyToArray(this._m);const S=v;return this._updateIdentityStatus(S._isIdentity,S._isIdentityDirty,S._isIdentity3x2,S._isIdentity3x2Dirty),this}copyToArray(v,S=0){for(let A=0;A<16;A++)v[S+A]=this._m[A];return this}multiplyToRef(v,S){return this._isIdentity?(S.copyFrom(v),this):v._isIdentity?(S.copyFrom(this),this):(this.multiplyToArray(v,S._m,0),S._markAsUpdated(),this)}multiplyToArray(v,S,A){const E=this._m,R=v.m,O=E[0],z=E[1],B=E[2],M=E[3],V=E[4],W=E[5],H=E[6],X=E[7],Q=E[8],Z=E[9],J=E[10],K=E[11],$=E[12],et=E[13],nt=E[14],it=E[15],ot=R[0],rt=R[1],st=R[2],at=R[3],ht=R[4],lt=R[5],ct=R[6],ut=R[7],dt=R[8],pt=R[9],ft=R[10],gt=R[11],yt=R[12],vt=R[13],bt=R[14],Tt=R[15];return S[A]=O*ot+z*ht+B*dt+M*yt,S[A+1]=O*rt+z*lt+B*pt+M*vt,S[A+2]=O*st+z*ct+B*ft+M*bt,S[A+3]=O*at+z*ut+B*gt+M*Tt,S[A+4]=V*ot+W*ht+H*dt+X*yt,S[A+5]=V*rt+W*lt+H*pt+X*vt,S[A+6]=V*st+W*ct+H*ft+X*bt,S[A+7]=V*at+W*ut+H*gt+X*Tt,S[A+8]=Q*ot+Z*ht+J*dt+K*yt,S[A+9]=Q*rt+Z*lt+J*pt+K*vt,S[A+10]=Q*st+Z*ct+J*ft+K*bt,S[A+11]=Q*at+Z*ut+J*gt+K*Tt,S[A+12]=$*ot+et*ht+nt*dt+it*yt,S[A+13]=$*rt+et*lt+nt*pt+it*vt,S[A+14]=$*st+et*ct+nt*ft+it*bt,S[A+15]=$*at+et*ut+nt*gt+it*Tt,this}equals(v){const S=v;if(!S)return!1;if((this._isIdentity||S._isIdentity)&&!this._isIdentityDirty&&!S._isIdentityDirty)return this._isIdentity&&S._isIdentity;const A=this.m,E=S.m;return A[0]===E[0]&&A[1]===E[1]&&A[2]===E[2]&&A[3]===E[3]&&A[4]===E[4]&&A[5]===E[5]&&A[6]===E[6]&&A[7]===E[7]&&A[8]===E[8]&&A[9]===E[9]&&A[10]===E[10]&&A[11]===E[11]&&A[12]===E[12]&&A[13]===E[13]&&A[14]===E[14]&&A[15]===E[15]}clone(){const v=new Dt;return v.copyFrom(this),v}getClassName(){return"Matrix"}getHashCode(){let v=this._m[0]||0;for(let S=1;S<16;S++)v=397*v^(this._m[S]||0);return v}decompose(v,S,A){if(this._isIdentity)return A&&A.setAll(0),v&&v.setAll(1),S&&S.copyFromFloats(0,0,0,1),!0;const E=this._m;A&&A.copyFromFloats(E[12],E[13],E[14]);const R=v||Qt.MathTmp.Vector3[0];if(R.x=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),R.y=Math.sqrt(E[4]*E[4]+E[5]*E[5]+E[6]*E[6]),R.z=Math.sqrt(E[8]*E[8]+E[9]*E[9]+E[10]*E[10]),this.determinant()<=0&&(R.y*=-1),0===R.x||0===R.y||0===R.z)return S&&S.copyFromFloats(0,0,0,1),!1;if(S){const v=1/R.x,A=1/R.y,O=1/R.z;Dt.FromValuesToRef(E[0]*v,E[1]*v,E[2]*v,0,E[4]*A,E[5]*A,E[6]*A,0,E[8]*O,E[9]*O,E[10]*O,0,0,0,0,1,Qt.MathTmp.Matrix[0]),Yt.Quaternion.FromRotationMatrixToRef(Qt.MathTmp.Matrix[0],S)}return!0}getRow(v){if(v<0||v>3)return null;const S=4*v;return new Zt.Vector4(this._m[S+0],this._m[S+1],this._m[S+2],this._m[S+3])}setRow(v,S){return this.setRowFromFloats(v,S.x,S.y,S.z,S.w)}transpose(){return Dt.Transpose(this)}transposeToRef(v){return Dt.TransposeToRef(this,v),this}setRowFromFloats(v,S,A,E,R){if(v<0||v>3)return this;const O=4*v;return this._m[O+0]=S,this._m[O+1]=A,this._m[O+2]=E,this._m[O+3]=R,this._markAsUpdated(),this}scale(v){const S=new Dt;return this.scaleToRef(v,S),S}scaleToRef(v,S){for(let A=0;A<16;A++)S._m[A]=this._m[A]*v;return S._markAsUpdated(),this}scaleAndAddToRef(v,S){for(let A=0;A<16;A++)S._m[A]+=this._m[A]*v;return S._markAsUpdated(),this}toNormalMatrix(v){const S=Qt.MathTmp.Matrix[0];this.invertToRef(S),S.transposeToRef(v);const A=v._m;Dt.FromValuesToRef(A[0],A[1],A[2],0,A[4],A[5],A[6],0,A[8],A[9],A[10],0,0,0,0,1,v)}getRotationMatrix(){const v=new Dt;return this.getRotationMatrixToRef(v),v}getRotationMatrixToRef(v){const S=Qt.MathTmp.Vector3[0];if(!this.decompose(S))return Dt.IdentityToRef(v),this;const A=this._m,E=1/S.x,R=1/S.y,O=1/S.z;return Dt.FromValuesToRef(A[0]*E,A[1]*E,A[2]*E,0,A[4]*R,A[5]*R,A[6]*R,0,A[8]*O,A[9]*O,A[10]*O,0,0,0,0,1,v),this}toggleModelMatrixHandInPlace(){const v=this._m;v[2]*=-1,v[6]*=-1,v[8]*=-1,v[9]*=-1,v[14]*=-1,this._markAsUpdated()}toggleProjectionMatrixHandInPlace(){const v=this._m;v[8]*=-1,v[9]*=-1,v[10]*=-1,v[11]*=-1,this._markAsUpdated()}_updateIdentityStatus(v,S=!1,A=!1,E=!0){this.updateFlag=Dt._updateFlagSeed++,this._isIdentity=v,this._isIdentity3x2=v||A,this._isIdentityDirty=!this._isIdentity&&S,this._isIdentity3x2Dirty=!this._isIdentity3x2&&E}}Ft.Matrix=Dt,Dt._updateFlagSeed=0,Dt._identityReadOnly=Dt.Identity(),Object.defineProperty(kt,"__esModule",{value:!0}),kt.Quaternion=void 0;const Jt=Ft,Kt=Lt,$t=Bt,ee=zt,ne=Vt;class jt{constructor(v=0,S=0,A=0,E=1){this.x=v,this.y=S,this.z=A,this.w=E}static FromRotationMatrix(v){const S=new jt;return jt.FromRotationMatrixToRef(v,S),S}static FromRotationMatrixToRef(v,S){const A=v.m,E=A[0],R=A[4],O=A[8],z=A[1],B=A[5],M=A[9],V=A[2],W=A[6],H=A[10],X=E+B+H;let Q;X>0?(Q=.5/Math.sqrt(X+1),S.w=.25/Q,S.x=(W-M)*Q,S.y=(O-V)*Q,S.z=(z-R)*Q):E>B&&E>H?(Q=2*Math.sqrt(1+E-B-H),S.w=(W-M)/Q,S.x=.25*Q,S.y=(R+z)/Q,S.z=(O+V)/Q):B>H?(Q=2*Math.sqrt(1+B-E-H),S.w=(O-V)/Q,S.x=(R+z)/Q,S.y=.25*Q,S.z=(M+W)/Q):(Q=2*Math.sqrt(1+H-E-B),S.w=(z-R)/Q,S.x=(O+V)/Q,S.y=(M+W)/Q,S.z=.25*Q)}static Dot(v,S){return v.x*S.x+v.y*S.y+v.z*S.z+v.w*S.w}static AreClose(v,S){return jt.Dot(v,S)>=0}static Zero(){return new jt(0,0,0,0)}static Inverse(v){return new jt(-v.x,-v.y,-v.z,v.w)}static IsIdentity(v){return v&&0===v.x&&0===v.y&&0===v.z&&1===v.w}static RotationAxis(v,S){const A=S*ee.DEG2RAD;return jt.RotationAxisToRef(v,A,new jt)}static RotationAxisToRef(v,S,A){const E=S*ee.DEG2RAD,R=Math.sin(E/2);return v.normalize(),A.w=Math.cos(E/2),A.x=v.x*R,A.y=v.y*R,A.z=v.z*R,A}static FromArray(v,S=0){return new jt(v[S],v[S+1],v[S+2],v[S+3])}static FromEulerAnglesRef(v,S,A,E){return jt.RotationYawPitchRollToRef(S*ee.DEG2RAD,v*ee.DEG2RAD,A*ee.DEG2RAD,E)}static RotationYawPitchRoll(v,S,A){const E=new jt;return jt.RotationYawPitchRollToRef(v,S,A,E),E}static RotationYawPitchRollToRef(v,S,A,E){const R=.5*S,O=.5*v,z=.5*A,B=Math.cos(R),M=Math.cos(O),V=Math.cos(z),W=Math.sin(R),H=Math.sin(O),X=Math.sin(z);E.x=M*W*V+H*B*X,E.y=H*B*V-M*W*X,E.z=M*B*X-H*W*V,E.w=M*B*V+H*W*X}static RotationAlphaBetaGamma(v,S,A){const E=new jt;return jt.RotationAlphaBetaGammaToRef(v,S,A,E),E}static RotationAlphaBetaGammaToRef(v,S,A,E){const R=.5*(A+v),O=.5*(A-v),z=.5*S;E.x=Math.cos(O)*Math.sin(z),E.y=Math.sin(O)*Math.sin(z),E.z=Math.sin(R)*Math.cos(z),E.w=Math.cos(R)*Math.cos(z)}static RotationQuaternionFromAxis(v,S,A){const E=new jt(0,0,0,0);return jt.RotationQuaternionFromAxisToRef(v,S,A,E),E}static RotationQuaternionFromAxisToRef(v,S,A,E){const R=$t.MathTmp.Matrix[0];Jt.Matrix.FromXYZAxesToRef(v.normalize(),S.normalize(),A.normalize(),R),jt.FromRotationMatrixToRef(R,E)}static Slerp(v,S,A){const E=jt.Identity;return jt.SlerpToRef(v,S,A,E),E}static SlerpToRef(v,S,A,E){let R,O,z=v.x*S.x+v.y*S.y+v.z*S.z+v.w*S.w,B=!1;if(z<0&&(B=!0,z=-z),z>.999999)O=1-A,R=B?-A:A;else{const v=Math.acos(z),S=1/Math.sin(v);O=Math.sin((1-A)*v)*S,R=B?-Math.sin(A*v)*S:Math.sin(A*v)*S}E.x=O*v.x+R*S.x,E.y=O*v.y+R*S.y,E.z=O*v.z+R*S.z,E.w=O*v.w+R*S.w}static Hermite(v,S,A,E,R){const O=R*R,z=R*O,B=2*z-3*O+1,M=-2*z+3*O,V=z-2*O+R,W=z-O,H=v.x*B+A.x*M+S.x*V+E.x*W,X=v.y*B+A.y*M+S.y*V+E.y*W,Q=v.z*B+A.z*M+S.z*V+E.z*W,Z=v.w*B+A.w*M+S.w*V+E.w*W;return new jt(H,X,Q,Z)}static get Identity(){return new jt(0,0,0,1)}static Angle(v,S){const A=jt.Dot(v,S);return 2*Math.acos(Math.min(Math.abs(A),1))*ee.RAD2DEG}static Euler(v,S,A){return jt.RotationYawPitchRoll(S*ee.DEG2RAD,v*ee.DEG2RAD,A*ee.DEG2RAD)}static LookRotation(v,S=$t.MathTmp.staticUp){const A=Kt.Vector3.Normalize(v),E=Kt.Vector3.Normalize(Kt.Vector3.Cross(S,A)),R=Kt.Vector3.Cross(A,E),O=E.x,z=E.y,B=E.z,M=R.x,V=R.y,W=R.z,H=A.x,X=A.y,Q=A.z,Z=O+V+Q,J=new jt;if(Z>0){let v=Math.sqrt(Z+1);return J.w=.5*v,v=.5/v,J.x=(W-X)*v,J.y=(H-B)*v,J.z=(z-M)*v,J}if(O>=V&&O>=Q){const v=Math.sqrt(1+O-V-Q),S=.5/v;return J.x=.5*v,J.y=(z+M)*S,J.z=(B+H)*S,J.w=(W-X)*S,J}if(V>Q){const v=Math.sqrt(1+V-O-Q),S=.5/v;return J.x=(M+z)*S,J.y=.5*v,J.z=(X+W)*S,J.w=(H-B)*S,J}const K=Math.sqrt(1+Q-O-V),$=.5/K;return J.x=(H+B)*$,J.y=(X+W)*$,J.z=.5*K,J.w=(z-M)*$,J}static RotateTowards(v,S,A){const E=jt.Angle(v,S);if(0===E)return S;const R=Math.min(1,A/E);return jt.Slerp(v,S,R)}static FromToRotation(v,S,A=$t.MathTmp.staticUp){const E=v.normalize(),R=S.normalize(),O=Kt.Vector3.Cross(E,R),z=Math.sqrt(E.lengthSquared()*R.lengthSquared())+Kt.Vector3.Dot(E,R);return O.lengthSquared()<1e-4?Math.abs(z)<1e-4?new jt(A.x,A.y,A.z,0).normalized:jt.Identity:new jt(O.x,O.y,O.z,z).normalized}get normalized(){return this.normalize()}setFromToRotation(v,S,A=$t.MathTmp.staticUp){const E=jt.FromToRotation(v,S,A);this.x=E.x,this.y=E.y,this.z=E.z,this.w=E.w}set eulerAngles(v){this.setEuler(v.x,v.y,v.z)}get eulerAngles(){const v=new Kt.Vector3,S=this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w,A=this.x*this.w-this.y*this.z;return A>.4995*S?(v.x=Math.PI/2,v.y=2*Math.atan2(this.y,this.x),v.z=0):A<-.4995*S?(v.x=-Math.PI/2,v.y=-2*Math.atan2(this.y,this.x),v.z=0):(v.x=Math.asin(2*(this.w*this.x-this.y*this.z)),v.y=Math.atan2(2*this.w*this.y+2*this.z*this.x,1-2*(this.x*this.x+this.y*this.y)),v.z=Math.atan2(2*this.w*this.z+2*this.x*this.y,1-2*(this.z*this.z+this.x*this.x))),v.x*=ee.RAD2DEG,v.y*=ee.RAD2DEG,v.z*=ee.RAD2DEG,v.x=ne.Scalar.Repeat(v.x,360),v.y=ne.Scalar.Repeat(v.y,360),v.z=ne.Scalar.Repeat(v.z,360),v}toString(){return`(${this.x}, ${this.y}, ${this.z}, ${this.w})`}get length(){return Math.sqrt(this.lengthSquared)}get lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}getClassName(){return"Quaternion"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v=397*v^(this.w||0),v}asArray(){return[this.x,this.y,this.z,this.w]}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z&&this.w===v.w}clone(){return new jt(this.x,this.y,this.z,this.w)}copyFrom(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}copyFromFloats(v,S,A,E){return this.x=v,this.y=S,this.z=A,this.w=E,this}set(v,S,A,E){return this.copyFromFloats(v,S,A,E)}setEuler(v,S,A){return jt.RotationYawPitchRollToRef(S*ee.DEG2RAD,v*ee.DEG2RAD,A*ee.DEG2RAD,this),this}add(v){return new jt(this.x+v.x,this.y+v.y,this.z+v.z,this.w+v.w)}addInPlace(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this.w+=v.w,this}subtract(v){return new jt(this.x-v.x,this.y-v.y,this.z-v.z,this.w-v.w)}scale(v){return new jt(this.x*v,this.y*v,this.z*v,this.w*v)}scaleToRef(v,S){return S.x=this.x*v,S.y=this.y*v,S.z=this.z*v,S.w=this.w*v,this}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}scaleAndAddToRef(v,S){return S.x+=this.x*v,S.y+=this.y*v,S.z+=this.z*v,S.w+=this.w*v,this}multiply(v){const S=new jt(0,0,0,1);return this.multiplyToRef(v,S),S}multiplyToRef(v,S){const A=this.x*v.w+this.y*v.z-this.z*v.y+this.w*v.x,E=-this.x*v.z+this.y*v.w+this.z*v.x+this.w*v.y,R=this.x*v.y-this.y*v.x+this.z*v.w+this.w*v.z,O=-this.x*v.x-this.y*v.y-this.z*v.z+this.w*v.w;return S.copyFromFloats(A,E,R,O),this}multiplyInPlace(v){return this.multiplyToRef(v,this),this}conjugateToRef(v){return v.copyFromFloats(-this.x,-this.y,-this.z,this.w),this}conjugateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this}conjugate(){return new jt(-this.x,-this.y,-this.z,this.w)}normalize(){const v=1/this.length;return this.x*=v,this.y*=v,this.z*=v,this.w*=v,this}angleAxis(v,S){if(0===S.lengthSquared())return jt.Identity;const A=jt.Identity;let E=v*ee.DEG2RAD;E*=.5;let R=S.normalize();return R=S.scaleInPlace(Math.sin(E)),A.x=R.x,A.y=R.y,A.z=R.z,A.w=Math.cos(E),A.normalize()}toRotationMatrix(v){return Jt.Matrix.FromQuaternionToRef(this,v),this}fromRotationMatrix(v){return jt.FromRotationMatrixToRef(v,this),this}}kt.Quaternion=jt,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.Vector3=void 0;const ie=Bt,oe=zt,se=kt,ae=Vt;class Xt{constructor(v=0,S=0,A=0){this.x=v,this.y=S,this.z=A}get isNonUniform(){const v=Math.abs(this.x),S=Math.abs(this.y);if(v!==S)return!0;const A=Math.abs(this.z);return v!==A||S!==A}static Add(v,S){return new Xt(v.x,v.y,v.z).addInPlace(S)}static GetClipFactor(v,S,A,E){const R=Xt.Dot(v,A)-E;return R/(R-(Xt.Dot(S,A)-E))}static GetAngleBetweenVectors(v,S,A){const E=v.normalizeToRef(ie.MathTmp.Vector3[1]),R=S.normalizeToRef(ie.MathTmp.Vector3[2]),O=Xt.Dot(E,R),z=ie.MathTmp.Vector3[3];return Xt.CrossToRef(E,R,z),Xt.Dot(z,A)>0?Math.acos(O):-Math.acos(O)}static FromArray(v,S=0){return new Xt(v[S],v[S+1],v[S+2])}static FromFloatArray(v,S){return Xt.FromArray(v,S)}static FromArrayToRef(v,S,A){A.x=v[S],A.y=v[S+1],A.z=v[S+2]}static FromFloatArrayToRef(v,S,A){return Xt.FromArrayToRef(v,S,A)}static FromFloatsToRef(v,S,A,E){E.copyFromFloats(v,S,A)}static Zero(){return new Xt(0,0,0)}static One(){return new Xt(1,1,1)}static Up(){return new Xt(0,1,0)}static Down(){return new Xt(0,-1,0)}static Forward(){return new Xt(0,0,1)}static Backward(){return new Xt(0,0,-1)}static Right(){return new Xt(1,0,0)}static Left(){return new Xt(-1,0,0)}static TransformCoordinates(v,S){const A=Xt.Zero();return Xt.TransformCoordinatesToRef(v,S,A),A}static TransformCoordinatesToRef(v,S,A){return Xt.TransformCoordinatesFromFloatsToRef(v.x,v.y,v.z,S,A)}static TransformCoordinatesFromFloatsToRef(v,S,A,E,R){const O=E.m,z=v*O[0]+S*O[4]+A*O[8]+O[12],B=v*O[1]+S*O[5]+A*O[9]+O[13],M=v*O[2]+S*O[6]+A*O[10]+O[14],V=1/(v*O[3]+S*O[7]+A*O[11]+O[15]);R.x=z*V,R.y=B*V,R.z=M*V}static TransformNormal(v,S){const A=Xt.Zero();return Xt.TransformNormalToRef(v,S,A),A}static TransformNormalToRef(v,S,A){this.TransformNormalFromFloatsToRef(v.x,v.y,v.z,S,A)}static TransformNormalFromFloatsToRef(v,S,A,E,R){const O=E.m;R.x=v*O[0]+S*O[4]+A*O[8],R.y=v*O[1]+S*O[5]+A*O[9],R.z=v*O[2]+S*O[6]+A*O[10]}static CatmullRom(v,S,A,E,R){const O=R*R,z=R*O,B=.5*(2*S.x+(-v.x+A.x)*R+(2*v.x-5*S.x+4*A.x-E.x)*O+(-v.x+3*S.x-3*A.x+E.x)*z),M=.5*(2*S.y+(-v.y+A.y)*R+(2*v.y-5*S.y+4*A.y-E.y)*O+(-v.y+3*S.y-3*A.y+E.y)*z),V=.5*(2*S.z+(-v.z+A.z)*R+(2*v.z-5*S.z+4*A.z-E.z)*O+(-v.z+3*S.z-3*A.z+E.z)*z);return new Xt(B,M,V)}static Clamp(v,S,A){const E=new Xt;return Xt.ClampToRef(v,S,A,E),E}static ClampToRef(v,S,A,E){let R=v.x;R=R>A.x?A.x:R,R=R<S.x?S.x:R;let O=v.y;O=O>A.y?A.y:O,O=O<S.y?S.y:O;let z=v.z;z=z>A.z?A.z:z,z=z<S.z?S.z:z,E.copyFromFloats(R,O,z)}static Hermite(v,S,A,E,R){const O=R*R,z=R*O,B=2*z-3*O+1,M=-2*z+3*O,V=z-2*O+R,W=z-O,H=v.x*B+A.x*M+S.x*V+E.x*W,X=v.y*B+A.y*M+S.y*V+E.y*W,Q=v.z*B+A.z*M+S.z*V+E.z*W;return new Xt(H,X,Q)}static Lerp(v,S,A){const E=new Xt(0,0,0);return Xt.LerpToRef(v,S,A,E),E}static LerpToRef(v,S,A,E){E.x=v.x+(S.x-v.x)*A,E.y=v.y+(S.y-v.y)*A,E.z=v.z+(S.z-v.z)*A}static Dot(v,S){return v.x*S.x+v.y*S.y+v.z*S.z}static Cross(v,S){const A=Xt.Zero();return Xt.CrossToRef(v,S,A),A}static CrossToRef(v,S,A){const E=v.y*S.z-v.z*S.y,R=v.z*S.x-v.x*S.z,O=v.x*S.y-v.y*S.x;A.copyFromFloats(E,R,O)}static Normalize(v){const S=Xt.Zero();return Xt.NormalizeToRef(v,S),S}static NormalizeToRef(v,S){v.normalizeToRef(S)}static Minimize(v,S){const A=new Xt(v.x,v.y,v.z);return A.minimizeInPlace(S),A}static Maximize(v,S){const A=new Xt(v.x,v.y,v.z);return A.maximizeInPlace(S),A}static Distance(v,S){return Math.sqrt(Xt.DistanceSquared(v,S))}static DistanceSquared(v,S){const A=v.x-S.x,E=v.y-S.y,R=v.z-S.z;return A*A+E*E+R*R}static Center(v,S){const A=Xt.Add(v,S);return A.scaleInPlace(.5),A}static RotationFromAxis(v,S,A){const E=Xt.Zero();return Xt.RotationFromAxisToRef(v,S,A,E),E}static RotationFromAxisToRef(v,S,A,E){const R=ie.MathTmp.Quaternion[0];se.Quaternion.RotationQuaternionFromAxisToRef(v,S,A,R),E.copyFrom(R.eulerAngles)}toString(){return`(${this.x}, ${this.y}, ${this.z})`}getClassName(){return"Vector3"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v=397*v^(this.z||0),v}asArray(){const v=[];return this.toArray(v,0),v}toArray(v,S=0){return v[S]=this.x,v[S+1]=this.y,v[S+2]=this.z,this}toQuaternion(){return se.Quaternion.Identity.setEuler(this.y,this.x,this.z)}addInPlace(v){return this.addInPlaceFromFloats(v.x,v.y,v.z)}addInPlaceFromFloats(v,S,A){return this.x+=v,this.y+=S,this.z+=A,this}add(v){return new Xt(this.x+v.x,this.y+v.y,this.z+v.z)}addToRef(v,S){return S.copyFromFloats(this.x+v.x,this.y+v.y,this.z+v.z)}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}subtract(v){return new Xt(this.x-v.x,this.y-v.y,this.z-v.z)}subtractToRef(v,S){return this.subtractFromFloatsToRef(v.x,v.y,v.z,S)}subtractFromFloats(v,S,A){return new Xt(this.x-v,this.y-S,this.z-A)}subtractFromFloatsToRef(v,S,A,E){return E.copyFromFloats(this.x-v,this.y-S,this.z-A)}applyMatrix4(v){this.applyMatrix4ToRef(v,this)}applyMatrix4ToRef(v,S){const{x:A,y:E,z:R}=this,{m:O}=v,z=1/(O[3]*A+O[7]*E+O[11]*R+O[15]);return S.x=(O[0]*A+O[4]*E+O[8]*R+O[12])*z,S.y=(O[1]*A+O[5]*E+O[9]*R+O[13])*z,S.z=(O[2]*A+O[6]*E+O[10]*R+O[14])*z,S}rotate(v){return this.rotateToRef(v,this)}rotateToRef(v,S){const{x:A,y:E,z:R}=this,{x:O,y:z,z:B,w:M}=v,V=M*A+z*R-B*E,W=M*E+B*A-O*R,H=M*R+O*E-z*A,X=-O*A-z*E-B*R;return S.x=V*M+X*-O+W*-B-H*-z,S.y=W*M+X*-z+H*-O-V*-B,S.z=H*M+X*-B+V*-z-W*-O,S}negate(){return new Xt(-this.x,-this.y,-this.z)}scaleInPlace(v){return this.x*=v,this.y*=v,this.z*=v,this}scale(v){return new Xt(this.x*v,this.y*v,this.z*v)}scaleToRef(v,S){return S.copyFromFloats(this.x*v,this.y*v,this.z*v)}scaleAndAddToRef(v,S){return S.addInPlaceFromFloats(this.x*v,this.y*v,this.z*v)}equals(v){return v&&this.x===v.x&&this.y===v.y&&this.z===v.z}equalsWithEpsilon(v,S=oe.Epsilon){return v&&ae.Scalar.WithinEpsilon(this.x,v.x,S)&&ae.Scalar.WithinEpsilon(this.y,v.y,S)&&ae.Scalar.WithinEpsilon(this.z,v.z,S)}equalsToFloats(v,S,A){return this.x===v&&this.y===S&&this.z===A}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this}multiply(v){return this.multiplyByFloats(v.x,v.y,v.z)}multiplyToRef(v,S){return S.copyFromFloats(this.x*v.x,this.y*v.y,this.z*v.z)}multiplyByFloats(v,S,A){return new Xt(this.x*v,this.y*S,this.z*A)}divide(v){return new Xt(this.x/v.x,this.y/v.y,this.z/v.z)}divideToRef(v,S){return S.copyFromFloats(this.x/v.x,this.y/v.y,this.z/v.z)}divideInPlace(v){return this.divideToRef(v,this)}minimizeInPlace(v){return this.minimizeInPlaceFromFloats(v.x,v.y,v.z)}maximizeInPlace(v){return this.maximizeInPlaceFromFloats(v.x,v.y,v.z)}minimizeInPlaceFromFloats(v,S,A){return v<this.x&&(this.x=v),S<this.y&&(this.y=S),A<this.z&&(this.z=A),this}maximizeInPlaceFromFloats(v,S,A){return v>this.x&&(this.x=v),S>this.y&&(this.y=S),A>this.z&&(this.z=A),this}floor(){return new Xt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fract(){return new Xt(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(v){return 0===v||1===v?this:this.scaleInPlace(1/v)}normalizeToNew(){const v=new Xt(0,0,0);return this.normalizeToRef(v),v}normalizeToRef(v){const S=this.length();return 0===S||1===S?v.copyFromFloats(this.x,this.y,this.z):this.scaleToRef(1/S,v)}clone(){return new Xt(this.x,this.y,this.z)}copyFrom(v){return this.copyFromFloats(v.x,v.y,v.z)}copyFromFloats(v,S,A){return this.x=v,this.y=S,this.z=A,this}set(v,S,A){return this.copyFromFloats(v,S,A)}setAll(v){return this.x=this.y=this.z=v,this}}Lt.Vector3=Xt,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.MathTmp=void 0;const he=Nt,le=Lt,ce=kt,ue=Ft;Bt.MathTmp={Vector3:(0,he.buildArray)(6,le.Vector3.Zero),Matrix:(0,he.buildArray)(2,ue.Matrix.Identity),Quaternion:(0,he.buildArray)(3,ce.Quaternion.Zero),staticUp:le.Vector3.Up(),tmpMatrix:ue.Matrix.Zero()};var de={};Object.defineProperty(de,"__esModule",{value:!0}),de.Angle=void 0;class te{constructor(v){this._radians=v,this._radians<0&&(this._radians+=2*Math.PI)}static BetweenTwoPoints(v,S){const A=S.subtract(v),E=Math.atan2(A.y,A.x);return new te(E)}static FromRadians(v){return new te(v)}static FromDegrees(v){return new te(v*Math.PI/180)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}}de.Angle=te;var fe={},me={};Object.defineProperty(me,"__esModule",{value:!0}),me.Vector2=void 0;const ye=zt,ve=Vt;class re{constructor(v=0,S=0){this.x=v,this.y=S}static Zero(){return new re(0,0)}static One(){return new re(1,1)}static Add(v,S){return new re(v.x,v.y).addInPlace(S)}static FromArray(v,S=0){return new re(v[S],v[S+1])}static FromArrayToRef(v,S,A){A.x=v[S],A.y=v[S+1]}static CatmullRom(v,S,A,E,R){const O=R*R,z=R*O,B=.5*(2*S.x+(-v.x+A.x)*R+(2*v.x-5*S.x+4*A.x-E.x)*O+(-v.x+3*S.x-3*A.x+E.x)*z),M=.5*(2*S.y+(-v.y+A.y)*R+(2*v.y-5*S.y+4*A.y-E.y)*O+(-v.y+3*S.y-3*A.y+E.y)*z);return new re(B,M)}static Clamp(v,S,A){let E=v.x;E=E>A.x?A.x:E,E=E<S.x?S.x:E;let R=v.y;return R=R>A.y?A.y:R,R=R<S.y?S.y:R,new re(E,R)}static Hermite(v,S,A,E,R){const O=R*R,z=R*O,B=2*z-3*O+1,M=-2*z+3*O,V=z-2*O+R,W=z-O,H=v.x*B+A.x*M+S.x*V+E.x*W,X=v.y*B+A.y*M+S.y*V+E.y*W;return new re(H,X)}static Lerp(v,S,A){const E=v.x+(S.x-v.x)*A,R=v.y+(S.y-v.y)*A;return new re(E,R)}static Dot(v,S){return v.x*S.x+v.y*S.y}static Normalize(v){const S=new re(v.x,v.y);return S.normalize(),S}static Minimize(v,S){const A=v.x<S.x?v.x:S.x,E=v.y<S.y?v.y:S.y;return new re(A,E)}static Maximize(v,S){const A=v.x>S.x?v.x:S.x,E=v.y>S.y?v.y:S.y;return new re(A,E)}static Transform(v,S){const A=re.Zero();return re.TransformToRef(v,S,A),A}static TransformToRef(v,S,A){const E=S.m,R=v.x*E[0]+v.y*E[4]+E[12],O=v.x*E[1]+v.y*E[5]+E[13];A.x=R,A.y=O}static PointInTriangle(v,S,A,E){const R=.5*(-A.y*E.x+S.y*(-A.x+E.x)+S.x*(A.y-E.y)+A.x*E.y),O=R<0?-1:1,z=(S.y*E.x-S.x*E.y+(E.y-S.y)*v.x+(S.x-E.x)*v.y)*O,B=(S.x*A.y-S.y*A.x+(S.y-A.y)*v.x+(A.x-S.x)*v.y)*O;return z>0&&B>0&&z+B<2*R*O}static Distance(v,S){return Math.sqrt(re.DistanceSquared(v,S))}static DistanceSquared(v,S){const A=v.x-S.x,E=v.y-S.y;return A*A+E*E}static Center(v,S){const A=re.Add(v,S);return A.scaleInPlace(.5),A}static DistanceOfPointFromSegment(v,S,A){const E=re.DistanceSquared(S,A);if(0===E)return re.Distance(v,S);const R=A.subtract(S),O=Math.max(0,Math.min(1,re.Dot(v.subtract(S),R)/E)),z=S.add(R.multiplyByFloats(O,O));return re.Distance(v,z)}toString(){return"{X: "+this.x+" Y:"+this.y+"}"}getClassName(){return"Vector2"}getHashCode(){let v=this.x||0;return v=397*v^(this.y||0),v}toArray(v,S=0){return v[S]=this.x,v[S+1]=this.y,this}asArray(){const v=new Array;return this.toArray(v,0),v}copyFrom(v){return this.x=v.x,this.y=v.y,this}copyFromFloats(v,S){return this.x=v,this.y=S,this}set(v,S){return this.copyFromFloats(v,S)}add(v){return new re(this.x+v.x,this.y+v.y)}addToRef(v,S){return S.x=this.x+v.x,S.y=this.y+v.y,this}addInPlace(v){return this.x+=v.x,this.y+=v.y,this}addVector3(v){return new re(this.x+v.x,this.y+v.y)}subtract(v){return new re(this.x-v.x,this.y-v.y)}subtractToRef(v,S){return S.x=this.x-v.x,S.y=this.y-v.y,this}subtractInPlace(v){return this.x-=v.x,this.y-=v.y,this}multiplyInPlace(v){return this.x*=v.x,this.y*=v.y,this}multiply(v){return new re(this.x*v.x,this.y*v.y)}multiplyToRef(v,S){return S.x=this.x*v.x,S.y=this.y*v.y,this}multiplyByFloats(v,S){return new re(this.x*v,this.y*S)}divide(v){return new re(this.x/v.x,this.y/v.y)}divideToRef(v,S){return S.x=this.x/v.x,S.y=this.y/v.y,this}divideInPlace(v){return this.divideToRef(v,this)}negate(){return new re(-this.x,-this.y)}scaleInPlace(v){return this.x*=v,this.y*=v,this}scale(v){const S=new re(0,0);return this.scaleToRef(v,S),S}scaleToRef(v,S){return S.x=this.x*v,S.y=this.y*v,this}scaleAndAddToRef(v,S){return S.x+=this.x*v,S.y+=this.y*v,this}equals(v){return v&&this.x===v.x&&this.y===v.y}equalsWithEpsilon(v,S=ye.Epsilon){return v&&ve.Scalar.WithinEpsilon(this.x,v.x,S)&&ve.Scalar.WithinEpsilon(this.y,v.y,S)}floor(){return new re(Math.floor(this.x),Math.floor(this.y))}fract(){return new re(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){const v=this.length();if(0===v)return this;const S=1/v;return this.x*=S,this.y*=S,this}clone(){return new re(this.x,this.y)}}me.Vector2=re,Object.defineProperty(fe,"__esModule",{value:!0}),fe.Arc2=void 0;const be=de,Te=me,we=zt;fe.Arc2=class{constructor(v,S,A){this.startPoint=v,this.midPoint=S,this.endPoint=A;const E=Math.pow(S.x,2)+Math.pow(S.y,2),R=(Math.pow(v.x,2)+Math.pow(v.y,2)-E)/2,O=(E-Math.pow(A.x,2)-Math.pow(A.y,2))/2,z=(v.x-S.x)*(S.y-A.y)-(S.x-A.x)*(v.y-S.y);this.centerPoint=new Te.Vector2((R*(S.y-A.y)-O*(v.y-S.y))/z,((v.x-S.x)*O-(S.x-A.x)*R)/z),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=be.Angle.BetweenTwoPoints(this.centerPoint,this.startPoint);const B=this.startAngle.degrees();let M=be.Angle.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),V=be.Angle.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();M-B>180&&(M-=360),M-B<-180&&(M+=360),V-M>180&&(V-=360),V-M<-180&&(V+=360),this.orientation=M-B<0?we.Orientation.CW:we.Orientation.CCW,this.angle=be.Angle.FromDegrees(this.orientation===we.Orientation.CW?B-V:V-B)}};var Ce={};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.Axis=void 0;const Se=Lt;class pe{}Ce.Axis=pe,pe.X=new Se.Vector3(1,0,0),pe.Y=new Se.Vector3(0,1,0),pe.Z=new Se.Vector3(0,0,1);var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.BezierCurve=void 0,Ee.BezierCurve=class{static Interpolate(v,S,A,E,R){const O=1-3*E+3*S,z=3*E-6*S,B=3*S;let M=v;for(let S=0;S<5;S++){const S=M*M;M-=1/(3*O*S+2*z*M+B)*(O*(S*M)+z*S+B*M-v),M=Math.min(1,Math.max(0,M))}return 3*Math.pow(1-M,2)*M*A+3*(1-M)*Math.pow(M,2)*R+Math.pow(M,3)}};var _e={},Pe={};Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Color4=void 0;const Ie=Vt,Re=zt;class ge{constructor(v=0,S=0,A=0,E=1){this.r=v,this.g=S,this.b=A,this.a=E}static FromHexString(v){if("#"!==v.substring(0,1)||9!==v.length)return new ge(0,0,0,0);const S=parseInt(v.substring(1,3),16),A=parseInt(v.substring(3,5),16),E=parseInt(v.substring(5,7),16),R=parseInt(v.substring(7,9),16);return ge.FromInts(S,A,E,R)}static Lerp(v,S,A){const E=new ge(0,0,0,0);return ge.LerpToRef(v,S,A,E),E}static LerpToRef(v,S,A,E){E.r=v.r+(S.r-v.r)*A,E.g=v.g+(S.g-v.g)*A,E.b=v.b+(S.b-v.b)*A,E.a=v.a+(S.a-v.a)*A}static Red(){return new ge(1,0,0,1)}static Green(){return new ge(0,1,0,1)}static Blue(){return new ge(0,0,1,1)}static Black(){return new ge(0,0,0,1)}static White(){return new ge(1,1,1,1)}static Purple(){return new ge(.5,0,.5,1)}static Magenta(){return new ge(1,0,1,1)}static Yellow(){return new ge(1,1,0,1)}static Gray(){return new ge(.5,.5,.5,1)}static Teal(){return new ge(0,1,1,1)}static Clear(){return new ge(0,0,0,0)}static FromColor3(v,S=1){return new ge(v.r,v.g,v.b,S)}static FromArray(v,S=0){return new ge(v[S],v[S+1],v[S+2],v[S+3])}static FromInts(v,S,A,E){return new ge(v/255,S/255,A/255,E/255)}static CheckColors4(v,S){if(v.length===3*S){const S=[];for(let A=0;A<v.length;A+=3){const E=A/3*4;S[E]=v[A],S[E+1]=v[A+1],S[E+2]=v[A+2],S[E+3]=1}return S}return v}addInPlace(v){return this.r+=v.r,this.g+=v.g,this.b+=v.b,this.a+=v.a,this}asArray(){const v=new Array;return this.toArray(v,0),v}toArray(v,S=0){return v[S]=this.r,v[S+1]=this.g,v[S+2]=this.b,v[S+3]=this.a,this}add(v){return new ge(this.r+v.r,this.g+v.g,this.b+v.b,this.a+v.a)}subtract(v){return new ge(this.r-v.r,this.g-v.g,this.b-v.b,this.a-v.a)}subtractToRef(v,S){return S.r=this.r-v.r,S.g=this.g-v.g,S.b=this.b-v.b,S.a=this.a-v.a,this}scale(v){return new ge(this.r*v,this.g*v,this.b*v,this.a*v)}scaleToRef(v,S){return S.r=this.r*v,S.g=this.g*v,S.b=this.b*v,S.a=this.a*v,this}scaleAndAddToRef(v,S){return S.r+=this.r*v,S.g+=this.g*v,S.b+=this.b*v,S.a+=this.a*v,this}clampToRef(v=0,S=1,A){return A.r=Ie.Scalar.Clamp(this.r,v,S),A.g=Ie.Scalar.Clamp(this.g,v,S),A.b=Ie.Scalar.Clamp(this.b,v,S),A.a=Ie.Scalar.Clamp(this.a,v,S),this}multiply(v){return new ge(this.r*v.r,this.g*v.g,this.b*v.b,this.a*v.a)}multiplyToRef(v,S){return S.r=this.r*v.r,S.g=this.g*v.g,S.b=this.b*v.b,S.a=this.a*v.a,S}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Color4"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v=397*v^(this.a||0),v}clone(){return new ge(this.r,this.g,this.b,this.a)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this.a=v.a,this}copyFromFloats(v,S,A,E){return this.r=v,this.g=S,this.b=A,this.a=E,this}set(v,S,A,E){return this.copyFromFloats(v,S,A,E)}toHexString(){const v=255*this.r|0,S=255*this.g|0,A=255*this.b|0,E=255*this.a|0;return"#"+Ie.Scalar.ToHex(v)+Ie.Scalar.ToHex(S)+Ie.Scalar.ToHex(A)+Ie.Scalar.ToHex(E)}toLinearSpace(){const v=new ge;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Re.ToLinearSpace),v.g=Math.pow(this.g,Re.ToLinearSpace),v.b=Math.pow(this.b,Re.ToLinearSpace),v.a=this.a,this}toGammaSpace(){const v=new ge;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Re.ToGammaSpace),v.g=Math.pow(this.g,Re.ToGammaSpace),v.b=Math.pow(this.b,Re.ToGammaSpace),v.a=this.a,this}}Pe.Color4=ge,Object.defineProperty(_e,"__esModule",{value:!0}),_e.Color3=void 0;const Oe=zt,Be=Pe,Ne=Vt;class xe{constructor(v=0,S=0,A=0){this.r=v,this.g=S,this.b=A}static FromHexString(v){if("#"!==v.substring(0,1)||7!==v.length)return new xe(0,0,0);const S=parseInt(v.substring(1,3),16),A=parseInt(v.substring(3,5),16),E=parseInt(v.substring(5,7),16);return xe.FromInts(S,A,E)}static FromArray(v,S=0){return new xe(v[S],v[S+1],v[S+2])}static FromInts(v,S,A){return new xe(v/255,S/255,A/255)}static Lerp(v,S,A){const E=new xe(0,0,0);return xe.LerpToRef(v,S,A,E),E}static LerpToRef(v,S,A,E){E.r=v.r+(S.r-v.r)*A,E.g=v.g+(S.g-v.g)*A,E.b=v.b+(S.b-v.b)*A}static Red(){return new xe(1,0,0)}static Green(){return new xe(0,1,0)}static Blue(){return new xe(0,0,1)}static Black(){return new xe(0,0,0)}static White(){return new xe(1,1,1)}static Purple(){return new xe(.5,0,.5)}static Magenta(){return new xe(1,0,1)}static Yellow(){return new xe(1,1,0)}static Gray(){return new xe(.5,.5,.5)}static Teal(){return new xe(0,1,1)}static Random(){return new xe(Math.random(),Math.random(),Math.random())}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Color3"}getHashCode(){let v=this.r||0;return v=397*v^(this.g||0),v=397*v^(this.b||0),v}toArray(v,S=0){return v[S]=this.r,v[S+1]=this.g,v[S+2]=this.b,this}toColor4(v=1){return new Be.Color4(this.r,this.g,this.b,v)}asArray(){const v=new Array;return this.toArray(v,0),v}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(v){return new xe(this.r*v.r,this.g*v.g,this.b*v.b)}multiplyToRef(v,S){return S.r=this.r*v.r,S.g=this.g*v.g,S.b=this.b*v.b,this}equals(v){return v&&this.r===v.r&&this.g===v.g&&this.b===v.b}equalsFloats(v,S,A){return this.r===v&&this.g===S&&this.b===A}scale(v){return new xe(this.r*v,this.g*v,this.b*v)}scaleToRef(v,S){return S.r=this.r*v,S.g=this.g*v,S.b=this.b*v,this}scaleAndAddToRef(v,S){return S.r+=this.r*v,S.g+=this.g*v,S.b+=this.b*v,this}clampToRef(v=0,S=1,A){return A.r=Ne.Scalar.Clamp(this.r,v,S),A.g=Ne.Scalar.Clamp(this.g,v,S),A.b=Ne.Scalar.Clamp(this.b,v,S),this}add(v){return new xe(this.r+v.r,this.g+v.g,this.b+v.b)}addToRef(v,S){return S.r=this.r+v.r,S.g=this.g+v.g,S.b=this.b+v.b,this}subtract(v){return new xe(this.r-v.r,this.g-v.g,this.b-v.b)}subtractToRef(v,S){return S.r=this.r-v.r,S.g=this.g-v.g,S.b=this.b-v.b,this}clone(){return new xe(this.r,this.g,this.b)}copyFrom(v){return this.r=v.r,this.g=v.g,this.b=v.b,this}copyFromFloats(v,S,A){return this.r=v,this.g=S,this.b=A,this}set(v,S,A){return this.copyFromFloats(v,S,A)}toHexString(){const v=255*this.r|0,S=255*this.g|0,A=255*this.b|0;return"#"+Ne.Scalar.ToHex(v)+Ne.Scalar.ToHex(S)+Ne.Scalar.ToHex(A)}toLinearSpace(){const v=new xe;return this.toLinearSpaceToRef(v),v}toLinearSpaceToRef(v){return v.r=Math.pow(this.r,Oe.ToLinearSpace),v.g=Math.pow(this.g,Oe.ToLinearSpace),v.b=Math.pow(this.b,Oe.ToLinearSpace),this}toGammaSpace(){const v=new xe;return this.toGammaSpaceToRef(v),v}toGammaSpaceToRef(v){return v.r=Math.pow(this.r,Oe.ToGammaSpace),v.g=Math.pow(this.g,Oe.ToGammaSpace),v.b=Math.pow(this.b,Oe.ToGammaSpace),this}toJSON(){return{r:this.r,g:this.g,b:this.b}}}_e.Color3=xe;var Le={};Object.defineProperty(Le,"__esModule",{value:!0}),Le.Curve3=void 0;const ke=Lt;class Ae{constructor(v){this._length=0,this._points=v,this._length=this._computeLength(v)}static CreateQuadraticBezier(v,S,A,E){E=E>2?E:3;const R=new Array,r=(v,S,A,E)=>(1-v)*(1-v)*S+2*v*(1-v)*A+v*v*E;for(let O=0;O<=E;O++)R.push(new ke.Vector3(r(O/E,v.x,S.x,A.x),r(O/E,v.y,S.y,A.y),r(O/E,v.z,S.z,A.z)));return new Ae(R)}static CreateCubicBezier(v,S,A,E,R){R=R>3?R:4;const O=new Array,s=(v,S,A,E,R)=>(1-v)*(1-v)*(1-v)*S+3*v*(1-v)*(1-v)*A+3*v*v*(1-v)*E+v*v*v*R;for(let z=0;z<=R;z++)O.push(new ke.Vector3(s(z/R,v.x,S.x,A.x,E.x),s(z/R,v.y,S.y,A.y,E.y),s(z/R,v.z,S.z,A.z,E.z)));return new Ae(O)}static CreateHermiteSpline(v,S,A,E,R){const O=new Array,z=1/R;for(let B=0;B<=R;B++)O.push(ke.Vector3.Hermite(v,S,A,E,B*z));return new Ae(O)}static CreateCatmullRomSpline(v,S,A){const E=new Array,R=1/S;let O=0;if(A){const A=v.length;for(let z=0;z<A;z++){O=0;for(let B=0;B<S;B++)E.push(ke.Vector3.CatmullRom(v[z%A],v[(z+1)%A],v[(z+2)%A],v[(z+3)%A],O)),O+=R}E.push(E[0])}else{const A=new Array;A.push(v[0].clone()),Array.prototype.push.apply(A,v),A.push(v[v.length-1].clone());let z=0;for(z=0;z<A.length-3;z++){O=0;for(let v=0;v<S;v++)E.push(ke.Vector3.CatmullRom(A[z],A[z+1],A[z+2],A[z+3],O)),O+=R}z--,E.push(ke.Vector3.CatmullRom(A[z],A[z+1],A[z+2],A[z+3],O))}return new Ae(E)}getPoints(){return this._points}length(){return this._length}continue(v){const S=this._points[this._points.length-1],A=this._points.slice(),E=v.getPoints();for(let v=1;v<E.length;v++)A.push(E[v].subtract(E[0]).add(S));return new Ae(A)}_computeLength(v){let S=0;for(let A=1;A<v.length;A++)S+=v[A].subtract(v[A-1]).length();return S}}Le.Curve3=Ae;var Fe={},Ue={};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.Plane=void 0;const Ve=Lt,We=Ft,He=Bt;class ze{constructor(v,S,A,E){this.normal=new Ve.Vector3(v,S,A),this.d=E}static FromArray(v){return new ze(v[0],v[1],v[2],v[3])}static FromPoints(v,S,A){const E=new ze(0,0,0,0);return E.copyFromPoints(v,S,A),E}static FromPositionAndNormal(v,S){const A=new ze(0,0,0,0);return S.normalize(),A.normal=S,A.d=-(S.x*v.x+S.y*v.y+S.z*v.z),A}static SignedDistanceToPlaneFromPositionAndNormal(v,S,A){const E=-(S.x*v.x+S.y*v.y+S.z*v.z);return Ve.Vector3.Dot(A,S)+E}asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d]}clone(){return new ze(this.normal.x,this.normal.y,this.normal.z,this.d)}getClassName(){return"Plane"}getHashCode(){let v=this.normal.getHashCode();return v=397*v^(this.d||0),v}normalize(){const v=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);let S=0;return 0!==v&&(S=1/v),this.normal.x*=S,this.normal.y*=S,this.normal.z*=S,this.d*=S,this}transform(v){const S=He.MathTmp.Matrix[0];We.Matrix.TransposeToRef(v,S);const A=S.m,E=this.normal.x,R=this.normal.y,O=this.normal.z,z=this.d,B=E*A[0]+R*A[1]+O*A[2]+z*A[3],M=E*A[4]+R*A[5]+O*A[6]+z*A[7],V=E*A[8]+R*A[9]+O*A[10]+z*A[11],W=E*A[12]+R*A[13]+O*A[14]+z*A[15];return new ze(B,M,V,W)}dotCoordinate(v){return this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z+this.d}copyFromPoints(v,S,A){const E=S.x-v.x,R=S.y-v.y,O=S.z-v.z,z=A.x-v.x,B=A.y-v.y,M=A.z-v.z,V=R*M-O*B,W=O*z-E*M,H=E*B-R*z,X=Math.sqrt(V*V+W*W+H*H);let Q;return Q=0!==X?1/X:0,this.normal.x=V*Q,this.normal.y=W*Q,this.normal.z=H*Q,this.d=-(this.normal.x*v.x+this.normal.y*v.y+this.normal.z*v.z),this}isFrontFacingTo(v,S){return Ve.Vector3.Dot(this.normal,v)<=S}signedDistanceTo(v){return Ve.Vector3.Dot(v,this.normal)+this.d}}Ue.Plane=ze,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.Frustum=void 0;const qe=Ue;class Me{static GetPlanes(v){const S=[];for(let v=0;v<6;v++)S.push(new qe.Plane(0,0,0,0));return Me.GetPlanesToRef(v,S),S}static GetNearPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]+A[2],S.normal.y=A[7]+A[6],S.normal.z=A[11]+A[10],S.d=A[15]+A[14],S.normalize()}static GetFarPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]-A[2],S.normal.y=A[7]-A[6],S.normal.z=A[11]-A[10],S.d=A[15]-A[14],S.normalize()}static GetLeftPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]+A[0],S.normal.y=A[7]+A[4],S.normal.z=A[11]+A[8],S.d=A[15]+A[12],S.normalize()}static GetRightPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]-A[0],S.normal.y=A[7]-A[4],S.normal.z=A[11]-A[8],S.d=A[15]-A[12],S.normalize()}static GetTopPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]-A[1],S.normal.y=A[7]-A[5],S.normal.z=A[11]-A[9],S.d=A[15]-A[13],S.normalize()}static GetBottomPlaneToRef(v,S){const A=v.m;S.normal.x=A[3]+A[1],S.normal.y=A[7]+A[5],S.normal.z=A[11]+A[9],S.d=A[15]+A[13],S.normalize()}static GetPlanesToRef(v,S){Me.GetNearPlaneToRef(v,S[0]),Me.GetFarPlaneToRef(v,S[1]),Me.GetLeftPlaneToRef(v,S[2]),Me.GetRightPlaneToRef(v,S[3]),Me.GetTopPlaneToRef(v,S[4]),Me.GetBottomPlaneToRef(v,S[5])}}Fe.Frustum=Me;var Ge={};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.Path2=void 0;const Xe=me,Ye=fe,Qe=zt;class De{constructor(v,S){this.closed=!1,this._points=new Array,this._length=0,this._points.push(new Xe.Vector2(v,S))}static StartingAt(v,S){return new De(v,S)}addLineTo(v,S){if(this.closed)return this;const A=new Xe.Vector2(v,S),E=this._points[this._points.length-1];return this._points.push(A),this._length+=A.subtract(E).length(),this}addArcTo(v,S,A,E,R=36){if(this.closed)return this;const O=this._points[this._points.length-1],z=new Xe.Vector2(v,S),B=new Xe.Vector2(A,E),M=new Ye.Arc2(O,z,B);let V=M.angle.radians()/R;M.orientation===Qe.Orientation.CW&&(V*=-1);let W=M.startAngle.radians()+V;for(let v=0;v<R;v++){const v=Math.cos(W)*M.radius+M.centerPoint.x,S=Math.sin(W)*M.radius+M.centerPoint.y;this.addLineTo(v,S),W+=V}return this}close(){return this.closed=!0,this}length(){let v=this._length;if(!this.closed){const S=this._points[this._points.length-1];v+=this._points[0].subtract(S).length()}return v}getPoints(){return this._points}getPointAtLengthPosition(v){if(v<0||v>1)return Xe.Vector2.Zero();const S=v*this.length();let A=0;for(let v=0;v<this._points.length;v++){const E=(v+1)%this._points.length,R=this._points[v],O=this._points[E].subtract(R),z=O.length()+A;if(S>=A&&S<=z){const v=O.normalize(),E=S-A;return new Xe.Vector2(R.x+v.x*E,R.y+v.y*E)}A=z}return Xe.Vector2.Zero()}}Ge.Path2=De;var Ze={};Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.Path3D=void 0;const Je=Lt,$e=zt,tn=Vt;Ze.Path3D=class{constructor(v,S=null,A){this.path=v,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array;for(let S=0;S<v.length;S++)this._curve[S]=v[S].clone();this._raw=A||!1,this._compute(S)}getCurve(){return this._curve}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}update(v,S=null){for(let S=0;S<v.length;S++)this._curve[S].x=v[S].x,this._curve[S].y=v[S].y,this._curve[S].z=v[S].z;return this._compute(S),this}_compute(v){const S=this._curve.length;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[S-1]=this._curve[S-1].subtract(this._curve[S-2]),this._raw||this._tangents[S-1].normalize();const A=this._tangents[0],E=this._normalVector(this._curve[0],A,v);let R,O,z,B;this._normals[0]=E,this._raw||this._normals[0].normalize(),this._binormals[0]=Je.Vector3.Cross(A,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let v=1;v<S;v++)R=this._getLastNonNullVector(v),v<S-1&&(O=this._getFirstNonNullVector(v),this._tangents[v]=R.add(O),this._tangents[v].normalize()),this._distances[v]=this._distances[v-1]+R.length(),z=this._tangents[v],B=this._binormals[v-1],this._normals[v]=Je.Vector3.Cross(B,z),this._raw||this._normals[v].normalize(),this._binormals[v]=Je.Vector3.Cross(z,this._normals[v]),this._raw||this._binormals[v].normalize()}_getFirstNonNullVector(v){let S=1,A=this._curve[v+S].subtract(this._curve[v]);for(;0===A.length()&&v+S+1<this._curve.length;)S++,A=this._curve[v+S].subtract(this._curve[v]);return A}_getLastNonNullVector(v){let S=1,A=this._curve[v].subtract(this._curve[v-S]);for(;0===A.length()&&v>S+1;)S++,A=this._curve[v].subtract(this._curve[v-S]);return A}_normalVector(v,S,A){let E,R=S.length();if(0===R&&(R=1),null==A){let v;v=tn.Scalar.WithinEpsilon(Math.abs(S.y)/R,1,$e.Epsilon)?tn.Scalar.WithinEpsilon(Math.abs(S.x)/R,1,$e.Epsilon)?tn.Scalar.WithinEpsilon(Math.abs(S.z)/R,1,$e.Epsilon)?Je.Vector3.Zero():new Je.Vector3(0,0,1):new Je.Vector3(1,0,0):new Je.Vector3(0,-1,0),E=Je.Vector3.Cross(S,v)}else E=Je.Vector3.Cross(S,A),Je.Vector3.CrossToRef(E,S,E);return E.normalize(),E}};var nn={};Object.defineProperty(nn,"__esModule",{value:!0}),nn.Size=void 0;class je{constructor(v,S){this.width=v,this.height=S}get surface(){return this.width*this.height}static Zero(){return new je(0,0)}static Lerp(v,S,A){const E=v.width+(S.width-v.width)*A,R=v.height+(S.height-v.height)*A;return new je(E,R)}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let v=this.width||0;return v=397*v^(this.height||0),v}copyFrom(v){this.width=v.width,this.height=v.height}copyFromFloats(v,S){return this.width=v,this.height=S,this}set(v,S){return this.copyFromFloats(v,S)}multiplyByFloats(v,S){return new je(this.width*v,this.height*S)}clone(){return new je(this.width,this.height)}equals(v){return!!v&&this.width===v.width&&this.height===v.height}add(v){return new je(this.width+v.width,this.height+v.height)}subtract(v){return new je(this.width-v.width,this.height-v.height)}}nn.Size=je,function(v){var S=Rt&&Rt.__createBinding||(Object.create?function(v,S,A,E){void 0===E&&(E=A),Object.defineProperty(v,E,{enumerable:!0,get:function(){return S[A]}})}:function(v,S,A,E){void 0===E&&(E=A),v[E]=S[A]}),A=Rt&&Rt.__exportStar||function(v,A){for(var E in v)"default"===E||Object.prototype.hasOwnProperty.call(A,E)||S(A,v,E)};Object.defineProperty(v,"__esModule",{value:!0}),A(zt,v),A(Bt,v),A(de,v),A(fe,v),A(Ce,v),A(Ee,v),A(_e,v),A(Pe,v),A(Le,v),A(Fe,v),A(Ft,v),A(Ge,v),A(Ze,v),A(Ue,v),A(kt,v),A(Vt,v),A(nn,v),A(me,v),A(Lt,v),A(Ut,v),A(Ot,v)}(Ot);var on,rn,sn,an,hn={looping:!0,speed:1,weight:1,layer:0},ln=function(v){function e(S,A){void 0===A&&(A=hn);var E=v.call(this)||this;return E.isAnimationClip=!0,E.looping=hn.looping,E.weight=hn.weight,E.playing=!1,E.shouldReset=!1,E.speed=hn.speed,E.name=f("AnimClip"),E.layer=hn.layer,E.clip=S,E.setParams(o({},A)),E}return i(e,v),e.prototype.setParams=function(v){return this.looping=void 0!==v.looping?v.looping:this.looping,this.speed=v.speed||this.speed,this.weight=v.weight||this.weight,this.layer=v.layer||this.layer,this},e.prototype.toJSON=function(){var S=JSON.parse(JSON.stringify(v.prototype.toJSON.call(this)));return this.shouldReset&&(this.shouldReset=!1),S},e.prototype.play=function(v){var S;void 0===v&&(v=!1),null===(S=this.owner)||void 0===S||S.play(this,v)},e.prototype.pause=function(){var v;null===(v=this.owner)||void 0===v||v.pause(this)},e.prototype.reset=function(){this.shouldReset=!0},e.prototype.stop=function(){var v;null===(v=this.owner)||void 0===v||v.stop(this)},r([K.readonly,s("design:type",String)],e.prototype,"clip",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"looping",void 0),r([K.field,s("design:type",Number)],e.prototype,"weight",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"playing",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"shouldReset",void 0),r([K.field,s("design:type",Number)],e.prototype,"speed",void 0),r([K.readonly,s("design:type",String)],e.prototype,"name",void 0),e}(K);v.InputEventType=void 0,(on=v.InputEventType||(v.InputEventType={}))[on.DOWN=0]="DOWN",on[on.UP=1]="UP",v.CameraMode=void 0,(rn=v.CameraMode||(v.CameraMode={}))[rn.FirstPerson=0]="FirstPerson",rn[rn.ThirdPerson=1]="ThirdPerson",rn[rn.BuildingToolGodMode=2]="BuildingToolGodMode",v.LandRole=void 0,(sn=v.LandRole||(v.LandRole={})).OWNER="owner",sn.OPERATOR="operator",v.ActionButton=void 0,(an=v.ActionButton||(v.ActionButton={})).POINTER="POINTER",an.PRIMARY="PRIMARY",an.SECONDARY="SECONDARY",an.ANY="ANY",an.FORWARD="FORWARD",an.BACKWARD="BACKWARD",an.RIGHT="RIGHT",an.LEFT="LEFT",an.JUMP="JUMP",an.WALK="WALK",an.ACTION_3="ACTION_3",an.ACTION_4="ACTION_4",an.ACTION_5="ACTION_5",an.ACTION_6="ACTION_6";var cn,un,Ke=function(v){if(this.callback=v,!v||!("apply"in v)||!("call"in v))throw new Error("Callback is not a function");fn.ensureInstance()},dn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerDown")],e)}(Ke),pn=function(v){function e(){return null!==v&&v.apply(this,arguments)||this}return i(e,v),r([P("pointerUp")],e)}(Ke),en=function(v,S){this.fn=v,this.useRaycast=S},fn=function(){function e(){this.buttonIdMapping=[v.ActionButton.POINTER,v.ActionButton.PRIMARY,v.ActionButton.SECONDARY,v.ActionButton.ANY,v.ActionButton.FORWARD,v.ActionButton.BACKWARD,v.ActionButton.RIGHT,v.ActionButton.LEFT,v.ActionButton.JUMP,v.ActionButton.WALK,v.ActionButton.ACTION_3,v.ActionButton.ACTION_4,v.ActionButton.ACTION_5,v.ActionButton.ACTION_6],this.subscriptions=this.buttonIdMapping.reduce((function(v,S){var A;return o(o({},v),((A={})[S]={BUTTON_DOWN:[],BUTTON_UP:[]},A))}),{}),this.internalState=this.buttonIdMapping.reduce((function(v,S){var A;return o(o({},v),((A={})[S]={BUTTON_DOWN:!1},A))}),{})}return Object.defineProperty(e,"instance",{get:function(){return e.ensureInstance(),e._instance},enumerable:!1,configurable:!0}),e.ensureInstance=function(){e._instance||(e._instance=new e)},e.prototype.isButtonPressed=function(v){return this.internalState[v]},e.prototype.subscribe=function(v,S,A,E){var R=this;return this.subscriptions[S][v].push(new en(E,A)),function(){R.unsubscribe(v,S,E)}},e.prototype.unsubscribe=function(v,S,A){var E=this.getSubscriptionId(v,S,A);return E>-1&&this.subscriptions[S][v].splice(E,1)},e.prototype.handlePointerEvent=function(S){var A=this.getPointerById(S.buttonId);if(A){var E=o(o({},S),{button:A,direction:(new Ot.Vector3).copyFrom(S.direction),origin:(new Ot.Vector3).copyFrom(S.origin),hit:void 0}),R=S.hit?o(o({},S.hit),{hitPoint:(new Ot.Vector3).copyFrom(S.hit.hitPoint),normal:(new Ot.Vector3).copyFrom(S.hit.normal),worldNormal:(new Ot.Vector3).copyFrom(S.hit.worldNormal)}):void 0;if(S.type===v.InputEventType.DOWN){this.internalState[A].BUTTON_DOWN=!0;for(var O=0;O<this.subscriptions[A].BUTTON_DOWN.length;O++)(z=this.subscriptions[A].BUTTON_DOWN[O]).useRaycast?E.hit=R:E.hit=void 0,z.fn(E);R&&R.entityId&&N.engine&&(M=(B=N.engine.entities[R.entityId])&&B.getComponentOrNull(dn))&&(E.hit=R,M.callback(E))}else{for(this.internalState[A].BUTTON_DOWN=!1,O=0;O<this.subscriptions[A].BUTTON_UP.length;O++){var z;(z=this.subscriptions[A].BUTTON_UP[O]).useRaycast?E.hit=R:E.hit=void 0,z.fn(E)}var B,M;R&&R.entityId&&N.engine&&(M=(B=N.engine.entities[R.entityId])&&B.getComponentOrNull(pn))&&(E.hit=R,M.callback(E))}}},e.prototype.getSubscriptionId=function(v,S,A){for(var E=0;E<this.subscriptions[S][v].length;E++)if(this.subscriptions[S][v][E].fn===A)return E;return-1},e.prototype.getPointerById=function(S){if(S<0||S>=this.buttonIdMapping.length)return null;var A=this.buttonIdMapping[S];return A===v.ActionButton.ANY?null:A},e}();v.CLASS_ID=void 0,(cn=v.CLASS_ID||(v.CLASS_ID={}))[cn.TRANSFORM=1]="TRANSFORM",cn[cn.UUID_CALLBACK=8]="UUID_CALLBACK",cn[cn.BOX_SHAPE=16]="BOX_SHAPE",cn[cn.SPHERE_SHAPE=17]="SPHERE_SHAPE",cn[cn.PLANE_SHAPE=18]="PLANE_SHAPE",cn[cn.CONE_SHAPE=19]="CONE_SHAPE",cn[cn.CYLINDER_SHAPE=20]="CYLINDER_SHAPE",cn[cn.TEXT_SHAPE=21]="TEXT_SHAPE",cn[cn.NFT_SHAPE=22]="NFT_SHAPE",cn[cn.UI_WORLD_SPACE_SHAPE=23]="UI_WORLD_SPACE_SHAPE",cn[cn.UI_SCREEN_SPACE_SHAPE=24]="UI_SCREEN_SPACE_SHAPE",cn[cn.UI_CONTAINER_RECT=25]="UI_CONTAINER_RECT",cn[cn.UI_CONTAINER_STACK=26]="UI_CONTAINER_STACK",cn[cn.UI_TEXT_SHAPE=27]="UI_TEXT_SHAPE",cn[cn.UI_INPUT_TEXT_SHAPE=28]="UI_INPUT_TEXT_SHAPE",cn[cn.UI_IMAGE_SHAPE=29]="UI_IMAGE_SHAPE",cn[cn.UI_SLIDER_SHAPE=30]="UI_SLIDER_SHAPE",cn[cn.CIRCLE_SHAPE=31]="CIRCLE_SHAPE",cn[cn.BILLBOARD=32]="BILLBOARD",cn[cn.ANIMATION=33]="ANIMATION",cn[cn.FONT=34]="FONT",cn[cn.UI_FULLSCREEN_SHAPE=40]="UI_FULLSCREEN_SHAPE",cn[cn.UI_BUTTON_SHAPE=41]="UI_BUTTON_SHAPE",cn[cn.GLTF_SHAPE=54]="GLTF_SHAPE",cn[cn.OBJ_SHAPE=55]="OBJ_SHAPE",cn[cn.AVATAR_SHAPE=56]="AVATAR_SHAPE",cn[cn.BASIC_MATERIAL=64]="BASIC_MATERIAL",cn[cn.PBR_MATERIAL=65]="PBR_MATERIAL",cn[cn.HIGHLIGHT_ENTITY=66]="HIGHLIGHT_ENTITY",cn[cn.SOUND=67]="SOUND",cn[cn.TEXTURE=68]="TEXTURE",cn[cn.VIDEO_CLIP=70]="VIDEO_CLIP",cn[cn.VIDEO_TEXTURE=71]="VIDEO_TEXTURE",cn[cn.AVATAR_TEXTURE=72]="AVATAR_TEXTURE",cn[cn.AUDIO_CLIP=200]="AUDIO_CLIP",cn[cn.AUDIO_SOURCE=201]="AUDIO_SOURCE",cn[cn.AUDIO_STREAM=202]="AUDIO_STREAM",cn[cn.GIZMOS=203]="GIZMOS",cn[cn.SMART_ITEM=204]="SMART_ITEM",cn[cn.AVATAR_MODIFIER_AREA=205]="AVATAR_MODIFIER_AREA",cn[cn.AVATAR_ATTACH=206]="AVATAR_ATTACH",cn[cn.CAMERA_MODE_AREA=207]="CAMERA_MODE_AREA",cn[cn.NAME=300]="NAME",cn[cn.LOCKED_ON_EDIT=301]="LOCKED_ON_EDIT",cn[cn.VISIBLE_ON_EDIT=302]="VISIBLE_ON_EDIT",v.AvatarModifiers=void 0,(un=v.AvatarModifiers||(v.AvatarModifiers={})).HIDE_AVATARS="HIDE_AVATARS",un.DISABLE_PASSPORTS="DISABLE_PASSPORTS";var gn,mn=function(S){function n(v){var A=S.call(this)||this;return A.area=v.area,A.modifiers=v.modifiers,A.excludeIds=v.excludeIds,A}return i(n,S),r([K.field,s("design:type",Object)],n.prototype,"area",void 0),r([K.field,s("design:type",Array)],n.prototype,"modifiers",void 0),r([K.field,s("design:type",Array)],n.prototype,"excludeIds",void 0),r([P("engine.avatarModifierArea",v.CLASS_ID.AVATAR_MODIFIER_AREA),s("design:paramtypes",[Object])],n)}(K),yn=function(S){function n(v){void 0===v&&(v={});var A=S.call(this)||this;return A.position=v.position||Ot.Vector3.Zero(),A.rotation=v.rotation||Ot.Quaternion.Identity,A.scale=v.scale||new Ot.Vector3(1,1,1),A}return i(n,S),Object.defineProperty(n.prototype,"eulerAngles",{get:function(){return this.rotation.eulerAngles},enumerable:!1,configurable:!0}),n.prototype.lookAt=function(v,S){void 0===S&&(S=Ot.MathTmp.staticUp);var A=new Ot.Matrix;return Ot.Matrix.LookAtLHToRef(this.position,v,S,A),A.invert(),Ot.Quaternion.FromRotationMatrixToRef(A,this.rotation),this},n.prototype.rotate=function(v,S){return this.rotation.multiplyInPlace(this.rotation.angleAxis(S,v)),this},n.prototype.translate=function(v){return this.position.addInPlace(v),this},r([K.field,s("design:type",Ot.Vector3)],n.prototype,"position",void 0),r([K.field,s("design:type",Ot.Quaternion)],n.prototype,"rotation",void 0),r([K.field,s("design:type",Ot.Vector3)],n.prototype,"scale",void 0),r([P("engine.transform",v.CLASS_ID.TRANSFORM),s("design:paramtypes",[Object])],n)}(K);v.AttachToAvatarAnchorPointId=void 0,(gn=v.AttachToAvatarAnchorPointId||(v.AttachToAvatarAnchorPointId={}))[gn.Position=0]="Position",gn[gn.NameTag=1]="NameTag",gn[gn.LeftHand=2]="LeftHand",gn[gn.RightHand=3]="RightHand";var vn,bn=function(S){function n(A){void 0===A&&(A={});var E=S.call(this)||this;return E.avatarId=A.avatarId||"",E.anchorPointId=A.anchorPointId||v.AttachToAvatarAnchorPointId.Position,E}return i(n,S),r([K.field,s("design:type",String)],n.prototype,"avatarId",void 0),r([K.field,s("design:type",Number)],n.prototype,"anchorPointId",void 0),r([K.field,s("design:type",String)],n.prototype,"avatarSceneId",void 0),r([P("engine.transform",v.CLASS_ID.AVATAR_ATTACH),s("design:paramtypes",[Object])],n)}(K),Tn=function(S){function n(v,A,E){void 0===v&&(v=!0),void 0===A&&(A=!0),void 0===E&&(E=!0);var R=S.call(this)||this;return R.x=!0,R.y=!0,R.z=!0,R.x=v,R.y=A,R.z=E,R}return i(n,S),r([K.field,s("design:type",Boolean)],n.prototype,"x",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"y",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"z",void 0),r([P("engine.billboard",v.CLASS_ID.BILLBOARD),s("design:paramtypes",[Boolean,Boolean,Boolean])],n)}(K),wn=function(v){function e(){var S=null!==v&&v.apply(this,arguments)||this;return S.withCollisions=!0,S.isPointerBlocker=!0,S.visible=!0,S}return i(e,v),r([K.field,s("design:type",Boolean)],e.prototype,"withCollisions",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"visible",void 0),e}(K),Cn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([K.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.BOX_SHAPE)],n)}(wn),xn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([N("engine.shape",v.CLASS_ID.SPHERE_SHAPE)],n)}(wn),Sn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"segments",void 0),r([K.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CIRCLE_SHAPE)],n)}(wn),An=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.width=1,v.height=1,v}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"width",void 0),r([K.field,s("design:type",Number)],n.prototype,"height",void 0),r([K.field,s("design:type",Array)],n.prototype,"uvs",void 0),r([N("engine.shape",v.CLASS_ID.PLANE_SHAPE)],n)}(wn),En=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.radiusTop=0,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([K.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([K.field,s("design:type",Object)],n.prototype,"radius",void 0),r([K.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CONE_SHAPE)],n)}(wn),_n=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.radiusTop=1,v.radiusBottom=1,v.segmentsHeight=1,v.segmentsRadial=36,v.openEnded=!1,v.radius=null,v.arc=360,v}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"radiusTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"radiusBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"segmentsHeight",void 0),r([K.field,s("design:type",Number)],n.prototype,"segmentsRadial",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"openEnded",void 0),r([K.field,s("design:type",Object)],n.prototype,"radius",void 0),r([K.field,s("design:type",Number)],n.prototype,"arc",void 0),r([N("engine.shape",v.CLASS_ID.CYLINDER_SHAPE)],n)}(wn),Pn=function(S){function n(v){var A=S.call(this)||this;return A.src=v,A}return i(n,S),r([wn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.GLTF_SHAPE),s("design:paramtypes",[String])],n)}(wn);v.PictureFrameStyle=void 0,(vn=v.PictureFrameStyle||(v.PictureFrameStyle={}))[vn.Classic=0]="Classic",vn[vn.Baroque_Ornament=1]="Baroque_Ornament",vn[vn.Diamond_Ornament=2]="Diamond_Ornament",vn[vn.Minimal_Wide=3]="Minimal_Wide",vn[vn.Minimal_Grey=4]="Minimal_Grey",vn[vn.Blocky=5]="Blocky",vn[vn.Gold_Edges=6]="Gold_Edges",vn[vn.Gold_Carved=7]="Gold_Carved",vn[vn.Gold_Wide=8]="Gold_Wide",vn[vn.Gold_Rounded=9]="Gold_Rounded",vn[vn.Metal_Medium=10]="Metal_Medium",vn[vn.Metal_Wide=11]="Metal_Wide",vn[vn.Metal_Slim=12]="Metal_Slim",vn[vn.Metal_Rounded=13]="Metal_Rounded",vn[vn.Pins=14]="Pins",vn[vn.Minimal_Black=15]="Minimal_Black",vn[vn.Minimal_White=16]="Minimal_White",vn[vn.Tape=17]="Tape",vn[vn.Wood_Slim=18]="Wood_Slim",vn[vn.Wood_Wide=19]="Wood_Wide",vn[vn.Wood_Twigs=20]="Wood_Twigs",vn[vn.Canvas=21]="Canvas",vn[vn.None=22]="None";var In,Rn=function(S){function n(A,E){void 0===E&&(E={});var R=S.call(this)||this;R.src=A;var O=new Ot.Color3(.6404918,.611472,.8584906),z=v.PictureFrameStyle.Classic;return"r"in E?O=E:null!==E&&(E.color&&(O=E.color),E.style&&(z=E.style)),R.color=O,R.style=z,R}return i(n,S),r([wn.readonly,s("design:type",String)],n.prototype,"src",void 0),r([wn.readonly,s("design:type",Number)],n.prototype,"style",void 0),r([K.field,s("design:type",Ot.Color3)],n.prototype,"color",void 0),r([N("engine.shape",v.CLASS_ID.NFT_SHAPE),s("design:paramtypes",[String,Object])],n)}(wn),On=function(S){function n(v,A){var E=S.call(this)||this,R=new RegExp("data:[a-z-]+/[a-z-]+;base64");if((v.length>2048||R.test(v))&&c(" Base64 textures will be deprecated in version 7 of decentraland-ecs"),E.src=v,A)for(var O in A)E[O]=A[O];return E}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"src",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([K.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.TEXTURE),s("design:paramtypes",[String,Object])],n)}(K),zn=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.states=[],v}return i(n,S),n.prototype.addClip=function(v){var S=this;return this.states.push(v),v.onChange((function(){S.dirty=!0})),v.owner=this,this},n.prototype.getClip=function(v){for(var S=0;S<this.states.length;S++){var A=this.states[S];if(A.clip===v)return A}var E=new ln(v);return this.addClip(E),E},n.prototype.stop=function(v){if(v)v.playing=!1,v.shouldReset=!0;else for(var S=0;S<this.states.length;S++){var A=this.states[S];this.stop(A)}},n.prototype.play=function(v,S){void 0===S&&(S=!1);for(var A=0;A<this.states.length;A++){var E=this.states[A];E.layer===v.layer&&v!==E&&this.pause(E)}S&&(v.shouldReset=!0),v.playing=!0,v.dirty=!0,v.data.nonce=Math.random()},n.prototype.pause=function(v){if(v)v.playing=!1;else for(var S=0;S<this.states.length;S++){var A=this.states[S];this.pause(A)}},r([K.readonly,s("design:type",Array)],n.prototype,"states",void 0),r([P("engine.animator",v.CLASS_ID.ANIMATION)],n)}(wn),Bn=function(S){function n(v){var A=S.call(this)||this;return A.src=v,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.shape",v.CLASS_ID.OBJ_SHAPE),s("design:paramtypes",[String])],n)}(wn),Dn=function(S){function n(v){void 0===v&&(v="");var A=S.call(this)||this;return A.src=v,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"src",void 0),r([N("engine.font",v.CLASS_ID.FONT),s("design:paramtypes",[String])],n)}(K);v.Fonts=void 0,(In=v.Fonts||(v.Fonts={})).SanFrancisco="builtin:SF-UI-Text-Regular SDF",In.SanFrancisco_Heavy="builtin:SF-UI-Text-Heavy SDF",In.SanFrancisco_Semibold="builtin:SF-UI-Text-Semibold SDF",In.LiberationSans="builtin:LiberationSans SDF",In.SansSerif="SansSerif",In.SansSerif_Heavy="SansSerif_Heavy",In.SansSerif_Bold="SansSerif_Bold",In.SansSerif_SemiBold="SansSerif_SemiBold";var Nn,Mn=function(S){function n(v){var A=S.call(this)||this;return A.outlineWidth=0,A.outlineColor=new Ot.Color3(1,1,1),A.color=new Ot.Color3(1,1,1),A.fontSize=10,A.opacity=1,A.value="",A.lineSpacing="0px",A.lineCount=0,A.textWrapping=!1,A.shadowBlur=0,A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowColor=new Ot.Color3(1,1,1),A.hTextAlign="center",A.vTextAlign="center",A.width=1,A.height=1,A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A.billboard=!1,A.visible=!0,v&&(A.value=v),A}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([K.field,s("design:type",Ot.Color3)],n.prototype,"outlineColor",void 0),r([K.field,s("design:type",Ot.Color3)],n.prototype,"color",void 0),r([K.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([K.component,s("design:type",Dn)],n.prototype,"font",void 0),r([K.field,s("design:type",Number)],n.prototype,"opacity",void 0),r([K.field,s("design:type",String)],n.prototype,"value",void 0),r([K.field,s("design:type",String)],n.prototype,"lineSpacing",void 0),r([K.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([K.field,s("design:type",Ot.Color3)],n.prototype,"shadowColor",void 0),r([K.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([K.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([K.field,s("design:type",Number)],n.prototype,"width",void 0),r([K.field,s("design:type",Number)],n.prototype,"height",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"billboard",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"visible",void 0),r([P("engine.text",v.CLASS_ID.TEXT_SHAPE),s("design:paramtypes",[String])],n)}(K);v.TransparencyMode=void 0,(Nn=v.TransparencyMode||(v.TransparencyMode={}))[Nn.OPAQUE=0]="OPAQUE",Nn[Nn.ALPHA_TEST=1]="ALPHA_TEST",Nn[Nn.ALPHA_BLEND=2]="ALPHA_BLEND",Nn[Nn.ALPHA_TEST_AND_BLEND=3]="ALPHA_TEST_AND_BLEND",Nn[Nn.AUTO=4]="AUTO";var Ln,kn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.alphaTest=.5,A.castShadows=!0,A.transparencyMode=v.TransparencyMode.AUTO,A}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([K.field,s("design:type",Object)],n.prototype,"albedoColor",void 0),r([K.field,s("design:type",Ot.Color3)],n.prototype,"emissiveColor",void 0),r([K.field,s("design:type",Number)],n.prototype,"metallic",void 0),r([K.field,s("design:type",Number)],n.prototype,"roughness",void 0),r([K.field,s("design:type",Ot.Color3)],n.prototype,"reflectivityColor",void 0),r([K.field,s("design:type",Number)],n.prototype,"directIntensity",void 0),r([K.field,s("design:type",Number)],n.prototype,"microSurface",void 0),r([K.field,s("design:type",Number)],n.prototype,"emissiveIntensity",void 0),r([K.field,s("design:type",Number)],n.prototype,"specularIntensity",void 0),r([K.component,s("design:type",Object)],n.prototype,"albedoTexture",void 0),r([K.component,s("design:type",Object)],n.prototype,"alphaTexture",void 0),r([K.component,s("design:type",Object)],n.prototype,"emissiveTexture",void 0),r([K.component,s("design:type",Object)],n.prototype,"bumpTexture",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([K.field,s("design:type",Number)],n.prototype,"transparencyMode",void 0),r([N("engine.material",v.CLASS_ID.PBR_MATERIAL)],n)}(K),Fn=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.alphaTest=.5,v.castShadows=!0,v}return i(n,S),r([K.component,s("design:type",Object)],n.prototype,"texture",void 0),r([K.field,s("design:type",Number)],n.prototype,"alphaTest",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"castShadows",void 0),r([N("engine.material",v.CLASS_ID.BASIC_MATERIAL)],n)}(K),Un=function(v){function e(S){var A=v.call(this)||this;if(A.uuid=f("UUID"),!S||!("apply"in S)||!("call"in S))throw new Error("Callback is not a function");return A.callback=S,A}return i(e,v),e.uuidEvent=function(v,S){if(delete v[S]){var A=S+"_"+Math.random();v[A]=void 0,Object.defineProperty(v,A,o(o({},Object.getOwnPropertyDescriptor(v,A)),{enumerable:!1})),Object.defineProperty(v,S.toString(),{get:function(){return this[A]},set:function(v){var E=this[A];if(v){if(!(v instanceof e))throw new Error("value is not an OnUUIDEvent");this.data[S]=v.uuid}else this.data[S]=null;if(this[A]=v,v!==E){this.dirty=!0;for(var R=0;R<this.subscriptions.length;R++)this.subscriptions[R](S,v,E)}},enumerable:!0})}},e.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type}},r([K.field,s("design:type",Function)],e.prototype,"callback",void 0),e}(K),Vn=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.button=v.ActionButton.ANY,A.hoverText="Interact",A.distance=10,A.showFeedback=!0,A}return i(n,S),n.prototype.toJSON=function(){return{uuid:this.uuid,type:this.type,button:this.button,hoverText:this.hoverText,distance:this.distance,showFeedback:this.showFeedback}},r([K.field,s("design:type",String)],n.prototype,"button",void 0),r([K.field,s("design:type",String)],n.prototype,"hoverText",void 0),r([K.field,s("design:type",Number)],n.prototype,"distance",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"showFeedback",void 0),n}(Un),Wn=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.type="onPointerLock",v}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onPointerLock",v.CLASS_ID.UUID_CALLBACK)],n)}(Un),Hn=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.type="onAnimationEnd",v}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onAnimationEnd",v.CLASS_ID.UUID_CALLBACK)],n)}(Un),jn=function(S){function n(){return null!==S&&S.apply(this,arguments)||this}return i(n,S),r([P("engine.smartItem",v.CLASS_ID.SMART_ITEM)],n)}(K),qn=function(S){function n(v){var A=S.call(this)||this;return A.url=v,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"url",void 0),r([N("engine.VideoClip",v.CLASS_ID.VIDEO_CLIP),s("design:paramtypes",[String])],n)}(K);v.VideoStatus=void 0,(Ln=v.VideoStatus||(v.VideoStatus={}))[Ln.NONE=0]="NONE",Ln[Ln.ERROR=1]="ERROR",Ln[Ln.LOADING=2]="LOADING",Ln[Ln.READY=3]="READY",Ln[Ln.PLAYING=4]="PLAYING",Ln[Ln.BUFFERING=5]="BUFFERING";var Gn,Xn=function(S){function n(A,E){var R=S.call(this)||this;if(R.volume=1,R.playbackRate=1,R.loop=!1,R.seek=-1,R._position=-1,R._videoLength=-1,R._status=v.VideoStatus.NONE,R.playing=!1,!(A instanceof qn))throw new Error("Trying to create VideoTexture(VideoClip) with an invalid VideoClip");if(R.videoClipId=D(A),E)for(var O in E)R[O]=E[O];return R}return i(n,S),n.prototype.play=function(){this.playing=!0},n.prototype.pause=function(){this.playing=!1},n.prototype.reset=function(){this.seekTime(0),this.pause()},n.prototype.seekTime=function(v){this.seek=v,this.dirty=!0,this.data.nonce=Math.random()},n.prototype.toJSON=function(){if(this.seek>=0){var v=JSON.parse(JSON.stringify(S.prototype.toJSON.call(this)));return this.seek=-1,v}return S.prototype.toJSON.call(this)},n.prototype.update=function(S){S.videoClipId===this.videoClipId&&(this._status=S.videoStatus||v.VideoStatus.NONE,this._videoLength=S.totalVideoLength,this._position=S.currentOffset)},Object.defineProperty(n.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"videoLength",{get:function(){return this._videoLength},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),r([K.readonly,s("design:type",String)],n.prototype,"videoClipId",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([K.field,s("design:type",Number)],n.prototype,"volume",void 0),r([K.field,s("design:type",Number)],n.prototype,"playbackRate",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([K.field,s("design:type",Number)],n.prototype,"seek",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([N("engine.VideoTexture",v.CLASS_ID.VIDEO_TEXTURE),s("design:paramtypes",[qn,Object])],n)}(K),Yn=function(S){function n(v){var A=S.call(this)||this;return A.area=v.area,A.cameraMode=v.cameraMode,A}return i(n,S),r([K.field,s("design:type",Object)],n.prototype,"area",void 0),r([K.field,s("design:type",Number)],n.prototype,"cameraMode",void 0),r([P("engine.cameraModeArea",v.CLASS_ID.CAMERA_MODE_AREA),s("design:paramtypes",[Object])],n)}(K),Qn=function(S){function n(v,A){var E=S.call(this)||this;if(E.userId=v,A)for(var R in A)E[R]=A[R];return E}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"userId",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"samplingMode",void 0),r([K.readonly,s("design:type",Number)],n.prototype,"wrap",void 0),r([K.readonly,s("design:type",Boolean)],n.prototype,"hasAlpha",void 0),r([N("engine.texture",v.CLASS_ID.AVATAR_TEXTURE),s("design:paramtypes",[String,Object])],n)}(K),Zn=function(){function e(){var S=this;this.position=new Ot.Vector3,this.rotation=new Ot.Quaternion,this.feetPosition=new Ot.Vector3,this.worldPosition=new Ot.Vector3,this.lastEventPosition={x:0,y:0,z:0},this.lastEventWorldPosition={x:0,y:0,z:0},this.lastEventRotation={x:0,y:0,z:0,w:1},this._playerHeight=1.6,this._cameraMode=v.CameraMode.ThirdPerson,"undefined"!=typeof dcl&&(dcl.subscribe("positionChanged"),dcl.subscribe("rotationChanged"),dcl.subscribe("cameraModeChanged"),dcl.onEvent((function(v){switch(v.type){case"positionChanged":S.positionChanged(v.data);break;case"rotationChanged":S.rotationChanged(v.data);break;case"cameraModeChanged":S.cameraModeChanged(v.data)}}))),Object.defineProperty(this.position,"x",{get:function(){return S.lastEventPosition.x}}),Object.defineProperty(this.position,"y",{get:function(){return S.lastEventPosition.y}}),Object.defineProperty(this.position,"z",{get:function(){return S.lastEventPosition.z}}),Object.defineProperty(this.worldPosition,"x",{get:function(){return S.lastEventWorldPosition.x}}),Object.defineProperty(this.worldPosition,"y",{get:function(){return S.lastEventWorldPosition.y}}),Object.defineProperty(this.worldPosition,"z",{get:function(){return S.lastEventWorldPosition.z}}),Object.defineProperty(this.feetPosition,"x",{get:function(){return S.lastEventPosition.x}}),Object.defineProperty(this.feetPosition,"y",{get:function(){return S.lastEventPosition.y-S.playerHeight}}),Object.defineProperty(this.feetPosition,"z",{get:function(){return S.lastEventPosition.z}}),Object.defineProperty(this.rotation,"x",{get:function(){return S.lastEventRotation.x}}),Object.defineProperty(this.rotation,"y",{get:function(){return S.lastEventRotation.y}}),Object.defineProperty(this.rotation,"z",{get:function(){return S.lastEventRotation.z}}),Object.defineProperty(this.rotation,"w",{get:function(){return S.lastEventRotation.w}})}return Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerHeight",{get:function(){return this._playerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraMode",{get:function(){return this._cameraMode},enumerable:!1,configurable:!0}),e.prototype.positionChanged=function(v){this.lastEventPosition=v.position,this.lastEventWorldPosition=v.cameraPosition,this._playerHeight=v.playerHeight},e.prototype.rotationChanged=function(v){this.lastEventRotation=v.quaternion},e.prototype.cameraModeChanged=function(v){this._cameraMode=v.cameraMode},e}();!function(v){v.HitFirst="rqhf",v.HitAll="rqha"}(Gn||(Gn={}));var Jn,Kn=function(){function t(){this.queries={}}return Object.defineProperty(t,"instance",{get:function(){return t.ensureInstance(),t._instance},enumerable:!1,configurable:!0}),t.ensureInstance=function(){t._instance||(t._instance=new t)},t.prototype.getRayFromCamera=function(v){var S=Zn.instance.rotation,A=Ot.Matrix.Identity();S.toRotationMatrix(A);var E=Ot.Vector3.TransformCoordinates(Ot.Vector3.Forward(),A);return{origin:Zn.instance.position,direction:E,distance:v}},t.prototype.getRayFromPositions=function(v,S){var A=S.subtract(v),E=A.length();return{origin:v,direction:A.normalize(),distance:E}},t.prototype.hitFirst=function(v,S,A){var E="number"==typeof A?Gn.HitFirst+A:m();this.queries[E]=S,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:E,queryType:"HitFirst",ray:v})},t.prototype.hitAll=function(v,S,A){var E="number"==typeof A?Gn.HitAll+A:m();this.queries[E]=S,"undefined"!=typeof dcl&&dcl.query("raycast",{queryId:E,queryType:"HitAll",ray:v})},t.prototype.hitFirstAvatar=function(v,S){c("not implemented yet")},t.prototype.hitAllAvatars=function(v,S){c("not implemented yet")},t.prototype.handleRaycastHitFirstResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t.prototype.handleRaycastHitAllResponse=function(v){this.queries[v.payload.queryId](v.payload.payload),delete this.queries[v.payload.queryId]},t}(),$n=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(ct,this,(function(v){"HitFirst"===v.payload.queryType?Kn.instance.handleRaycastHitFirstResponse(v):"HitAll"===v.payload.queryType&&Kn.instance.handleRaycastHitAllResponse(v)})),"undefined"!=typeof dcl&&dcl.subscribe("raycastResponse")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("raycastResponse")},t}(),ti=function(){function t(){}return t.prototype.activate=function(v){v.eventManager.addListener(ut,this,(function(v){fn.instance.handlePointerEvent(v.payload)})),"undefined"!=typeof dcl&&(dcl.subscribe("pointerUp"),dcl.subscribe("pointerDown"),dcl.subscribe("actionButtonEvent"))},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&(dcl.unsubscribe("pointerUp"),dcl.unsubscribe("pointerDown"),dcl.unsubscribe("actionButtonEvent"))},t}(),ei=function(){function t(){this.handlerMap={}}return t.prototype.activate=function(v){v.eventManager.addListener(lt,this,this.handleEvent),v.eventManager.addListener(B,this,this.componentAdded),v.eventManager.addListener(z,this,this.componentRemoved),"undefined"!=typeof dcl&&dcl.subscribe("uuidEvent")},t.prototype.deactivate=function(){"undefined"!=typeof dcl&&dcl.unsubscribe("uuidEvent")},t.prototype.onAddEntity=function(v){for(var S in v.components){var A=v.components[S];A instanceof Un&&(this.handlerMap[A.uuid]=A)}},t.prototype.onRemoveEntity=function(v){for(var S in v.components){var A=v.components[S];A instanceof Un&&delete this.handlerMap[A.uuid]}},t.prototype.componentAdded=function(v){if(v.entity.isAddedToEngine()){var S=v.entity.components[v.componentName];S instanceof Un&&(this.handlerMap[S.uuid]=S)}},t.prototype.componentRemoved=function(v){v.entity.isAddedToEngine()&&v.component instanceof Un&&delete this.handlerMap[v.component.uuid]},t.prototype.handleEvent=function(v){if(v.uuid in this.handlerMap){var S=this.handlerMap[v.uuid];S&&S.callback&&"call"in S.callback&&S.callback(v.payload)}},t}(),ni=new $n,ii=new ti,oi=new ei,ri=function(S){function n(v){var A=S.call(this)||this;return A.loop=!1,A.volume=1,A.url=v,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"url",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([K.field,s("design:type",String)],n.prototype,"loadingCompleteEventId",void 0),r([K.field,s("design:type",Number)],n.prototype,"volume",void 0),r([N("engine.AudioClip",v.CLASS_ID.AUDIO_CLIP),s("design:paramtypes",[String])],n)}(K),si=function(S){function n(v){var A=S.call(this)||this;if(A.audioClip=v,A.loop=!1,A.volume=1,A.playing=!1,A.pitch=1,A.playedAtTimestamp=Date.now(),!(v instanceof ri))throw new Error("Trying to create AudioSource(AudioClip) with an invalid AudioClip");return A.audioClipId=D(v),A}return i(n,S),n.prototype.playOnce=function(){return this.playing=!0,this.dirty=!0,this.playedAtTimestamp=Date.now(),this.data.nonce=Math.random(),this},r([K.readonly,s("design:type",String)],n.prototype,"audioClipId",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"loop",void 0),r([K.field,s("design:type",Number)],n.prototype,"volume",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([K.field,s("design:type",Number)],n.prototype,"pitch",void 0),r([K.field,s("design:type",Number)],n.prototype,"playedAtTimestamp",void 0),r([P("engine.AudioSource",v.CLASS_ID.AUDIO_SOURCE),s("design:paramtypes",[ri])],n)}(K),ai=function(S){function n(v){var A=S.call(this)||this;return A.playing=!1,A.volume=1,A.url=v,A.playing=!0,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"url",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"playing",void 0),r([K.field,s("design:type",Number)],n.prototype,"volume",void 0),r([P("engine.AudioStream",v.CLASS_ID.AUDIO_STREAM),s("design:paramtypes",[String])],n)}(K);v.Gizmo=void 0,(Jn=v.Gizmo||(v.Gizmo={})).MOVE="MOVE",Jn.ROTATE="ROTATE",Jn.SCALE="SCALE",Jn.NONE="NONE";var hi,li=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.type="gizmoEvent",v}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.gizmoEvent",v.CLASS_ID.UUID_CALLBACK)],n)}(Un),ci=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.position=!0,v.rotation=!0,v.scale=!0,v.cycle=!0,v.localReference=!1,v}return i(n,S),r([K.field,s("design:type",Boolean)],n.prototype,"position",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"rotation",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"scale",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"cycle",void 0),r([K.field,s("design:type",String)],n.prototype,"selectedGizmo",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"localReference",void 0),r([P("engine.gizmos",v.CLASS_ID.GIZMOS)],n)}(K),ui=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onFocus",oi.handlerMap[A.uuid]=A,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onFocus",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Un),di=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onTextSubmit",oi.handlerMap[A.uuid]=A,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onTextSubmit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Un),pi=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onBlur",oi.handlerMap[A.uuid]=A,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onBlur",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Un),fi=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onEnter",oi.handlerMap[A.uuid]=A,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Un),gi=function(S){function n(v){var A=S.call(this,v)||this;return A.type="onChange",oi.handlerMap[A.uuid]=A,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onChange",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Un),mi=function(S){function n(v,A){var E=S.call(this,v)||this;return E.type="onClick",oi.handlerMap[E.uuid]=E,A&&(E.showFeedback=!(!1===A.showFeedback),A.button&&(E.button=A.button),A.hoverText&&(E.hoverText=A.hoverText),A.distance&&(E.distance=A.distance)),E}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.onClick",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Vn),yi=function(S){function n(v,A){var E=S.call(this,v)||this;return E.type="pointerDown",oi.handlerMap[E.uuid]=E,A&&(E.showFeedback=!(!1===A.showFeedback),A.button&&(E.button=A.button),A.hoverText&&(E.hoverText=A.hoverText),A.distance&&(E.distance=A.distance)),E}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerDown",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Vn),vi=function(S){function n(v,A){var E=S.call(this,v)||this;return E.type="pointerUp",oi.handlerMap[E.uuid]=E,A&&(E.showFeedback=!(!1===A.showFeedback),A.button&&(E.button=A.button),A.hoverText&&(E.hoverText=A.hoverText),A.distance&&(E.distance=A.distance)),E}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerUp",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Vn),bi=function(S){function n(v,A){var E=S.call(this,v)||this;return E.type="pointerHoverEnter",oi.handlerMap[E.uuid]=E,A&&A.distance&&(E.distance=A.distance),E}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverEnter",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function,Object])],n)}(Vn),Ti=function(S){function n(v){var A=S.call(this,v)||this;return A.type="pointerHoverExit",oi.handlerMap[A.uuid]=A,A.distance=160,A}return i(n,S),r([K.readonly,s("design:type",String)],n.prototype,"type",void 0),r([P("engine.pointerHoverExit",v.CLASS_ID.UUID_CALLBACK),s("design:paramtypes",[Function])],n)}(Vn),wi=function(v){function e(S){var A=v.call(this)||this;return A.name=null,A.visible=!0,A.opacity=1,A.hAlign="center",A.vAlign="center",A.width="100px",A.height="50px",A.positionX="0px",A.positionY="0px",A.isPointerBlocker=!0,S&&(A._parent=S,A.data.parentComponent=D(S)),A}return i(e,v),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentComponent",{get:function(){return this.data.parentComponent},enumerable:!1,configurable:!0}),r([K.field,s("design:type",Object)],e.prototype,"name",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"visible",void 0),r([K.field,s("design:type",Number)],e.prototype,"opacity",void 0),r([K.field,s("design:type",String)],e.prototype,"hAlign",void 0),r([K.field,s("design:type",String)],e.prototype,"vAlign",void 0),r([K.uiValue,s("design:type",Object)],e.prototype,"width",void 0),r([K.uiValue,s("design:type",Object)],e.prototype,"height",void 0),r([K.uiValue,s("design:type",Object)],e.prototype,"positionX",void 0),r([K.uiValue,s("design:type",Object)],e.prototype,"positionY",void 0),r([K.field,s("design:type",Boolean)],e.prototype,"isPointerBlocker",void 0),e}(K),Ci=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",v.CLASS_ID.UI_FULLSCREEN_SHAPE),s("design:paramtypes",[])],n)}(wi),xi=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",v.CLASS_ID.UI_WORLD_SPACE_SHAPE),s("design:paramtypes",[])],n)}(wi),Si=function(S){function n(){return S.call(this,null)||this}return i(n,S),r([N("engine.shape",v.CLASS_ID.UI_SCREEN_SPACE_SHAPE),s("design:paramtypes",[])],n)}(wi),Ai=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.thickness=0,v.color=Ot.Color4.Clear(),v.alignmentUsesSize=!0,v}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"alignmentUsesSize",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_RECT)],n)}(wi);v.UIStackOrientation=void 0,(hi=v.UIStackOrientation||(v.UIStackOrientation={}))[hi.VERTICAL=0]="VERTICAL",hi[hi.HORIZONTAL=1]="HORIZONTAL";var Ei=function(S){function n(){var A=null!==S&&S.apply(this,arguments)||this;return A.adaptWidth=!0,A.adaptHeight=!0,A.color=Ot.Color4.Clear(),A.stackOrientation=v.UIStackOrientation.VERTICAL,A.spacing=0,A}return i(n,S),r([K.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Number)],n.prototype,"stackOrientation",void 0),r([K.field,s("design:type",Number)],n.prototype,"spacing",void 0),r([N("engine.shape",v.CLASS_ID.UI_CONTAINER_STACK)],n)}(wi),_i=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.fontSize=10,v.fontWeight="normal",v.thickness=0,v.cornerRadius=0,v.color=Ot.Color4.White(),v.background=Ot.Color4.White(),v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Ot.Color4.Black(),v.text="button",v}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([K.field,s("design:type",String)],n.prototype,"fontWeight",void 0),r([K.field,s("design:type",Number)],n.prototype,"thickness",void 0),r([K.field,s("design:type",Number)],n.prototype,"cornerRadius",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"background",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"shadowColor",void 0),r([K.field,s("design:type",String)],n.prototype,"text",void 0),r([N("engine.shape",v.CLASS_ID.UI_BUTTON_SHAPE)],n)}(wi),Pi=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.outlineWidth=0,v.outlineColor=Ot.Color4.White(),v.color=Ot.Color4.White(),v.fontSize=10,v.fontAutoSize=!1,v.value="",v.lineSpacing=0,v.lineCount=0,v.adaptWidth=!1,v.adaptHeight=!1,v.textWrapping=!1,v.shadowBlur=0,v.shadowOffsetX=0,v.shadowOffsetY=0,v.shadowColor=Ot.Color4.Black(),v.hTextAlign="left",v.vTextAlign="bottom",v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"outlineColor",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"fontAutoSize",void 0),r([K.component,s("design:type",Dn)],n.prototype,"font",void 0),r([K.field,s("design:type",String)],n.prototype,"value",void 0),r([K.field,s("design:type",Number)],n.prototype,"lineSpacing",void 0),r([K.field,s("design:type",Number)],n.prototype,"lineCount",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"adaptWidth",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"adaptHeight",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"shadowColor",void 0),r([K.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([K.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([N("engine.shape",v.CLASS_ID.UI_TEXT_SHAPE)],n)}(wi),Ii=function(S){function n(v){var A=S.call(this,v)||this;return A.outlineWidth=0,A.outlineColor=Ot.Color4.Black(),A.color=Ot.Color4.Clear(),A.fontSize=10,A.value="",A.placeholder="",A.margin=10,A.hTextAlign="left",A.vTextAlign="bottom",A.focusedBackground=Ot.Color4.Black(),A.textWrapping=!1,A.shadowBlur=0,A.shadowOffsetX=0,A.shadowOffsetY=0,A.shadowColor=Ot.Color4.White(),A.paddingTop=0,A.paddingRight=0,A.paddingBottom=0,A.paddingLeft=0,A.onTextSubmit=null,A.onChanged=null,A.onFocus=null,A.onBlur=null,A.onTextChanged=new gi((function(v){var S=v.value,E=S.value,R=S.isSubmit,O=A.dirty;if(A.value=E,A.dirty=O,R&&A.onTextSubmit){var z={text:E};A.onTextSubmit.callback(z)}else if(!R&&A.onChanged){var B={value:E,pointerId:v.pointerId};A.onChanged.callback(B)}})),A}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"outlineWidth",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"outlineColor",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"color",void 0),r([K.field,s("design:type",Number)],n.prototype,"fontSize",void 0),r([K.component,s("design:type",Dn)],n.prototype,"font",void 0),r([K.field,s("design:type",String)],n.prototype,"value",void 0),r([K.field,s("design:type",String)],n.prototype,"placeholder",void 0),r([K.field,s("design:type",Number)],n.prototype,"margin",void 0),r([K.field,s("design:type",String)],n.prototype,"hTextAlign",void 0),r([K.field,s("design:type",String)],n.prototype,"vTextAlign",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"focusedBackground",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"textWrapping",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowBlur",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetX",void 0),r([K.field,s("design:type",Number)],n.prototype,"shadowOffsetY",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"shadowColor",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Un.uuidEvent,s("design:type",gi)],n.prototype,"onTextChanged",void 0),r([Un.uuidEvent,s("design:type",Object)],n.prototype,"onFocus",void 0),r([Un.uuidEvent,s("design:type",Object)],n.prototype,"onBlur",void 0),r([N("engine.shape",v.CLASS_ID.UI_INPUT_TEXT_SHAPE),s("design:paramtypes",[Object])],n)}(wi),Oi=function(S){function n(v,A){var E=S.call(this,v)||this;return E.sourceLeft=0,E.sourceTop=0,E.sourceWidth=1,E.sourceHeight=1,E.paddingTop=0,E.paddingRight=0,E.paddingBottom=0,E.paddingLeft=0,E.sizeInPixels=!0,E.onClick=null,E.source=A,E}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"sourceLeft",void 0),r([K.field,s("design:type",Number)],n.prototype,"sourceTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"sourceWidth",void 0),r([K.field,s("design:type",Number)],n.prototype,"sourceHeight",void 0),r([K.component,s("design:type",Object)],n.prototype,"source",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"sizeInPixels",void 0),r([Un.uuidEvent,s("design:type",Object)],n.prototype,"onClick",void 0),r([N("engine.shape",v.CLASS_ID.UI_IMAGE_SHAPE),s("design:paramtypes",[wi,Object])],n)}(wi),zi=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.valueX=0,v.valueY=0,v.backgroundColor=Ot.Color4.Clear(),v.isHorizontal=!1,v.isVertical=!1,v.paddingTop=0,v.paddingRight=0,v.paddingBottom=0,v.paddingLeft=0,v.onChanged=null,v}return i(n,S),r([K.field,s("design:type",Number)],n.prototype,"valueX",void 0),r([K.field,s("design:type",Number)],n.prototype,"valueY",void 0),r([K.field,s("design:type",Ot.Color4)],n.prototype,"backgroundColor",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"isHorizontal",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"isVertical",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingTop",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingRight",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingBottom",void 0),r([K.field,s("design:type",Number)],n.prototype,"paddingLeft",void 0),r([Un.uuidEvent,s("design:type",Object)],n.prototype,"onChanged",void 0),r([N("engine.shape",v.CLASS_ID.UI_SLIDER_SHAPE)],n)}(wi),Bi=function(S){function n(){var v=null!==S&&S.apply(this,arguments)||this;return v.useDummyModel=!1,v.talking=!1,v}var A;return i(n,S),A=n,n.Dummy=function(){var v=new A;return v.useDummyModel=!0,v},r([K.field,s("design:type",String)],n.prototype,"id",void 0),r([K.field,s("design:type",String)],n.prototype,"name",void 0),r([K.field,s("design:type",String)],n.prototype,"expressionTriggerId",void 0),r([K.field,s("design:type",Number)],n.prototype,"expressionTriggerTimestamp",void 0),r([K.field,s("design:type",String)],n.prototype,"bodyShape",void 0),r([K.field,s("design:type",Array)],n.prototype,"wearables",void 0),r([K.field,s("design:type",Object)],n.prototype,"skinColor",void 0),r([K.field,s("design:type",Object)],n.prototype,"hairColor",void 0),r([K.field,s("design:type",Object)],n.prototype,"eyeColor",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"useDummyModel",void 0),r([K.field,s("design:type",Boolean)],n.prototype,"talking",void 0),A=r([P("engine.avatarShape",v.CLASS_ID.AVATAR_SHAPE)],n)}(K),Di=null,Ni=null,Mi=null;function Ri(){return Mi||(Mi=new ht),Mi}var Li=function(){function t(){var v=this;this.messageQueue=[],this.connected=!1,this.flushing=!1,function(){if(!Ni){(Ni=dcl.loadModule("@decentraland/CommunicationsController",{})).then((function(v){Di=v}));var v=Ri();dcl.subscribe("comms"),dcl.onEvent((function(S){"comms"===S.type&&v.notifyObservers(S.data)}))}return Ni}().then((function(){v.connected=!0,v.flush()}))}return t.prototype.on=function(v,S){return Ri().add((function(A){try{var E=JSON.parse(A.message);E.message===v&&S(E.payload,A.sender)}catch(A){dcl.error("Error parsing comms message "+(A.message||""),A)}}))},t.prototype.sendRaw=function(v){this.messageQueue.push(v),this.connected&&this.flush()},t.prototype.emit=function(v,S){var A=JSON.stringify({message:v,payload:S});this.sendRaw(A),Ri().notifyObservers({message:A,sender:"self"})},t.prototype.flush=function(){var v=this;if(0!==this.messageQueue.length&&this.connected&&Di&&!this.flushing){var S=this.messageQueue.shift();this.flushing=!0,dcl.callRpc(Di.rpcHandle,"send",[S]).then((function(S){v.flushing=!1,v.flush()}),(function(S){v.flushing=!1,y("Error flushing MessageBus",S)}))}},t}(),ki=new et("scene");ki.uuid="0";var Fi=new nt(ki);N.engine=Fi,"undefined"!=typeof dcl&&(Fi.addSystem(new It(dcl),1/0),mt(dcl)),Fi.addSystem(oi),Fi.addSystem(ii),Fi.addSystem(ni),v.AVATAR_OBSERVABLE="AVATAR_OBSERVABLE",v.Angle=Ot.Angle,v.AnimationState=ln,v.Animator=zn,v.Arc2=Ot.Arc2,v.AttachToAvatar=bn,v.Attachable=S,v.AudioClip=ri,v.AudioSource=si,v.AudioStream=ai,v.AvatarModifierArea=mn,v.AvatarShape=Bi,v.AvatarTexture=Qn,v.Axis=Ot.Axis,v.BasicMaterial=Fn,v.BezierCurve=Ot.BezierCurve,v.Billboard=Tn,v.BoxShape=Cn,v.Camera=Zn,v.CameraModeArea=Yn,v.CircleShape=Sn,v.Color3=Ot.Color3,v.Color4=Ot.Color4,v.Component=P,v.ComponentAdded=B,v.ComponentGroup=$,v.ComponentRemoved=z,v.ConeShape=En,v.Curve3=Ot.Curve3,v.CylinderShape=_n,v.DEG2RAD=Ot.DEG2RAD,v.DisposableComponent=N,v.DisposableComponentCreated=Q,v.DisposableComponentRemoved=Z,v.DisposableComponentUpdated=J,v.Engine=nt,v.Entity=et,v.Epsilon=Ot.Epsilon,v.EventConstructor=x,v.EventManager=R,v.Font=Dn,v.Frustum=Ot.Frustum,v.GLTFShape=Pn,v.Gizmos=ci,v.GlobalPointerDown=dn,v.GlobalPointerUp=pn,v.Input=fn,v.Material=kn,v.Matrix=Ot.Matrix,v.MessageBus=Li,v.MultiObserver=at,v.NFTShape=Rn,v.OBJShape=Bn,v.Observable=ht,v.ObservableComponent=K,v.Observer=Y,v.ObserverEventState=st,v.OnAnimationEnd=Hn,v.OnBlur=pi,v.OnChanged=gi,v.OnClick=mi,v.OnEnter=fi,v.OnFocus=ui,v.OnGizmoEvent=li,v.OnPointerDown=yi,v.OnPointerHoverEnter=bi,v.OnPointerHoverExit=Ti,v.OnPointerLock=Wn,v.OnPointerUUIDEvent=Vn,v.OnPointerUp=vi,v.OnTextSubmit=di,v.OnUUIDEvent=Un,v.Orientation=Ot.Orientation,v.ParentChanged=M,v.Path2=Ot.Path2,v.Path3D=Ot.Path3D,v.PhysicsCast=Kn,v.Plane=Ot.Plane,v.PlaneShape=An,v.PointerEvent=ut,v.PointerEventComponent=Ke,v.PointerEventSystem=ti,v.Quaternion=Ot.Quaternion,v.RAD2DEG=Ot.RAD2DEG,v.RaycastEventSystem=$n,v.RaycastResponse=ct,v.Scalar=Ot.Scalar,v.Shape=wn,v.Size=Ot.Size,v.SmartItem=jn,v.Space=Ot.Space,v.SphereShape=xn,v.Subscription=en,v.TextShape=Mn,v.Texture=On,v.ToGammaSpace=Ot.ToGammaSpace,v.ToLinearSpace=Ot.ToLinearSpace,v.Transform=yn,v.UIButton=_i,v.UICanvas=Si,v.UIContainerRect=Ai,v.UIContainerStack=Ei,v.UIFullScreen=Ci,v.UIImage=Oi,v.UIInputText=Ii,v.UIScrollRect=zi,v.UIShape=wi,v.UIText=Pi,v.UIValue=V,v.UIWorldSpace=xi,v.UUIDEvent=lt,v.UUIDEventSystem=ei,v.Vector2=Ot.Vector2,v.Vector3=Ot.Vector3,v.Vector4=Ot.Vector4,v.VideoClip=qn,v.VideoTexture=Xn,v._initEventObservables=mt,v.buildArray=function(v,S){for(var A=[],E=0;E<v;++E)A.push(S());return A},v.engine=Fi,v.error=y,v.executeTask=G,v.getComponentClassId=L,v.getComponentId=D,v.getComponentName=F,v.getMessageObserver=Ri,v.isDisposableComponent=U,v.log=c,v.newId=f,v.onCameraModeChangedObservable=dt,v.onEnterScene=gt,v.onEnterSceneObservable=ft,v.onIdleStateChangedObservable=pt,v.onLeaveScene=vt,v.onLeaveSceneObservable=yt,v.onPlayerClickedObservable=Pt,v.onPlayerConnectedObservable=St,v.onPlayerDisconnectedObservable=At,v.onPlayerExpressionObservable=Tt,v.onPointerLockedStateChange=wt,v.onProfileChanged=xt,v.onRealmChangedObservable=_t,v.onSceneReadyObservable=bt,v.onVideoEvent=Ct,v.openExternalURL=function(v){"undefined"!=typeof dcl?dcl.openExternalUrl(v):y("ERROR: openExternalURL dcl is undefined")},v.openNFTDialog=function(v,S){if(void 0===S&&(S=null),"undefined"!=typeof dcl){var A=v.match(/ethereum:\/\/(.+)\/(.+)/);if(!A||A.length<3)return;dcl.openNFTDialog(A[1],A[2],S)}else y("ERROR: openNFTDialog dcl is undefined")},v.pointerEventSystem=ii,v.raycastEventSystem=ni,v.teleportTo=function(v){var S;S=[v],void 0===ot&&"undefined"!=typeof dcl&&(ot=dcl.loadModule("@decentraland/UserActionModule",{})),void 0!==ot&&"undefined"!=typeof dcl&&ot.then((function(v){dcl.callRpc(v.rpcHandle,"requestTeleport",S)}))},v.uuid=m,v.uuidEventSystem=oi,Object.defineProperty(v,"__esModule",{value:!0})}(this.self=this.self||{}),define("@dcl/ecs-scene-utils",["exports","@decentraland/EnvironmentAPI"],(function(v,S){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var n=function(v,S){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,S){v.__proto__=S}||function(v,S){for(var A in S)Object.prototype.hasOwnProperty.call(S,A)&&(v[A]=S[A])})(v,S)};function i(v,S){function i(){this.constructor=v}n(v,S),v.prototype=null===S?Object.create(S):(i.prototype=S.prototype,new i)}function r(v,S,A,E){var R,O=arguments.length,z=O<3?S:null===E?E=Object.getOwnPropertyDescriptor(S,A):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,S,A,E);else for(var B=v.length-1;B>=0;B--)(R=v[B])&&(z=(O<3?R(z):O>3?R(S,A,z):R(S,A))||z);return O>3&&z&&Object.defineProperty(S,A,z),z}function o(v,S,A,E){return new(A||(A=Promise))((function(R,O){function a(v){try{u(E.next(v))}catch(v){O(v)}}function s(v){try{u(E.throw(v))}catch(v){O(v)}}function u(v){var S;v.done?R(v.value):(S=v.value,S instanceof A?S:new A((function(v){v(S)}))).then(a,s)}u((E=E.apply(v,S||[])).next())}))}function a(v,S){var A,E,R,O,z={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return O={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function s(O){return function(B){return function(O){if(A)throw new TypeError("Generator is already executing.");for(;z;)try{if(A=1,E&&(R=2&O[0]?E.return:O[0]?E.throw||((R=E.return)&&R.call(E),0):E.next)&&!(R=R.call(E,O[1])).done)return R;switch(E=0,R&&(O=[2&O[0],R.value]),O[0]){case 0:case 1:R=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,E=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((R=(R=z.trys).length>0&&R[R.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!R||O[1]>R[0]&&O[1]<R[3])){z.label=O[1];break}if(6===O[0]&&z.label<R[1]){z.label=R[1],R=O;break}if(R&&z.label<R[2]){z.label=R[2],z.ops.push(O);break}R[2]&&z.ops.pop(),z.trys.pop();continue}O=S.call(v,z)}catch(v){O=[6,v],E=0}finally{A=R=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,B])}}}function s(v){var S="function"==typeof Symbol&&Symbol.iterator,A=S&&v[S],E=0;if(A)return A.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,E=function(){function e(){this._components=[],this._componentGroups=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var S,A;try{for(var E=s(this._components),R=E.next();!R.done;R=E.next())if(v==R.value)return}catch(v){S={error:v}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}this._components.push(v),this._componentGroups.push(engine.getComponentGroup(v,Transform))},e.prototype.update=function(v){for(var S=0;S<this._components.length;S++)this.updateComponent(v,this._components[S],this._componentGroups[S])},e.prototype.updateComponent=function(v,S,A){A.entities.forEach((function(A){var E=A.getComponent(Transform),R=A.getComponent(S);R.update(v),R.assignValueToTransform(E),R.hasFinished()&&(A.removeComponent(R),null!=R.onFinishCallback&&R.onFinishCallback())}))},e._instance=null,e}();function h(S,A){switch(S){case v.InterpolationType.LINEAR:return A;case v.InterpolationType.EASEINQUAD:return function(v){return v*v}(A);case v.InterpolationType.EASEOUTQUAD:return function(v){return v*(2-v)}(A);case v.InterpolationType.EASEQUAD:return function(v){return v*v/(2*(v*v-v)+1)}(A);case v.InterpolationType.EASEINSINE:return function(v){return 1-Math.cos(v*Math.PI/2)}(A);case v.InterpolationType.EASEOUTSINE:return function(v){return Math.sin(v*Math.PI/2)}(A);case v.InterpolationType.EASESINE:return function(v){return-(Math.cos(Math.PI*v)-1)/2}(A);case v.InterpolationType.EASEINEXPO:return function(v){return 0===v?0:Math.pow(2,10*v-10)}(A);case v.InterpolationType.EASEOUTEXPO:return function(v){return 1===v?1:1-Math.pow(2,-10*v)}(A);case v.InterpolationType.EASEEXPO:return function(v){return 0===v?0:1===v?1:v<.5?Math.pow(2,20*v-10)/2:(2-Math.pow(2,-20*v+10))/2}(A);case v.InterpolationType.EASEINELASTIC:return function(v){var S=2*Math.PI/3;return 0===v?0:1===v?1:-Math.pow(2,10*v-10)*Math.sin((10*v-10.75)*S)}(A);case v.InterpolationType.EASEOUTELASTIC:return function(v){var S=2*Math.PI/3;return 0===v?0:1===v?1:Math.pow(2,-10*v)*Math.sin((10*v-.75)*S)+1}(A);case v.InterpolationType.EASEELASTIC:return function(v){var S=2*Math.PI/4.5;return 0===v?0:1===v?1:v<.5?-Math.pow(2,20*v-10)*Math.sin((20*v-11.125)*S)/2:Math.pow(2,-20*v+10)*Math.sin((20*v-11.125)*S)/2+1}(A);case v.InterpolationType.EASEINBOUNCE:return function(v){return 1-l(1-v)}(A);case v.InterpolationType.EASEOUTEBOUNCE:return function(v){return l(v)}(A);case v.InterpolationType.EASEBOUNCE:return function(v){return v<.5?(1-l(1-2*v))/2:(1+l(2*v-1))/2}(A);default:return A}}function l(v){var S=7.5625,A=2.75;return v<1/A?S*v*v:v<2/A?S*(v-=1.5/A)*v+.75:v<2.5/A?S*(v-=2.25/A)*v+.9375:S*(v-=2.625/A)*v+.984375}v.InterpolationType=void 0,(A=v.InterpolationType||(v.InterpolationType={}))[A.LINEAR=0]="LINEAR",A[A.EASEINQUAD=1]="EASEINQUAD",A[A.EASEOUTQUAD=2]="EASEOUTQUAD",A[A.EASEQUAD=3]="EASEQUAD",A.EASEINSINE="easeinsine",A.EASEOUTSINE="easeoutsine",A.EASESINE="easeinoutsine",A.EASEINEXPO="easeinexpo",A.EASEOUTEXPO="easeoutexpo",A.EASEEXPO="easeinoutexpo",A.EASEINELASTIC="easeinelastic",A.EASEOUTELASTIC="easeoutelastic",A.EASEELASTIC="easeinoutelastic",A.EASEINBOUNCE="easeinbounce",A.EASEOUTEBOUNCE="easeoutbounce",A.EASEBOUNCE="easeinoutbounce";var R,O=function(){function t(A,R,O,z,B){void 0===B&&(B=v.InterpolationType.LINEAR),this.start=A,this.end=R,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=B,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.start,this.end,this.lerpTime)},S=r([Component("moveTransformComponent")],t)}(),z=function(){function t(A,R,O,z,B){void 0===B&&(B=v.InterpolationType.LINEAR),this.start=A,this.end=R,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=B,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)},S=r([Component("rotateTransformComponent")],t)}(),B=function(){function t(A,R,O,z,B){void 0===B&&(B=v.InterpolationType.LINEAR),this.start=A,this.end=R,this.normalizedTime=0,this.lerpTime=0,this.onFinishCallback=z,this.interpolationType=B,0!=O?this.speed=1/O:(this.speed=0,this.normalizedTime=1,this.lerpTime=1),E.createAndAddToEngine().addComponentType(S)}var S;return S=t,t.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed,0,1),this.lerpTime=h(this.interpolationType,this.normalizedTime)},t.prototype.hasFinished=function(){return this.normalizedTime>=1},t.prototype.assignValueToTransform=function(v){v.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)},S=r([Component("scaleTransformComponent")],t)}(),M=function(){function e(S,A,R,O){if(this.speed=[],this.normalizedTime=0,this.currentIndex=0,this.points=S,this.onFinishCallback=R,this.onPointReachedCallback=O,S.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(A>0){for(var z=0,B=[],M=0;M<S.length-1;M++){var V=Vector3.Distance(S[M],S[M+1]);z+=V,B.push(V)}for(M=0;M<B.length;M++)this.speed.push(1/(B[M]/z*A))}else this.normalizedTime=1,this.currentIndex=S.length-2;E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1]))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)},v=r([Component("followPathComponent")],e)}(),V=function(){function e(S,A,R,O,z,B){if(this.speed=[],this.turnToFaceNext=!1,this.facingNext=!1,this.normalizedTime=0,this.currentIndex=0,this.points=Curve3.CreateCatmullRomSpline(S,R,!!z).getPoints(),this.onFinishCallback=B,this.turnToFaceNext=O||!1,this.points.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(A>0){for(var M=0,V=[],W=0;W<this.points.length-1;W++){var H=Vector3.Distance(this.points[W],this.points[W+1]);M+=H,V.push(H)}for(W=0;W<V.length;W++)this.speed.push(1/(V[W]/M*A))}else this.normalizedTime=1,this.currentIndex=S.length-2;E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.normalizedTime=Scalar.Clamp(this.normalizedTime+v*this.speed[this.currentIndex],0,1),this.normalizedTime>=1&&this.currentIndex<this.points.length-2&&(this.currentIndex++,this.normalizedTime=0,1==this.turnToFaceNext&&(this.facingNext=!1))},e.prototype.hasFinished=function(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1},e.prototype.assignValueToTransform=function(v){v.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime),this.facingNext||(this.facingNext=!0,this.currentIndex<this.points.length-1?v.lookAt(this.points[this.currentIndex+1]):v.lookAt(this.points[0]))},v=r([Component("followCurvedPathComponent")],e)}(),W=function(){function e(S,A){this.rotationVelocity=S,this.onFinishCallback=A,this.rotation=Quaternion.Identity,this.finished=!1,E.createAndAddToEngine().addComponentType(v)}var v;return v=e,e.prototype.update=function(v){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,v)},e.prototype.hasFinished=function(){return this.finished},e.prototype.assignValueToTransform=function(v){v.rotation=v.rotation.multiply(this.rotation)},e.prototype.stop=function(){this.finished=!0},v=r([Component("keepRotatingComponent")],e)}();v.ToggleState=void 0,(R=v.ToggleState||(v.ToggleState={}))[R.Off=0]="Off",R[R.On=1]="On";var H=function(){function t(S,A){void 0===S&&(S=v.ToggleState.On),this.enabled=!0,this.state=v.ToggleState.Off,this.set(S),A&&this.setCallback(A)}return t.prototype.set=function(v){this.state=v,this.onValueChangedCallback&&this.onValueChangedCallback(v)},t.prototype.toggle=function(){this.enabled&&this.set(1-this.state)},t.prototype.isOn=function(){return this.state==v.ToggleState.On},t.prototype.setCallback=function(v){this.onValueChangedCallback=v},r([Component("toggle")],t)}(),X=function(){function e(){this._components=[],e._instance=this}return e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.registerCustomComponent=function(v){this.createAndAddToEngine()._components.push(v)},e.prototype.addComponentType=function(v){var S,A;try{for(var E=s(this._components),R=E.next();!R.done;R=E.next())if(v==R.value)return}catch(v){S={error:v}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}this._components.push(v)},e.prototype.update=function(v){var S=this;this._components.forEach((function(A){S.updateComponent(v,A)}))},e.prototype.updateComponent=function(v,S){var A=engine.getEntitiesWithComponent(S);for(var E in A)if(A.hasOwnProperty(E)){var R=A[E],O=R.getComponent(S);O.elapsedTime+=v,O.elapsedTime>=O.targetTime&&O.onTargetTimeReached(R)}},e._instance=null,e}(),Q=function(){function e(S,A){var E=this;X.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=A,this.onTargetTimeReached=function(v){E.onTimeReachedCallback&&E.onTimeReachedCallback(),v.removeComponent(E)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerDelay")],e)}(),Z=function(){function e(S,A){var E=this;X.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=A,this.onTargetTimeReached=function(v){E.onTimeReachedCallback&&E.onTimeReachedCallback(),v.removeComponent(E),engine.removeEntity(v)}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerExpireIn")],e)}(),J=function(){function e(S,A){var E=this;X.createAndAddToEngine().addComponentType(v),this.elapsedTime=0,this.targetTime=S/1e3,this.onTimeReachedCallback=A,this.onTargetTimeReached=function(){E.elapsedTime=0,E.onTimeReachedCallback&&E.onTimeReachedCallback()}}var v;return v=e,e.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=r([Component("timerInterval")],e)}();function I(v,S,A,E,R,O){var z=new Entity;z.addComponent(new Transform(O||{position:new Vector3(0,1.5,0)})),z.setParent(S);var B=new TextShape(v);return B.fontSize=R||3,B.color=E||Color3.Black(),z.addComponent(B),A&&z.addComponent(new Billboard),engine.addEntity(z),z}var K,$,et=function(){function e(){this._triggers={},e._instance=this,this._cameraTriggerWrapper=new it(new P(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(ot)}return Object.defineProperty(e,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},e.prototype.update=function(){var v=this,S=this._componentGroup.entities;for(var A in S.forEach((function(S){v.shouldWrapTriggerEntity(S)&&v.wrapTriggerEntity(S)})),this._triggers)if(this._triggers.hasOwnProperty(A)){var E=this._triggers[A];E.isDebugging()&&E.updateDebugEntity(),E.isInEngine()?null!=E.trigger&&E.trigger.enabled?(E.wasEnabled||E.isDebugging()&&E.addDebugEntity(),E.wasEnabled=!0,(E.trigger.onCameraEnter||E.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(E),(E.trigger.onTriggerEnter||E.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(E)):E.wasEnabled&&(E.wasEnabled=!1,E.isDebugging()&&E.removeDebugEntity(),e.removeTriggerFromSystem(E)):(E.isDebugging()&&E.removeDebugEntity(),e.removeTriggerFromSystem(E),delete this._triggers[A])}},e.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},e.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new nt(v)},e.removeTriggerFromSystem=function(v){for(var S,A=v.getActiveCollisions(),E=0;E<A.length;E++)!(A[E]===(null===(S=e._instance)||void 0===S?void 0:S._cameraTriggerWrapper)||null==A[E].trigger)&&A[E].trigger.onTriggerExit&&v.entity&&A[E].trigger.onTriggerExit(v.entity),A[E].disengageActiveCollision(v),v.disengageActiveCollision(A[E])},e.disengageCollision=function(v,S){v.disengageActiveCollision(S),S.disengageActiveCollision(v),v.trigger.onTriggerExit&&S.entity&&v.trigger.onTriggerExit(S.entity),S.trigger.onTriggerExit&&v.entity&&S.trigger.onTriggerExit(v.entity)},e.engageCollision=function(v,S){v.engageCollision(S),S.engageCollision(v),v.trigger.onTriggerEnter&&S.entity&&v.trigger.onTriggerEnter(S.entity),S.trigger.onTriggerEnter&&v.entity&&S.trigger.onTriggerEnter(v.entity)},e.prototype.checkCollisionAgainstCamera=function(v){var S=v.hasActiveCollision(this._cameraTriggerWrapper),A=e.areColliding(v,this._cameraTriggerWrapper);S&&!A?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!S&&A&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},e.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var S in this._triggers)if(this._triggers.hasOwnProperty(S)&&S!=v.uuid&&this._triggers[S].trigger.enabled&&e.canTriggersCollide(v,this._triggers[S])){var A=v.hasActiveCollision(this._triggers[S]),E=e.areColliding(v,this._triggers[S]);A&&!E?e.disengageCollision(v,this._triggers[S]):!A&&E&&e.engageCollision(v,this._triggers[S])}},e.canTriggersCollide=function(v,S){return 0==v.trigger.triggeredByLayer||0!=(S.trigger.layer&v.trigger.triggeredByLayer)},e.areColliding=function(v,S){return v.getShape()instanceof P&&S.getShape()instanceof P?e.areCollidingAABB(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof k&&S.getShape()instanceof k?e.areCollidingSphere(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof P&&S.getShape()instanceof k?e.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof k&&S.getShape()instanceof P&&e.areCollidingAABBSphere(S.getGlobalPosition(),S.getShape(),v.getGlobalPosition(),v.getShape())},e.areCollidingAABB=function(v,S,A,E){var R=e.getBoxShapeValues(v,S),O=e.getBoxShapeValues(A,E);return R.min.x<=O.max.x&&R.max.x>=O.min.x&&R.min.y<=O.max.y&&R.max.y>=O.min.y&&R.min.z<=O.max.z&&R.max.z>=O.min.z},e.areCollidingSphere=function(v,S,A,E){return Vector3.DistanceSquared(v.add(S.position),A.add(E.position))<S.radius*S.radius+E.radius*E.radius},e.areCollidingAABBSphere=function(v,S,A,E){var R=e.getBoxShapeValues(v,S),O=A.add(E.position),z=E.radius,B=0;return O.x<R.min.x&&(B+=(R.min.x-O.x)*(R.min.x-O.x)),O.x>R.max.x&&(B+=(O.x-R.max.x)*(O.x-R.max.x)),O.y<R.min.y&&(B+=(R.min.y-O.y)*(R.min.y-O.y)),O.y>R.max.y&&(B+=(O.y-R.max.y)*(O.y-R.max.y)),O.z<R.min.z&&(B+=(R.min.z-O.z)*(R.min.z-O.z)),O.z>R.max.z&&(B+=(O.z-R.max.z)*(O.z-R.max.z)),B<z*z},e.getBoxShapeValues=function(v,S){var A=v.add(S.position);return{center:A,min:A.subtract(S.size.scale(.5)),max:A.add(S.size.scale(.5))}},e._instance=null,e}(),nt=function(){function e(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(ot),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(e.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),e.prototype.getGlobalPosition=function(){return this._entity?e.getEntityWorldPosition(this._entity):Vector3.Zero()},e.prototype.getShape=function(){return this._trigger.shape},e.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},e.prototype.getActiveCollisions=function(){var v=[];for(var S in this._collidingWith)this._collidingWith.hasOwnProperty(S)&&v.push(this._collidingWith[S]);return v},e.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},e.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},e.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},e.prototype.isDebugging=function(){return this._isDebug},e.prototype.addDebugEntity=function(){return o(this,void 0,void 0,(function(){var v,A,E;return a(this,(function(R){switch(R.label){case 0:return[4,!S.isPreviewMode()];case 1:return R.sent()||(e._debugMaterial||(e._debugMaterial=new Material,e._debugMaterial.alphaTest=.5),null==this._debugEntity&&(this._debugEntity=new Entity,v=new Transform,this._debugEntity.addComponent(v),this._debugEntity.addComponent(e._debugMaterial),this.getShape()instanceof P&&((A=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(A),v.scale=this.getShape().size),this.getShape()instanceof k&&((A=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(A),E=this.getShape().radius,v.scale=new Vector3(E,E,E))),engine.addEntity(this._debugEntity)),[2]}}))}))},e.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},e.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},e.getEntityWorldPosition=function(v){var S=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),A=v.getParent();if(null!=A){var E=A.hasComponent(Transform)?A.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(A).add(S.rotate(E))}return S},e._debugMaterial=null,e}(),it=function(v){function t(S){var A=v.call(this)||this;return A._shape=S,A._uuid="cameraTrigger",A}return i(t,v),t.prototype.getGlobalPosition=function(){return Camera.instance.position},t.prototype.getShape=function(){return this._shape},t.prototype.setShape=function(v){this._shape=v},t.prototype.isInEngine=function(){return!1},t.prototype.hasActiveCollision=function(v){return!1},t.prototype.disengageActiveCollision=function(v){},t.prototype.engageCollision=function(v){},t.prototype.isDebugging=function(){return!1},t}(nt),ot=function(){function e(v,S){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,this._debugEnabled=!1,et.createAndAddToEngine(),this.shape=v,S&&(S.layer&&(this.layer=S.layer),S.triggeredByLayer&&(this.triggeredByLayer=S.triggeredByLayer),S.onTriggerEnter&&(this.onTriggerEnter=S.onTriggerEnter),S.onTriggerExit&&(this.onTriggerExit=S.onTriggerExit),S.onCameraEnter&&(this.onCameraEnter=S.onCameraEnter),S.onCameraExit&&(this.onCameraExit=S.onCameraExit),S.enableDebug&&(this._debugEnabled=S.enableDebug))}return Object.defineProperty(e.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),r([Component("triggerComponent")],e)}(),P=function(v,S){void 0===v&&(v=Vector3.One().scale(2)),void 0===S&&(S=Vector3.Zero()),this.size=v,this.position=S},k=function(v,S){void 0===v&&(v=2),void 0===S&&(S=Vector3.Zero()),this.radius=v,this.position=S};v.ActionsSequenceSystem=function(){function e(v){this.beginSequenceNode=null,this.currentSequenceNode=null,this.running=!1,this.started=!1,v&&this.startSequence(v)}return e.prototype.startSequence=function(v){this.beginSequenceNode=v.beginSequenceNode,this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.setOnFinishCallback=function(v){this.onFinishCallback=v},e.prototype.isRunning=function(){return this.running},e.prototype.stop=function(){this.running=!1},e.prototype.resume=function(){null!=this.beginSequenceNode&&(this.running=!0)},e.prototype.reset=function(){this.currentSequenceNode=this.beginSequenceNode,this.running=!0,this.started=!1},e.prototype.getRunningAction=function(){var v=this.currentSequenceNode;if(this.currentSequenceNode instanceof st)do{v=v.currentInnerSequence}while(v instanceof st);return v.action},e.prototype.update=function(v){this.running&&(this.started?this.currentSequenceNode.hasFinish()?(this.currentSequenceNode.onFinish(),this.currentSequenceNode=this.currentSequenceNode.next,this.currentSequenceNode?this.currentSequenceNode.onStart():(this.running=!1,this.onFinishCallback&&this.onFinishCallback())):this.currentSequenceNode.update(v):(this.currentSequenceNode.onStart(),this.started=!0))},e}(),K=v.ActionsSequenceSystem||(v.ActionsSequenceSystem={}),$=function(){function e(){this.currentSequenceNode=null,this.beginSequenceNode=null,this.whileNodeStack=[]}return e.prototype.then=function(v){if(null==this.currentSequenceNode)this.currentSequenceNode=new rt,this.currentSequenceNode.action=v,this.beginSequenceNode=this.currentSequenceNode;else{var S=new rt;S.action=v,this.currentSequenceNode=this.currentSequenceNode.then(S)}return this},e.prototype.if=function(v){var S=new at(v);return null==this.currentSequenceNode?(this.currentSequenceNode=S,this.beginSequenceNode=S):this.currentSequenceNode=this.currentSequenceNode.then(S),this},e.prototype.else=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof at))throw new Error("IF statement is needed to be called before ELSE statement.");v.closed=!0;var S=new ht(v);return this.currentSequenceNode=this.currentSequenceNode.then(S),this},e.prototype.endIf=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof at||v instanceof ht))throw new Error("IF statement is needed to be called before ENDIF statement.");return v.closed=!0,this},e.prototype.while=function(v){var S=new lt(v);return null==this.currentSequenceNode?(this.currentSequenceNode=S,this.beginSequenceNode=S):this.currentSequenceNode=this.currentSequenceNode.then(S),this.whileNodeStack.push(S),this},e.prototype.endWhile=function(){var v=this.currentSequenceNode.getSequence();if(!(v instanceof lt))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");return v.closed=!0,this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1),this},e.prototype.breakWhile=function(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");return this.currentSequenceNode=this.currentSequenceNode.then(new ct(this.whileNodeStack[this.whileNodeStack.length-1])),this},e}(),K.SequenceBuilder=$;var rt=function(){function e(){this.action=null,this.next=null}return e.prototype.then=function(v){return this.next=v,v},e.prototype.onStart=function(){this.action&&this.action.onStart()},e.prototype.update=function(v){this.action&&this.action.update(v)},e.prototype.onFinish=function(){this.action&&this.action.onFinish()},e.prototype.hasFinish=function(){return!this.action||this.action.hasFinished},e.prototype.getSequence=function(){return this},e}(),st=function(v){function t(){var S=null!==v&&v.apply(this,arguments)||this;return S.currentInnerSequence=null,S.startingInnerSequence=null,S.closed=!1,S}return i(t,v),t.prototype.then=function(v){if(null==this.currentInnerSequence)this.currentInnerSequence=v,this.startingInnerSequence=v;else{if(this.closed)return this.next=v,v;this.currentInnerSequence=this.currentInnerSequence.then(v)}return this},t.prototype.onStart=function(){this.currentInnerSequence=this.startingInnerSequence,this.currentInnerSequence&&this.currentInnerSequence.onStart()},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.onFinish=function(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()},t.prototype.hasFinish=function(){return null==this.currentInnerSequence},t.prototype.getSequence=function(){if(this.currentInnerSequence){var v=this.currentInnerSequence.getSequence();if(v instanceof t&&!v.closed)return v}return this},t}(rt),at=function(v){function t(S){var A=v.call(this)||this;return A.result=!1,A.condition=S,A}return i(t,v),t.prototype.onStart=function(){this.result=this.condition(),this.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(st),ht=function(v){function t(S){var A=v.call(this)||this;return A.ifSequence=null,A.ifSequence=S,A}return i(t,v),t.prototype.onStart=function(){this.ifSequence&&!this.ifSequence.result?v.prototype.onStart.call(this):this.currentInnerSequence=null},t}(st),lt=function(v){function t(S){var A=v.call(this)||this;return A.breakWhile=!1,A.condition=S,A}return i(t,v),t.prototype.onStart=function(){this.breakWhile=!1,this.condition()?v.prototype.onStart.call(this):this.currentInnerSequence=null},t.prototype.update=function(v){this.currentInnerSequence&&(this.currentInnerSequence.hasFinish()?(this.currentInnerSequence.onFinish(),this.currentInnerSequence=this.currentInnerSequence.next,null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence),this.currentInnerSequence&&this.currentInnerSequence.onStart()):this.currentInnerSequence.update(v))},t.prototype.hasFinish=function(){return this.breakWhile||!this.condition()},t}(st),ct=function(v){function t(S){var A=v.call(this)||this;return A.whileNode=S,A}return i(t,v),t.prototype.onStart=function(){this.whileNode.breakWhile=!0},t}(rt);v.Delay=Q,v.ExpireIn=Z,v.FollowCurvedPathComponent=V,v.FollowPathComponent=M,v.Interpolate=h,v.Interval=J,v.KeepRotatingComponent=W,v.MoveTransformComponent=O,v.RotateTransformComponent=z,v.ScaleTransformComponent=B,v.SequenceNode=rt,v.ToggleComponent=H,v.TransformSystem=E,v.TriggerBoxShape=P,v.TriggerComponent=ot,v.TriggerSphereShape=k,v.TriggerSystem=et,v.addLabel=I,v.addOneTimeTrigger=function(v,S,A){var E=!1,R=!1,O=new Entity;O.addComponent(new Transform({}));var z={};return S.layer&&(z.layer=S.layer),S.triggeredByLayer&&(z.triggeredByLayer=S.triggeredByLayer),S.onCameraEnter&&(z.onCameraEnter=function(){E||(E=!0,S.onCameraEnter()),!E&&S.onCameraEnter||!R&&S.onCameraExit||engine.removeEntity(O)}),S.onCameraExit&&(z.onCameraExit=function(){R||(R=!0,S.onCameraExit()),!E&&S.onCameraEnter||!R&&S.onCameraExit||engine.removeEntity(O)}),S.enableDebug&&(z.enableDebug=S.enableDebug),O.addComponent(new ot(v,z)),A&&O.setParent(A),engine.addEntity(O),O},v.addTestCube=function(v,A,E,R,O,z,B){return o(this,void 0,void 0,(function(){var M,V,W;return a(this,(function(H){switch(H.label){case 0:return(M=!B)?[4,!S.isPreviewMode()]:[3,2];case 1:M=H.sent(),H.label=2;case 2:return M?[2]:((V=new Entity).addComponent(new Transform(v)),O?(V.addComponent(new SphereShape),V.getComponent(Transform).scale.setAll(.5)):V.addComponent(new BoxShape),engine.addEntity(V),V.addComponent(new OnPointerDown(A,{hoverText:E||"click",button:ActionButton.POINTER})),R&&((W=new Material).albedoColor=R,V.addComponent(W)),z&&(V.getComponent(BoxShape).withCollisions=!1),E&&I(E,V,!0),[2,V])}}))}))},v.clamp=function(v,S,A){var E=v;return v>A?E=A:v<S&&(E=S),E},v.getEntityWorldPosition=function e(v){var S=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),A=v.getParent();if(null!=A&&"0"!=A.uuid){if("FirstPersonCameraEntityReference"==A.uuid){var E=Camera.instance.rotation.clone();return Camera.instance.position.clone().add(S.rotate(E))}if("AvatarEntityReference"==A.uuid){var R=Camera.instance.rotation;return E=Quaternion.Euler(0,R.eulerAngles.y,0),Camera.instance.position.clone().add(S.rotate(E)).add(new Vector3(0,-.875,0))}return E=A.hasComponent(Transform)?A.getComponent(Transform).rotation:Quaternion.Identity,e(A).add(S.rotate(E))}return S},v.getEntityWorldRotation=function e(v){var S=v.hasComponent(Transform)?v.getComponent(Transform).rotation.clone():Quaternion.Zero(),A=v.getParent();if(null!=A&&"0"!=A.uuid){if("FirstPersonCameraEntityReference"==A.uuid){var E=Camera.instance.rotation.clone();return S.multiply(E)}return"AvatarEntityReference"==A.uuid?(E=Quaternion.Euler(0,Camera.instance.rotation.eulerAngles.y,0),S.multiply(E)):(E=e(A),S.multiply(E))}return S},v.map=function(v,S,A,E,R){return(v-S)/(A-S)*(R-E)+E},v.sendRequest=function(v,S,A,E){return o(this,void 0,void 0,(function(){var R,O,z;return a(this,(function(B){switch(B.label){case 0:return B.trys.push([0,6,,7]),R={method:S||"GET"},A&&(R.headers=A),E&&(R.body=JSON.stringify(E)),[4,fetch(v,R)];case 1:O=B.sent(),B.label=2;case 2:return B.trys.push([2,4,,5]),[4,O.json()];case 3:return[2,B.sent()];case 4:return B.sent(),[2,O];case 5:return[3,7];case 6:return z=B.sent(),log("error fetching from ",v," : ",z),[3,7];case 7:return[2]}}))}))},v.setTimeout=function(v,S){var A=new Entity;return A.addComponent(new Q(v,(function(){S(),engine.removeEntity(A)}))),engine.addEntity(A),A},Object.defineProperty(v,"__esModule",{value:!0})})),function(v,S){"object"==typeof exports&&"undefined"!=typeof module?S(exports):"function"==typeof define&&define.amd?define("@dcl/npc-scene-utils",["exports"],S):S((v="undefined"!=typeof globalThis?globalThis:v||self)["@dcl/npc-scene-utils"]={})}(this,(function(v){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var e=function(v,S){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,S){v.__proto__=S}||function(v,S){for(var A in S)Object.prototype.hasOwnProperty.call(S,A)&&(v[A]=S[A])})(v,S)};function i(v,S){function o(){this.constructor=v}e(v,S),v.prototype=null===S?Object.create(S):(o.prototype=S.prototype,new o)}function o(v,S,A,E){var R,O=arguments.length,z=O<3?S:null===E?E=Object.getOwnPropertyDescriptor(S,A):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,S,A,E);else for(var B=v.length-1;B>=0;B--)(R=v[B])&&(z=(O<3?R(z):O>3?R(S,A,z):R(S,A))||z);return O>3&&z&&Object.defineProperty(S,A,z),z}function n(v){var S="function"==typeof Symbol&&Symbol.iterator,A=S&&v[S],E=0;if(A)return A.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}var S=o([Component("trackUserFlag")],(function(v,S,E){this.lockXZRotation=!1,this.active=!1,A||(A=!0,engine.addSystem(new R)),this.lockXZRotation=v||!1,this.rotSpeed=S||2,E&&(this.active=!0)})),A=!1,E=Camera.instance,R=function(){function t(){this.followingNPCs=engine.getComponentGroup(S)}return t.prototype.update=function(v){var A,R;try{for(var O=n(this.followingNPCs.entities),z=O.next();!z.done;z=O.next()){var B=z.value,M=B.getComponent(Transform),V=B.getComponent(S);if(V.active){var W=new Vector3(E.position.x,E.position.y,E.position.z).subtract(M.position);M.rotation=Quaternion.Slerp(M.rotation,Quaternion.LookRotation(W),v*V.rotSpeed),V.lockXZRotation&&(M.rotation.x=0,M.rotation.z=0)}}}catch(v){A={error:v}}finally{try{z&&!z.done&&(R=O.return)&&R.call(O)}finally{if(A)throw A.error}}},t}(),O=new UICanvas;O.visible=!0;var z,B,M=new Font(Fonts.SanFrancisco),V=new Font(Fonts.SanFrancisco_Heavy),W=new Texture("https://decentraland.org/images/ui/light-atlas-v3.png"),H=new Texture("https://decentraland.org/images/ui/dark-atlas-v3.png"),X=new Texture("https://decentraland.org/images/ui/dialog-bubbles.png");function b(v,S,A,E){void 0===A&&(A=512),void 0===E&&(E=512),function(v,S,A,E,R){v.uvs=[S.x,S.y,A.x,A.y,E.x,E.y,R.x,R.y,S.x,S.y,A.x,A.y,E.x,E.y,R.x,R.y]}(v,new Vector2(S.sourceLeft/A,(E-S.sourceTop-S.sourceHeight)/E),new Vector2((S.sourceLeft+S.sourceWidth)/A,(E-S.sourceTop-S.sourceHeight)/E),new Vector2((S.sourceLeft+S.sourceWidth)/A,(E-S.sourceTop)/E),new Vector2(S.sourceLeft/A,(E-S.sourceTop)/E))}function T(v,S){v.sourceWidth=S.sourceWidth,v.sourceHeight=S.sourceHeight,v.sourceLeft=S.sourceLeft?S.sourceLeft:0,v.sourceTop=S.sourceTop?S.sourceTop:0}function C(v){var S=-10-4*v;return S>-65?S:-65}(z=v.ButtonStyles||(v.ButtonStyles={})).E="e",z.F="f",z.DARK="dark",z.RED="red",z.ROUNDBLACK="roundblack",z.ROUNDWHITE="roundwhite",z.ROUNDSILVER="roundsilver",z.ROUNDGOLD="roundgold",z.SQUAREBLACK="squareblack",z.SQUAREWHITE="squarewhite",z.SQUARESILVER="squaresilver",z.SQUAREGOLD="squaregold",z.WHITE="white",(B=v.NPCState||(v.NPCState={})).STANDING="standing",B.TALKING="talking",B.FOLLOWPATH="followPath";var Q,Z={buttons:{buttonE:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonF:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},white:{sourceWidth:174,sourceHeight:46,sourceLeft:698,sourceTop:662},buttonRed:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:662},buttonDark:{sourceWidth:174,sourceHeight:46,sourceLeft:512,sourceTop:612},roundBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:458},squareBlack:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:457},roundWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:494},squareWhite:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:493},roundSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:531},squareSilver:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:531},roundGold:{sourceWidth:128,sourceHeight:32,sourceLeft:512,sourceTop:567},squareGold:{sourceWidth:128,sourceHeight:32,sourceLeft:646,sourceTop:567}},buttonLabels:{E:{sourceWidth:26,sourceHeight:26,sourceLeft:697,sourceTop:611},F:{sourceWidth:26,sourceHeight:26,sourceLeft:733,sourceTop:611},EBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:766,sourceTop:611},FBlack:{sourceWidth:26,sourceHeight:26,sourceLeft:802,sourceTop:611}},backgrounds:{promptBackground:{sourceWidth:416,sourceHeight:352,sourceLeft:501,sourceTop:12},promptLargeBackground:{sourceWidth:480,sourceHeight:384,sourceLeft:7,sourceTop:12},promptSlantedBackground:{sourceWidth:486,sourceHeight:326,sourceLeft:7,sourceTop:413},NPCDialog:{sourceWidth:766,sourceHeight:248,sourceLeft:22,sourceTop:756}},icons:{closeW:{sourceWidth:32,sourceHeight:32,sourceLeft:942,sourceTop:306},closeD:{sourceWidth:32,sourceHeight:32,sourceLeft:986,sourceTop:306},closeWLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:512,sourceTop:381},closeDLarge:{sourceWidth:64,sourceHeight:64,sourceLeft:583,sourceTop:381},closeWNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:252},closeDNoBack:{sourceWidth:24,sourceHeight:24,sourceLeft:946,sourceTop:214},closeWNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:214},closeDNoBackLarge:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:260},FDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:4},FWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:4},EDark:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:40},EWhite:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:40},Timer:{sourceWidth:24,sourceHeight:32.2,sourceLeft:718,sourceTop:388},TimerLarge:{sourceWidth:48,sourceHeight:68,sourceLeft:662,sourceTop:386},ClickWhite:{sourceWidth:32,sourceHeight:48,sourceLeft:799,sourceTop:389},ClickDark:{sourceWidth:32,sourceHeight:48,sourceLeft:757,sourceTop:389}},checkboxes:{wOff:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:76},wOn:{sourceWidth:24,sourceHeight:24,sourceLeft:987,sourceTop:104},dOff:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:76},dOn:{sourceWidth:24,sourceHeight:24,sourceLeft:958,sourceTop:104},wLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:132},wLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:987,sourceTop:168},dLargeOff:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:132},dLargeOn:{sourceWidth:32,sourceHeight:32,sourceLeft:950,sourceTop:168}},switches:{roundOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:454},roundRed:{sourceWidth:64,sourceHeight:32,sourceLeft:853,sourceTop:454},roundGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:923,sourceTop:454},squareOff:{sourceWidth:64,sourceHeight:32,sourceLeft:783,sourceTop:501},squareRed:{sourceWidth:64,sourceHeight:32,sourceLeft:852,sourceTop:501},squareGreen:{sourceWidth:64,sourceHeight:32,sourceLeft:921,sourceTop:501}},bubbles:{short:{sourceWidth:232,sourceHeight:168,sourceLeft:610,sourceTop:834},normal:{sourceWidth:572,sourceHeight:168,sourceLeft:16,sourceTop:834},long:{sourceWidth:994,sourceHeight:306,sourceLeft:12,sourceTop:508},huge:{sourceWidth:994,sourceHeight:478,sourceLeft:12,sourceTop:14}}},J=function(){function t(S,A){var E=this;$.createAndAddToEngine(),this.elapsedTime=0,this.targetTime=S,this.onTimeReachedCallback=A,this.onTargetTimeReached=function(S){E.onTimeReachedCallback(),S.removeComponent(v)}}var v;return v=t,t.prototype.setCallback=function(v){this.onTimeReachedCallback=v},v=o([Component("npcTimerDelay")],t)}(),K=engine.getComponentGroup(J),$=function(){function t(){t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){var S,A;try{for(var E=n(K.entities),R=E.next();!R.done;R=E.next()){var O=R.value,z=O.getComponent(J);z.elapsedTime+=v,z.elapsedTime>=z.targetTime&&z.onTargetTimeReached(O)}}catch(v){S={error:v}}finally{try{R&&!R.done&&(A=E.return)&&A.call(E)}finally{if(S)throw S.error}}},t._instance=null,t}();!function(v){v[v.Confirm=0]="Confirm",v[v.Cancel=1]="Cancel",v[v.Next=2]="Next",v[v.Button3=3]="Button3",v[v.Button4=4]="Button4"}(Q||(Q={}));var et=.75,nt=-262.5,it=262.5,ot=37.5,rt=192,st=192,at=7.5,ht=112.5,lt=112.5,ct=-48.75,ut=-48.75,dt=19.5,pt=19.5,ft=function(){function e(S,A,E,R){var z=this;this.NPCScript=[],this.isDialogOpen=!1,this.isQuestionPanel=!1,this.isFixedScreen=!1,this.activeTextId=0,this.UIOpenTime=0,this.defaultSound=null,this.canvas=O,this.ClickAction=null,this.EButtonAction=null,this.FButtonAction=null,this.defaultPortrait=S||null,this.uiTheme=R||(A?H:W),this.container=new UIContainerRect(O),this.container.adaptWidth=!0,this.container.width="100%",this.container.vAlign="bottom",this.container.positionY=105,this.container.visible=!1,this.panel=new UIImage(this.container,this.uiTheme),T(this.panel,Z.backgrounds.NPCDialog),this.panel.width=574.5,this.panel.height=186,this.panel.onClick=new OnClick((function(){z.confirmText(Q.Next)})),this.defaultPortraitTexture=new Texture(S?S.path:this.uiTheme.src),this.portrait=new UIImage(this.container,this.defaultPortraitTexture),this.portrait.sourceWidth=S&&S.section?S.section.sourceWidth:256,this.portrait.sourceHeight=S&&S.section?S.section.sourceHeight:256,this.portrait.width=S&&S.width?S.width*et:rt,this.portrait.height=S&&S.height?S.height*et:rt,this.portrait.positionX=S&&S.offsetX?S.offsetX*et+nt:nt,this.portrait.positionY=S&&S.offsetY?S.offsetY*et+0:0,this.portrait.onClick=new OnClick((function(){z.confirmText(Q.Next)})),this.image=new UIImage(this.container,new Texture(this.uiTheme.src)),this.image.sourceWidth=256,this.image.sourceHeight=256,this.image.sourceTop=0,this.image.sourceLeft=0,this.image.width=st,this.image.height=st,this.image.positionX=it,this.image.positionY=ot,this.image.onClick=new OnClick((function(){z.confirmText(Q.Next)})),this.text=new UIText(this.container),this.text.adaptWidth=!1,this.text.textWrapping=!0,this.text.width=345,this.text.positionX=30,this.text.hAlign="center",this.text.vAlign="center",this.text.font=V,this.text.fontSize=18,this.text.hTextAlign="left",this.text.vTextAlign="center",this.text.positionY=at,this.text.fontWeight="normal",this.text.color=A?Color4.White():Color4.Black(),this.text.isPointerBlocker=!1,this.soundEnt=new Entity,this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(Attachable.AVATAR),E&&(this.soundEnt.addComponent(new AudioSource(new AudioClip(E))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=E),this.button1=new yt(this.container,this.uiTheme,"yes",ht,ct,(function(){z.confirmText(Q.Confirm)}),!1,v.ButtonStyles.E),this.button1.hide(),this.button2=new yt(this.container,this.uiTheme,"no",-60,ut,(function(){z.confirmText(Q.Cancel)}),!1,v.ButtonStyles.F),this.button2.hide(),this.button3=new yt(this.container,this.uiTheme,"maybe",-60,-60,(function(){z.confirmText(Q.Button3)}),!1,v.ButtonStyles.DARK),this.button3.hide(),this.button4=new yt(this.container,this.uiTheme,"maybe",lt,-60,(function(){z.confirmText(Q.Button4)}),!1,v.ButtonStyles.DARK),this.button4.hide(),this.skipButton=new yt(this.container,this.uiTheme,"Skip",-225,-75,(function(){z.skipDialogs()}),!1,H?v.ButtonStyles.WHITE:v.ButtonStyles.F),this.skipButton.image.width=60,this.skipButton.image.height=22.5,this.skipButton.label.hTextAlign="left",this.skipButton.label.fontSize=9,this.skipButton.label.positionX=30,this.skipButton.label.font=V,this.skipButton.icon.height=15,this.skipButton.icon.width=15,this.skipButton.icon.positionX=-15,this.skipButton.hide(),this.leftClickIcon=new UIImage(this.container,this.uiTheme),this.leftClickIcon.width=24,this.leftClickIcon.height=36,this.leftClickIcon.positionX=255,this.leftClickIcon.positionY=-60,this.leftClickIcon.visible=!1,T(this.leftClickIcon,A?Z.icons.ClickDark:Z.icons.ClickWhite),gt.createAndAddToEngine()}return e.prototype.openDialogWindow=function(v,S){var A=this;this.UIOpenTime=+Date.now(),this.NPCScript=v,this.activeTextId=S?"number"==typeof S?S:F(v,S):0;var E=v[this.activeTextId]?v[this.activeTextId]:{text:""};if(E.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(E.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),E.portrait?(this.portrait.source=new Texture(E.portrait.path),this.portrait.positionX=E.portrait.offsetX?E.portrait.offsetX*et+nt:nt,this.portrait.positionY=E.portrait.offsetY?E.portrait.offsetY*et+0:0,this.portrait.width=E.portrait.width?E.portrait.width*et:rt,this.portrait.height=E.portrait.height?E.portrait.height*et:rt,E.portrait.section&&T(this.portrait,E.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=this.defaultPortraitTexture,this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*et+nt:nt,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*et+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*et:rt,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*et:rt,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),E.image){var R=E.image;log("setting image to ",R.path),this.image.source=new Texture(R.path),this.image.positionX=R.offsetX?R.offsetX*et+it:it,this.image.positionY=R.offsetY?R.offsetY*et+ot:ot,this.image.width=R.width?R.width*et:st,this.portrait.height=R.height?R.height*et:st,R.section&&T(this.image,R.section),this.image.visible=!0}else this.image.visible=!1;this.text.fontSize=E.fontSize?E.fontSize*et:18,this.text.positionY=E.offsetY?E.offsetY*et+at:at,this.text.positionX=E.offsetX?E.offsetX*et:0,this.text.visible=!0,this.container.visible=!0,gt._instance.newText(this,E.text,this.activeTextId,E.typeSpeed?E.typeSpeed:void 0),this.ClickAction||(this.ClickAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,!1,(function(v){!A.isDialogOpen||+Date.now()-A.UIOpenTime<100||(gt._instance.done?A.isQuestionPanel||A.isFixedScreen||A.confirmText(Q.Next):gt._instance.rush())})),this.EButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){A.isDialogOpen&&A.isQuestionPanel&&gt._instance.done&&+Date.now()-A.UIOpenTime>100&&A.confirmText(Q.Confirm)})),this.FButtonAction=Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){A.isDialogOpen&&A.isQuestionPanel&&gt._instance.done&&+Date.now()-A.UIOpenTime>100?A.confirmText(Q.Cancel):A.isDialogOpen&&E.skipable&&+Date.now()-A.UIOpenTime>100&&A.skipDialogs()}))),this.layoutDialogWindow(this.activeTextId),this.isDialogOpen=!0},e.prototype.confirmText=function(v){var S=this.NPCScript[this.activeTextId];if(v==Q.Next&&!S.isQuestion){if(S.triggeredByNext&&S.triggeredByNext(),S.isEndOfDialog)return void this.closeDialogWindow();this.activeTextId++}v==Q.Confirm&&S.buttons&&S.buttons.length>=1&&("number"==typeof S.buttons[0].goToDialog?this.activeTextId=S.buttons[0].goToDialog:this.activeTextId=F(this.NPCScript,S.buttons[0].goToDialog),S.buttons[0].triggeredActions&&S.buttons[0].triggeredActions()),v==Q.Cancel&&S.buttons&&S.buttons.length>=2&&("number"==typeof S.buttons[1].goToDialog?this.activeTextId=S.buttons[1].goToDialog:this.activeTextId=F(this.NPCScript,S.buttons[1].goToDialog),S.buttons[1].triggeredActions&&S.buttons[1].triggeredActions()),v==Q.Button3&&S.buttons&&S.buttons.length>=3&&("number"==typeof S.buttons[2].goToDialog?this.activeTextId=S.buttons[2].goToDialog:this.activeTextId=F(this.NPCScript,S.buttons[2].goToDialog),S.buttons[2].triggeredActions&&S.buttons[2].triggeredActions()),v==Q.Button4&&S.buttons&&S.buttons.length>=4&&("number"==typeof S.buttons[3].goToDialog?this.activeTextId=S.buttons[3].goToDialog:this.activeTextId=F(this.NPCScript,S.buttons[3].goToDialog),S.buttons[3].triggeredActions&&S.buttons[3].triggeredActions()),S=this.NPCScript[this.activeTextId],gt._instance.newText(this,S.text,this.activeTextId,S.typeSpeed?S.typeSpeed:void 0)},e.prototype.layoutDialogWindow=function(v){var S=this,A=this.NPCScript[v]?this.NPCScript[v]:{text:""},E=A.offsetY?A.offsetY*et+at:at;if(A.buttons&&A.buttons.length>=3?E+=37.5:A.buttons&&A.buttons.length>=1&&(E+=18),this.text.fontSize=A.fontSize?A.fontSize*et:18,this.text.positionY=E,A.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(A.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),A.portrait?(this.portrait.source=new Texture(A.portrait.path),this.portrait.positionX=A.portrait.offsetX?A.portrait.offsetX*et+nt:nt,this.portrait.positionY=A.portrait.offsetY?A.portrait.offsetY*et+0:0,this.portrait.width=A.portrait.width?A.portrait.width*et:rt,this.portrait.height=A.portrait.height?A.portrait.height*et:rt,A.portrait.section&&T(this.portrait,A.portrait.section),this.portrait.visible=!0):this.defaultPortrait?(this.portrait.source=new Texture(this.defaultPortrait.path),this.portrait.positionX=this.defaultPortrait&&this.defaultPortrait.offsetX?this.defaultPortrait.offsetX*et+nt:nt,this.portrait.positionY=this.defaultPortrait&&this.defaultPortrait.offsetY?this.defaultPortrait.offsetY*et+0:0,this.portrait.width=this.defaultPortrait&&this.defaultPortrait.width?this.defaultPortrait.width*et:rt,this.portrait.height=this.defaultPortrait&&this.defaultPortrait.height?this.defaultPortrait.height*et:rt,this.defaultPortrait.section&&T(this.portrait,this.defaultPortrait.section),this.portrait.visible=!0):(log("No portrait"),this.portrait.visible=!1),this.image.visible=!1,A.image){var R=A.image;log("setting image to ",R.path),this.image.source=new Texture(R.path),this.image.positionX=R.offsetX?R.offsetX*et+it:it,this.image.positionY=R.offsetY?R.offsetY*et+ot:ot,this.image.width=A.image.width?A.image.width*et:st,this.image.height=A.image.height?A.image.height*et:st,R.section&&T(this.image,R.section),this.image.visible=!0}else this.image.visible=!1;this.isQuestionPanel=!!A.isQuestion&&A.isQuestion,this.isFixedScreen=!!A.isFixedScreen&&A.isFixedScreen,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.leftClickIcon.visible=!1,A.isQuestion?(this.skipButton.hide(),A.buttons&&A.buttons.length>=1&&this.button1.update(A.buttons[0].label,A.buttons[0].offsetX?A.buttons[0].offsetX*et+ht:ht,A.buttons.length>=3?A.buttons[0].offsetY?A.buttons[0].offsetY*et-15:-15:A.buttons[0].offsetY?A.buttons[0].offsetY*et+ct:ct),A.buttons&&A.buttons.length>=2&&this.button2.update(A.buttons[1].label,A.buttons[1].offsetX*et?A.buttons[1].offsetX*et-60:-60,A.buttons.length>=3?A.buttons[1].offsetY*et?A.buttons[1].offsetY*et-15:-15:A.buttons[1].offsetY*et?A.buttons[1].offsetY*et+ut:ut),A.buttons&&A.buttons.length>=3&&this.button3.update(A.buttons[2].label,A.buttons[2].offsetX*et?A.buttons[2].offsetX*et-60:-60,A.buttons[2].offsetY*et?A.buttons[2].offsetY*et-60:-60),A.buttons&&A.buttons.length>=4&&this.button4.update(A.buttons[3].label,A.buttons[3].offsetX*et?A.buttons[3].offsetX*et+lt:lt,A.buttons[3].offsetY*et?A.buttons[3].offsetY*et-60:-60),vt.addComponentOrReplace(new J(.7,(function(){A.buttons&&A.buttons.length>=1&&S.button1.show(),A.buttons&&A.buttons.length>=2&&S.button2.show(),A.buttons&&A.buttons.length>=3&&S.button3.show(),A.buttons&&A.buttons.length>=4&&S.button4.show()})))):this.isFixedScreen||(this.leftClickIcon.visible=!0,A.skipable?this.skipButton.show():this.skipButton.hide())},e.prototype.closeDialogWindow=function(){this.isDialogOpen&&(this.isDialogOpen=!1,this.portrait.visible=!1,this.text.value="",this.text.visible=!1,this.button1.hide(),this.button2.hide(),this.button3.hide(),this.button4.hide(),this.skipButton.hide(),this.leftClickIcon.visible=!1,this.container.visible=!1)},e.prototype.skipDialogs=function(){if(this.isDialogOpen&&!(+Date.now()-this.UIOpenTime<100)){for(;this.NPCScript[this.activeTextId]&&this.NPCScript[this.activeTextId].skipable&&!this.NPCScript[this.activeTextId].isQuestion;){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].skipable&&this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}this.confirmText(Q.Next)}},e}(),gt=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.UIText=null,this.done=!0,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done&&(this.timer+=v,this.timer>=2/this.speed)){var S=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=S,this.closeTag(S),this.visibleChars>=this.fullText.length&&(this.done=!0,this.visibleChars=this.fullText.length),this.UIText&&(this.UIText.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,S,A,E){this.timer=0,this.done=!1,this.UIText=v.text,this.fullText=S,this.visibleChars=0,E&&E<=0?this.rush():this.speed=E||45,v.layoutDialogWindow(A)},t.prototype.rush=function(){this.done=!0,this.timer=0,this.visibleChars=this.fullText.length,this.UIText&&(this.UIText.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var S=!1,A=!1,E=this.visibleChars-v;E<this.visibleChars;E++)S?">"==this.fullText.substr(E,1)&&(A=!0):"<"==this.fullText.substr(E,1)&&(S=!0);if(S&&!A)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),yt=function(S){function o(A,E,R,O,z,B,V,X){var Q=S.call(this)||this;if(Q.icon=null,Q.image=new UIImage(A,E),Q.image.positionX=O,Q.image.positionY=z,Q.image.width=130.5,Q.image.height=34.5,Q.label=new UIText(Q.image),Q.style=X||null,Q.onClick=B,Q.style)switch(Q.style){case v.ButtonStyles.E:T(Q.image,Z.buttons.buttonE),Q.label.positionX=18.75,Q.icon=new UIImage(Q.image,1==V?H:W),Q.icon.width=dt,Q.icon.height=pt,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,T(Q.icon,Z.buttonLabels.E),Q.icon.positionX=C(R.length);break;case v.ButtonStyles.F:T(Q.image,Z.buttons.buttonF),Q.label.positionX=18.75,Q.icon=new UIImage(Q.image,1==V?H:W),Q.icon.width=dt,Q.icon.height=pt,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,T(Q.icon,Z.buttonLabels.F),Q.icon.positionX=C(R.length);break;case v.ButtonStyles.WHITE:T(Q.image,Z.buttons.white),Q.label.positionX=18.75,Q.icon=new UIImage(Q.image,1==V?H:W),Q.icon.width=dt,Q.icon.height=pt,Q.icon.hAlign="center",Q.icon.vAlign="center",Q.icon.isPointerBlocker=!1,T(Q.icon,Z.buttonLabels.FBlack),Q.icon.positionX=C(R.length);break;case v.ButtonStyles.RED:T(Q.image,Z.buttons.buttonRed);break;case v.ButtonStyles.DARK:T(Q.image,Z.buttons.buttonDark);break;case v.ButtonStyles.ROUNDBLACK:T(Q.image,Z.buttons.roundBlack);break;case v.ButtonStyles.ROUNDWHITE:T(Q.image,Z.buttons.roundWhite);break;case v.ButtonStyles.ROUNDSILVER:T(Q.image,Z.buttons.roundSilver);break;case v.ButtonStyles.ROUNDGOLD:T(Q.image,Z.buttons.roundGold);break;case v.ButtonStyles.SQUAREBLACK:T(Q.image,Z.buttons.squareBlack);break;case v.ButtonStyles.SQUAREWHITE:T(Q.image,Z.buttons.squareWhite);break;case v.ButtonStyles.SQUARESILVER:T(Q.image,Z.buttons.squareSilver);break;case v.ButtonStyles.SQUAREGOLD:T(Q.image,Z.buttons.squareGold)}else T(Q.image,Z.buttons.roundSilver);return Q.label.value=R,Q.label.hTextAlign="center",Q.label.vTextAlign="center",Q.label.fontSize=15,Q.label.font=M,Q.label.color=X==v.ButtonStyles.ROUNDWHITE||X==v.ButtonStyles.SQUAREWHITE||X==v.ButtonStyles.WHITE?Color4.Black():Color4.White(),Q.label.isPointerBlocker=!1,Q.image.onClick=new OnClick((function(){Q.onClick()})),X==v.ButtonStyles.E?Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,!1,(function(v){Q.image.visible&&Q.onClick()})):X==v.ButtonStyles.F&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,!1,(function(v){Q.image.visible&&Q.onClick()})),Q}return i(o,S),o.prototype.hide=function(){this.image.visible=!1},o.prototype.show=function(){this.image.visible=!0},o.prototype.grayOut=function(){this.label.color=Color4.Gray(),this.image.isPointerBlocker=!1},o.prototype.enable=function(){this.label.color=Color4.White(),this.image.isPointerBlocker=!0},o.prototype.update=function(S,A,E){this.label.value=S,this.image.positionX=A,this.image.positionY=E,!this.icon||this.style!=v.ButtonStyles.E&&this.style!=v.ButtonStyles.F||(this.icon.positionX=C(S.length))},o}(Entity),vt=new Entity;function F(v,S){for(var A=0;A<v.length;A++)if(v[A].name&&v[A].name==S)return A;return 0}engine.addEntity(vt);var bt=function(){function t(){this._triggers={},t._instance=this,this._cameraTriggerWrapper=new wt(new j(new Vector3(.5,1.8,.5),new Vector3(0,.91,0))),this._componentGroup=engine.getComponentGroup(Ct)}return Object.defineProperty(t,"instance",{get:function(){return this.createAndAddToEngine()},enumerable:!1,configurable:!0}),t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.setCameraTriggerShape=function(v){this._cameraTriggerWrapper.setShape(v)},t.prototype.update=function(){var v=this,S=this._componentGroup.entities;for(var A in S.forEach((function(S){v.shouldWrapTriggerEntity(S)&&v.wrapTriggerEntity(S)})),this._triggers)if(this._triggers.hasOwnProperty(A)){var E=this._triggers[A];E.isDebugging()&&E.updateDebugEntity(),E.isInEngine()?null!=E.trigger&&E.trigger.enabled?(E.wasEnabled||E.isDebugging()&&E.addDebugEntity(),E.wasEnabled=!0,(E.trigger.onCameraEnter||E.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(E),(E.trigger.onTriggerEnter||E.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(E)):E.wasEnabled&&(E.wasEnabled=!1,E.isDebugging()&&E.removeDebugEntity(),t.removeTriggerFromSystem(E)):(E.isDebugging()&&E.removeDebugEntity(),t.removeTriggerFromSystem(E),delete this._triggers[A])}},t.prototype.shouldWrapTriggerEntity=function(v){return null==this._triggers[v.uuid]||null==this._triggers[v.uuid]},t.prototype.wrapTriggerEntity=function(v){this._triggers[v.uuid]=new Tt(v)},t.removeTriggerFromSystem=function(v){for(var S,A=v.getActiveCollisions(),E=0;E<A.length;E++)!(A[E]===(null===(S=t._instance)||void 0===S?void 0:S._cameraTriggerWrapper)||null==A[E].trigger)&&A[E].trigger.onTriggerExit&&v.entity&&A[E].trigger.onTriggerExit(v.entity),A[E].disengageActiveCollision(v),v.disengageActiveCollision(A[E])},t.disengageCollision=function(v,S){v.disengageActiveCollision(S),S.disengageActiveCollision(v),v.trigger.onTriggerExit&&S.entity&&v.trigger.onTriggerExit(S.entity),S.trigger.onTriggerExit&&v.entity&&S.trigger.onTriggerExit(v.entity)},t.engageCollision=function(v,S){v.engageCollision(S),S.engageCollision(v),v.trigger.onTriggerEnter&&S.entity&&v.trigger.onTriggerEnter(S.entity),S.trigger.onTriggerEnter&&v.entity&&S.trigger.onTriggerEnter(v.entity)},t.prototype.checkCollisionAgainstCamera=function(v){var S=v.hasActiveCollision(this._cameraTriggerWrapper),A=t.areColliding(v,this._cameraTriggerWrapper);S&&!A?(v.disengageActiveCollision(this._cameraTriggerWrapper),v.trigger.onCameraExit&&v.trigger.onCameraExit()):!S&&A&&(v.engageCollision(this._cameraTriggerWrapper),v.trigger.onCameraEnter&&v.trigger.onCameraEnter())},t.prototype.checkCollisionAgainstOtherTriggers=function(v){for(var S in this._triggers)if(this._triggers.hasOwnProperty(S)&&S!=v.uuid&&this._triggers[S].trigger.enabled&&t.canTriggersCollide(v,this._triggers[S])){var A=v.hasActiveCollision(this._triggers[S]),E=t.areColliding(v,this._triggers[S]);A&&!E?t.disengageCollision(v,this._triggers[S]):!A&&E&&t.engageCollision(v,this._triggers[S])}},t.canTriggersCollide=function(v,S){return 0==v.trigger.triggeredByLayer||0!=(S.trigger.layer&v.trigger.triggeredByLayer)},t.areColliding=function(v,S){return v.getShape()instanceof j&&S.getShape()instanceof j?t.areCollidingAABB(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof q&&S.getShape()instanceof q?t.areCollidingSphere(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof j&&S.getShape()instanceof q?t.areCollidingAABBSphere(v.getGlobalPosition(),v.getShape(),S.getGlobalPosition(),S.getShape()):v.getShape()instanceof q&&S.getShape()instanceof j&&t.areCollidingAABBSphere(S.getGlobalPosition(),S.getShape(),v.getGlobalPosition(),v.getShape())},t.areCollidingAABB=function(v,S,A,E){var R=t.getBoxShapeValues(v,S),O=t.getBoxShapeValues(A,E);return R.min.x<=O.max.x&&R.max.x>=O.min.x&&R.min.y<=O.max.y&&R.max.y>=O.min.y&&R.min.z<=O.max.z&&R.max.z>=O.min.z},t.areCollidingSphere=function(v,S,A,E){return Vector3.DistanceSquared(v.add(S.position),A.add(E.position))<S.radius*S.radius+E.radius*E.radius},t.areCollidingAABBSphere=function(v,S,A,E){var R=t.getBoxShapeValues(v,S),O=A.add(E.position),z=E.radius,B=0;return O.x<R.min.x&&(B+=(R.min.x-O.x)*(R.min.x-O.x)),O.x>R.max.x&&(B+=(O.x-R.max.x)*(O.x-R.max.x)),O.y<R.min.y&&(B+=(R.min.y-O.y)*(R.min.y-O.y)),O.y>R.max.y&&(B+=(O.y-R.max.y)*(O.y-R.max.y)),O.z<R.min.z&&(B+=(R.min.z-O.z)*(R.min.z-O.z)),O.z>R.max.z&&(B+=(O.z-R.max.z)*(O.z-R.max.z)),B<z*z},t.getBoxShapeValues=function(v,S){var A=v.add(S.position);return{center:A,min:A.subtract(S.size.scale(.5)),max:A.add(S.size.scale(.5))}},t._instance=null,t}(),Tt=function(){function t(v){this.wasEnabled=!0,this._uuid="",this._collidingWith={},this._isDebug=!1,this._debugEntity=null,this._entity=v,v&&(this._trigger=v.getComponent(Ct),this._uuid=v.uuid,this._isDebug=this._trigger.debugEnabled,this._isDebug&&this.addDebugEntity())}return Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"trigger",{get:function(){return this._trigger},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uuid",{get:function(){return this._uuid},enumerable:!1,configurable:!0}),t.prototype.getGlobalPosition=function(){return this._entity?t.getEntityWorldPosition(this._entity):Vector3.Zero()},t.prototype.getShape=function(){return this._trigger.shape},t.prototype.isInEngine=function(){return null!=this._entity&&this._entity.isAddedToEngine()},t.prototype.getActiveCollisions=function(){var v=[];for(var S in this._collidingWith)this._collidingWith.hasOwnProperty(S)&&v.push(this._collidingWith[S]);return v},t.prototype.hasActiveCollision=function(v){return null!=this._collidingWith[v.uuid]&&null!=this._collidingWith[v.uuid]},t.prototype.disengageActiveCollision=function(v){delete this._collidingWith[v.uuid]},t.prototype.engageCollision=function(v){this._collidingWith[v.uuid]=v},t.prototype.isDebugging=function(){return this._isDebug},t.prototype.addDebugEntity=function(){if(t._debugMaterial||(t._debugMaterial=new Material,t._debugMaterial.alphaTest=.5),null==this._debugEntity){this._debugEntity=new Entity;var v=new Transform;if(this._debugEntity.addComponent(v),this._debugEntity.addComponent(t._debugMaterial),this.getShape()instanceof j&&((S=new BoxShape).withCollisions=!1,this._debugEntity.addComponent(S),v.scale=this.getShape().size),this.getShape()instanceof q){var S;(S=new SphereShape).withCollisions=!1,this._debugEntity.addComponent(S);var A=this.getShape().radius;v.scale=new Vector3(A,A,A)}}engine.addEntity(this._debugEntity)},t.prototype.removeDebugEntity=function(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)},t.prototype.updateDebugEntity=function(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))},t.getEntityWorldPosition=function(v){var S=v.hasComponent(Transform)?v.getComponent(Transform).position.clone():Vector3.Zero(),A=v.getParent();if(null!=A){var E=A.hasComponent(Transform)?A.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(A).add(S.rotate(E))}return S},t._debugMaterial=null,t}(),wt=function(v){function e(S){var A=v.call(this)||this;return A._shape=S,A._uuid="cameraTrigger",A}return i(e,v),e.prototype.getGlobalPosition=function(){return Camera.instance.position},e.prototype.getShape=function(){return this._shape},e.prototype.setShape=function(v){this._shape=v},e.prototype.isInEngine=function(){return!1},e.prototype.hasActiveCollision=function(v){return!1},e.prototype.disengageActiveCollision=function(v){},e.prototype.engageCollision=function(v){},e.prototype.isDebugging=function(){return!1},e}(Tt),Ct=function(){function t(v,S){this.enabled=!0,this.layer=0,this.triggeredByLayer=0,bt.createAndAddToEngine(),this.shape=v,this.layer=S&&S.layer?S.layer:0,this.triggeredByLayer=S&&S.triggeredByLayer?S.triggeredByLayer:0,this.onTriggerEnter=S&&S.onTriggerEnter?S.onTriggerEnter:void 0,this.onTriggerExit=S&&S.onTriggerExit?S.onTriggerExit:void 0,this.onCameraEnter=S&&S.onCameraEnter?S.onCameraEnter:void 0,this.onCameraExit=S&&S.onCameraExit?S.onCameraExit:void 0,this._debugEnabled=!(!S||!S.enableDebug)&&S.enableDebug}return Object.defineProperty(t.prototype,"debugEnabled",{get:function(){return this._debugEnabled},enumerable:!1,configurable:!0}),o([Component("npcTriggerComponent")],t)}(),j=function(v,S){this.size=v,this.position=S},q=function(v,S){this.radius=v,this.position=S},xt=function(){function t(v){this.origin=0,this.target=1,this.fraction=0,this.totalDuration=0,this.speed=[],this.loop=!1,this.path=v,At.createAndAddToEngine()}return t.prototype.setIndex=function(v){this.fraction=0,this.origin=v,this.target=v+1<this.path.length?v+1:0},o([Component("npclerpData")],t)}(),St=[],At=function(){function e(){e._instance=this}return e.prototype.update=function(S){var A,E;try{for(var R=n(St),O=R.next();!O.done;O=R.next()){var z=O.value;if(z.state==v.NPCState.FOLLOWPATH){var B=z.getComponent(Transform),M=z.getComponent(xt);if(M.fraction<1)M.fraction+=S*M.speed[M.origin],B.position=Vector3.Lerp(M.path[M.origin],M.path[M.target],M.fraction);else{if(M.origin=M.target,M.target+=1,M.target>=M.path.length){if(!M.loop)return z.stopWalking(),M.onFinishCallback&&M.onFinishCallback(),void(M.fraction=1);M.target=0}else M.onReachedPointCallback&&M.onReachedPointCallback();M.fraction=0,B.lookAt(M.path[M.target])}}}}catch(v){A={error:v}}finally{try{O&&!O.done&&(E=R.return)&&E.call(R)}finally{if(A)throw A.error}}},e.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new e,engine.addSystem(this._instance)),this._instance},e._instance=null,e}(),_t=100,Pt=function(){function t(v,S,A){this.NPCScript=[],this.isBubleOpen=!1,this.activeTextId=0,this.defaultSound=null,this.baseYOffset=2.5,this.baseYOffset=S||2.5,this.rootEntity=new Entity,this.rootEntity.addComponent(new Billboard(!1,!0,!1)),this.rootEntity.addComponent(new Transform),this.rootEntity.setParent(v),this.container=new Entity,this.container.addComponent(new Transform({position:new Vector3(-.1,this.baseYOffset,0)})),this.container.setParent(this.rootEntity),this.material=new BasicMaterial,this.material.texture=X,this.panel=new Entity,this.panel.addComponent(new Transform({scale:new Vector3(2,1,1)})),this.panel.setParent(this.container),this.panel.addComponent(new PlaneShape),this.panel.addComponent(this.material),this.panel.getComponent(PlaneShape).visible=!1,b(this.panel.getComponent(PlaneShape),Z.bubbles.normal,1024,1024),this.text=new Entity,this.text.addComponent(new Transform({position:new Vector3(0,0,.05),rotation:Quaternion.Euler(0,180,0)})),this.text.addComponent(new TextShape("")),this.text.setParent(this.container),this.text.getComponent(TextShape).textWrapping=!0,this.text.getComponent(TextShape).font=V,this.text.getComponent(TextShape).hTextAlign="center",this.text.getComponent(TextShape).vTextAlign="center",this.text.getComponent(TextShape).fontSize=1,this.text.getComponent(TextShape).fontWeight="normal",this.text.getComponent(TextShape).color=Color3.Black(),this.text.getComponent(TextShape).visible=!1,this.soundEnt=new Entity,A&&(this.soundEnt.addComponent(new Transform),engine.addEntity(this.soundEnt),this.soundEnt.setParent(this.container),this.soundEnt.addComponent(new AudioSource(new AudioClip(A))),this.soundEnt.getComponent(AudioSource).volume=.5,this.defaultSound=A),It.createAndAddToEngine()}return t.prototype.openDialogWindow=function(v,S){this.NPCScript=v,this.activeTextId=S?"number"==typeof S?S:function(v,S){for(var A=0;A<v.length;A++)if(v[A].name&&v[A].name==S)return A;return 0}(v,S):0;var A=v[this.activeTextId]?v[this.activeTextId]:{text:""};A.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(A.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce()),this.text.getComponent(TextShape).fontSize=A.fontSize?A.fontSize:1,this.text.getComponent(Transform).position.y=A.offsetY?A.offsetY+0:0,this.text.getComponent(Transform).position.x=A.offsetX?A.offsetX:0,this.text.getComponent(TextShape).visible=!0,this.panel.getComponent(PlaneShape).visible=!0,this.text.getComponent(TextShape).value="",A.text.length<_t&&A.text.slice(0,_t),It._instance.newText(this,A.text,this.activeTextId,A.timeOn?A.timeOn:void 0,A.typeSpeed?A.typeSpeed:void 0),this.adjustBubble(A.text.length),this.layoutDialogWindow(this.activeTextId),this.isBubleOpen=!0},t.prototype.adjustBubble=function(v){v<8?(b(this.panel.getComponent(PlaneShape),Z.bubbles.short,1024,1024),this.panel.getComponent(Transform).scale.x=.58,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.1,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=.7):v<25?(b(this.panel.getComponent(PlaneShape),Z.bubbles.normal,1024,1024),this.panel.getComponent(Transform).scale.x=1.43,this.panel.getComponent(Transform).scale.y=.42,this.container.getComponent(Transform).position.x=-.5,this.container.getComponent(Transform).position.y=this.baseYOffset+-.2,this.text.getComponent(TextShape).width=1.5):v<50?(b(this.panel.getComponent(PlaneShape),Z.bubbles.long,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=.765,this.container.getComponent(Transform).position.y=this.baseYOffset+0,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2):(b(this.panel.getComponent(PlaneShape),Z.bubbles.huge,1024,1024),this.panel.getComponent(Transform).scale.x=2.485,this.panel.getComponent(Transform).scale.y=1.195,this.container.getComponent(Transform).position.y=this.baseYOffset+.2,this.container.getComponent(Transform).position.x=-.8,this.text.getComponent(TextShape).width=2)},t.prototype.next=function(){var v=this.NPCScript[this.activeTextId];v||(v=this.NPCScript[this.activeTextId-1]),v.triggeredByNext&&v.triggeredByNext(),v.isEndOfDialog?this.closeDialogWindow():(this.activeTextId++,(v=this.NPCScript[this.activeTextId]).text.length<_t&&v.text.slice(0,_t),this.text.getComponent(TextShape).value="",this.adjustBubble(v.text.length),It._instance.newText(this,v.text,this.activeTextId,v.timeOn?v.timeOn:void 0,v.typeSpeed?v.typeSpeed:void 0),this.layoutDialogWindow(this.activeTextId))},t.prototype.layoutDialogWindow=function(v){var S=this.NPCScript[v]?this.NPCScript[v]:{text:""},A=S.offsetY?S.offsetY+0:0;S.buttons&&S.buttons.length>=3?A+=50:S.buttons&&S.buttons.length>=1&&(A+=24),this.text.getComponent(TextShape).fontSize=S.fontSize?S.fontSize:1,this.text.getComponent(Transform).position.y=A,S.audio?(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(S.audio))),this.soundEnt.getComponent(AudioSource).volume=.5,this.soundEnt.getComponent(AudioSource).playOnce()):this.defaultSound&&(this.soundEnt.addComponentOrReplace(new AudioSource(new AudioClip(this.defaultSound))),this.soundEnt.getComponent(AudioSource).playOnce())},t.prototype.closeDialogWindow=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1)},t.prototype.closeDialogEndAll=function(){this.isBubleOpen&&(this.isBubleOpen=!1,this.text.getComponent(TextShape).value="",this.text.getComponent(TextShape).visible=!1,this.panel.getComponent(PlaneShape).visible=!1,It._instance.Dialog==this&&(It._instance.done=!0))},t.prototype.skipDialogs=function(){if(this.isBubleOpen)for(;this.NPCScript[this.activeTextId];){if(this.NPCScript[this.activeTextId].triggeredByNext&&this.NPCScript[this.activeTextId].triggeredByNext(),this.NPCScript[this.activeTextId].isEndOfDialog)return void this.closeDialogWindow();this.activeTextId+=1}},t}(),It=function(){function t(){this.timer=0,this.speed=45,this.visibleChars=0,this.fullText="",this.Text=null,this.textId=0,this.done=!0,this.showing=!1,this.timeOn=3,t._instance=this}return t.createAndAddToEngine=function(){return null==this._instance&&(this._instance=new t,engine.addSystem(this._instance)),this._instance},t.prototype.update=function(v){if(!this.done)if(this.timer+=v,this.showing)this.timer>this.timeOn&&(this.showing=!1,this.done=!0,this.timer=0,this.window.next());else if(this.timer>=2/this.speed){var S=Math.floor(this.timer/(1/this.speed));this.timer=0,this.visibleChars+=S,this.closeTag(S),this.visibleChars>=this.fullText.length&&(this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length),this.Text&&(this.Text.value=this.fullText.substr(0,this.visibleChars))}},t.prototype.newText=function(v,S,A,E,R){if(v!=this.Dialog||A!=this.textId){var O=this.Dialog;this.Dialog=v,this.Text=this.Dialog.text.getComponent(TextShape),this.textId=A,O&&v!=O&&O.skipDialogs(),this.timer=0,this.done=!1,this.showing=!1,this.fullText=S,this.visibleChars=0,this.window=v,R&&R<=0?this.rush():this.speed=R||45,this.timeOn=E||3}},t.prototype.rush=function(){this.showing=!0,this.timer=0,this.visibleChars=this.fullText.length,this.Text&&(this.Text.value=this.fullText)},t.prototype.closeTag=function(v){if(0!=this.visibleChars&&0!=v){for(var S=!1,A=!1,E=this.visibleChars-v;E<this.visibleChars;E++)S?">"==this.fullText.substr(E,1)&&(A=!0):"<"==this.fullText.substr(E,1)&&(S=!0);if(S&&!A)for(;this.visibleChars<this.fullText.length&&">"!=this.fullText.substr(this.visibleChars-1,1);)this.visibleChars+=1}},t._instance=null,t}(),Rt=function(A){function o(E,R,O,z){var B=A.call(this)||this;B.introduced=!1,B.onWalkAway=null,B.inCooldown=!1,B.coolDownDuration=5,B.faceUser=!1,B.walkingAnim=null,B.walkingSpeed=2,B.bubbleHeight=2,B.addComponent(new GLTFShape(R)),B.addComponent(new Transform(E)),engine.addEntity(B),B.state=v.NPCState.STANDING,z&&z.noUI||(z&&z.portrait?B.dialog=new ft("string"==typeof z.portrait?{path:z.portrait}:z.portrait,!(!z||!z.darkUI)&&z.darkUI,z.dialogSound?z.dialogSound:void 0):B.dialog=new ft(void 0,!(!z||!z.darkUI)&&z.darkUI,z&&z.dialogSound?z.dialogSound:void 0)),z&&z.textBubble&&(z&&z.bubbleHeight&&(B.bubbleHeight=z.bubbleHeight),B.bubble=new Pt(B,B.bubbleHeight,z.dialogSound?z.dialogSound:void 0)),B.addComponent(new Animator),B.idleAnim=new AnimationState(z&&z.idleAnim?z.idleAnim:"Idle",{looping:!0}),B.getComponent(Animator).addClip(B.idleAnim),B.lastPlayedAnim=B.idleAnim,B.idleAnim.play(),z&&z.walkingAnim&&(B.walkingAnim=new AnimationState(z.walkingAnim,{looping:!0}),B.getComponent(Animator).addClip(B.walkingAnim)),B.onActivate=O,z&&z.onWalkAway&&(B.onWalkAway=z.onWalkAway),B.endAnimTimer=new Entity,engine.addEntity(B.endAnimTimer),B.closeDialogTimer=new Entity,engine.addEntity(B.closeDialogTimer),B.pauseWalkingTimer=new Entity,engine.addEntity(B.pauseWalkingTimer);var M=z&&z.onlyClickTrigger?ActionButton.POINTER:ActionButton.PRIMARY;B.addComponent(new OnPointerDown((function(v){B.inCooldown||B.dialog&&B.dialog.isDialogOpen||B.activate()}),{button:M,hoverText:z&&z.hoverText?z.hoverText:"Talk",showFeedback:!z||!z.onlyExternalTrigger})),z&&z.onlyExternalTrigger&&B.removeComponent(OnPointerDown);var V={};return(!z||z&&!z.continueOnWalkAway)&&(V.onCameraExit=function(){B.handleWalkAway()}),z&&(!z||z.onlyExternalTrigger||z.onlyClickTrigger||z.onlyETrigger)||(V.onCameraEnter=function(){B.inCooldown?log(B.name," in cooldown"):B.dialog&&B.dialog.isDialogOpen||z&&z.onlyExternalTrigger||z&&z.onlyClickTrigger||B.activate()}),(V.onCameraEnter||V.onCameraExit)&&B.addComponent(new Ct(new q(z&&z.reactDistance?z.reactDistance:6,Vector3.Zero()),V)),z&&z.faceUser&&(B.addComponent(new S(!0,z.turningSpeed?z.turningSpeed:void 0)),B.faceUser=!0),z&&z.walkingSpeed&&(B.walkingSpeed=z.walkingSpeed),z&&z.coolDownDuration&&(B.coolDownDuration=z.coolDownDuration),z&&z.path&&(B.addComponent(new xt(z.path?z.path:[])),B.getComponent(xt).loop=!0,St.push(B),B.followPath()),B}return i(o,A),o.prototype.activate=function(){var v=this;this.faceUser&&(this.getComponent(S).active=!0),this.inCooldown=!0,this.addComponentOrReplace(new J(this.coolDownDuration,(function(){v.inCooldown=!1}))),this.onActivate()},o.prototype.endInteraction=function(){this.faceUser&&(this.getComponent(S).active=!1),this.dialog&&this.dialog.isDialogOpen&&this.dialog.closeDialogWindow(),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.state=v.NPCState.STANDING},o.prototype.handleWalkAway=function(){this.state!=v.NPCState.FOLLOWPATH&&(this.endInteraction(),this.onWalkAway&&this.onWalkAway())},o.prototype.talk=function(S,A,E){var R=this;this.introduced=!0,this.state=v.NPCState.TALKING,this.closeDialogTimer.hasComponent(J)&&this.closeDialogTimer.removeComponent(J),this.bubble&&this.bubble.isBubleOpen&&this.bubble.closeDialogWindow(),this.dialog.openDialogWindow(S,A||0),E&&this.closeDialogTimer.addComponentOrReplace(new J(E,(function(){R.dialog.closeDialogWindow()})))},o.prototype.talkBubble=function(v,S){this.bubble||(this.bubble=new Pt(this,this.bubbleHeight)),this.bubble.openDialogWindow(v,S||0)},o.prototype.playAnimation=function(v,S,A){var E=this;this.lastPlayedAnim.stop(),this.endAnimTimer.hasComponent(J)&&this.endAnimTimer.removeComponent(J);var R=this.getComponent(Animator).getClip(v);S&&(R.looping=!1,A&&this.endAnimTimer.addComponentOrReplace(new J(A,(function(){R.stop(),E.idleAnim&&(E.idleAnim.play(),E.lastPlayedAnim=E.idleAnim)})))),R.stop(),R.play(),this.lastPlayedAnim=R},o.prototype.changeIdleAnim=function(v,S){this.idleAnim.stop(),this.idleAnim=new AnimationState(v,{looping:!0}),this.getComponent(Animator).addClip(this.idleAnim),S&&(this.lastPlayedAnim.stop(),this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim)},o.prototype.followPath=function(A){if(!this.hasComponent(xt)){if(!A)return;this.addComponent(new xt(A.path?A.path:[])),St.push(this)}this.faceUser&&(this.getComponent(S).active=!1);var E=this.getComponent(xt);if(A){if(A.path)if(A.curve){var R=Curve3.CreateCatmullRomSpline(A.path,4*A.path.length,!!A.loop).getPoints();A.loop&&R.pop(),E.path=R}else E.path=A.path;null!=A.loop&&(E.loop=A.loop),null!=A.startingPoint&&E.setIndex(A.startingPoint),A.onFinishCallback&&(E.onFinishCallback=A.onFinishCallback),A.onReachedPointCallback&&(E.onReachedPointCallback=A.onReachedPointCallback)}var O=this.getComponent(Transform).position;(0==E.fraction&&E.path[E.origin].subtract(O).lengthSquared()>.1||E.fraction>0&&O.subtract(E.path[E.origin]).normalize()==E.path[E.target].subtract(E.path[E.origin]).normalize())&&(E.path.splice(E.origin,0,this.getComponent(Transform).position),E.fraction=0),this.getComponent(Transform).lookAt(E.path[E.target]);for(var z=0,B=[],M=0;M<E.path.length-1;M++){var V;z+=V=Vector3.Distance(E.path[M],E.path[M+1]),B.push(V)}for(E.loop&&(z+=V=Vector3.Distance(E.path[E.path.length-1],E.path[0]),B.push(V)),A&&A.totalDuration?E.totalDuration=A.totalDuration:A&&A.speed?E.totalDuration=z/A.speed:E.totalDuration||(E.totalDuration=z/this.walkingSpeed),E.speed=[],M=0;M<B.length;M++)E.speed.push(1/(B[M]/z*E.totalDuration));this.walkingAnim&&(this.endAnimTimer.hasComponent(J)&&this.endAnimTimer.removeComponent(J),this.idleAnim.stop(),this.lastPlayedAnim.stop(),this.walkingAnim.play(),this.lastPlayedAnim=this.walkingAnim),this.state=v.NPCState.FOLLOWPATH},o.prototype.stopWalking=function(S){var A=this;this.state=v.NPCState.STANDING,this.walkingAnim&&(this.walkingAnim.stop(),this.idleAnim.play(),this.lastPlayedAnim=this.idleAnim),S&&this.pauseWalkingTimer.addComponentOrReplace(new J(S,(function(){A.dialog&&A.dialog.isDialogOpen||(A.lastPlayedAnim.stop(),A.walkingAnim&&(A.walkingAnim.play(),A.lastPlayedAnim=A.walkingAnim),A.endAnimTimer.hasComponent(J)&&A.endAnimTimer.removeComponent(J),A.state=v.NPCState.FOLLOWPATH)})))},o}(Entity);v.CustomDialogButton=yt,v.DialogTypeInSystem=gt,v.DialogWindow=ft,v.NPC=Rt,v.NPCDelay=J,v.NPCLerpData=xt,v.NPCTriggerComponent=Ct,v.SFFont=M,v.SFHeavyFont=V,v.TrackUserFlag=S,v.TriggerBoxShape=j,v.TriggerSphereShape=q,v.canvas=O,v.darkTheme=H,v.lightTheme=W,Object.defineProperty(v,"__esModule",{value:!0})})),define("dcl-builder-hud",["exports","@decentraland/EnvironmentAPI"],(function(v,S){function e(v,S,A,E){return new(A||(A=Promise))((function(R,O){function a(v){try{r(E.next(v))}catch(v){O(v)}}function h(v){try{r(E.throw(v))}catch(v){O(v)}}function r(v){var S;v.done?R(v.value):(S=v.value,S instanceof A?S:new A((function(v){v(S)}))).then(a,h)}r((E=E.apply(v,S||[])).next())}))}function n(v,S){var A,E,R,O,z={label:0,sent:function(){if(1&R[0])throw R[1];return R[1]},trys:[],ops:[]};return O={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(O[Symbol.iterator]=function(){return this}),O;function h(O){return function(B){return function(O){if(A)throw new TypeError("Generator is already executing.");for(;z;)try{if(A=1,E&&(R=2&O[0]?E.return:O[0]?E.throw||((R=E.return)&&R.call(E),0):E.next)&&!(R=R.call(E,O[1])).done)return R;switch(E=0,R&&(O=[2&O[0],R.value]),O[0]){case 0:case 1:R=O;break;case 4:return z.label++,{value:O[1],done:!1};case 5:z.label++,E=O[1],O=[0];continue;case 7:O=z.ops.pop(),z.trys.pop();continue;default:if(!((R=(R=z.trys).length>0&&R[R.length-1])||6!==O[0]&&2!==O[0])){z=0;continue}if(3===O[0]&&(!R||O[1]>R[0]&&O[1]<R[3])){z.label=O[1];break}if(6===O[0]&&z.label<R[1]){z.label=R[1],R=O;break}if(R&&z.label<R[2]){z.label=R[2],z.ops.push(O);break}R[2]&&z.ops.pop(),z.trys.pop();continue}O=S.call(v,z)}catch(v){O=[6,v],E=0}finally{A=R=0}if(5&O[0])throw O[1];return{value:O[0]?O[1]:void 0,done:!0}}([O,B])}}}var A=function(){function t(v,S,A){this.direction=v,this.mode=S,this.pos=A||0}return t=function(v,S,A,E){var R,O=arguments.length,z=O<3?S:null===E?E=Object.getOwnPropertyDescriptor(S,A):E;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)z=Reflect.decorate(v,S,A,E);else for(var B=v.length-1;B>=0;B--)(R=v[B])&&(z=(O<3?R(z):O>3?R(S,A,z):R(S,A))||z);return O>3&&z&&Object.defineProperty(S,A,z),z}([Component("moving")],t),t}(),E=engine.getComponentGroup(A),R=function(){function t(){this.positions=[]}return t.prototype.addCameraPosition=function(v){this.positions.push(v),log(this.positions)},t.prototype.update=function(){var v,S;try{for(var R=function(v){var S="function"==typeof Symbol&&Symbol.iterator,A=S&&v[S],E=0;if(A)return A.call(v);if(v&&"number"==typeof v.length)return{next:function(){return v&&E>=v.length&&(v=void 0),{value:v&&v[E++],done:!v}}};throw new TypeError(S?"Object is not iterable.":"Symbol.iterator is not defined.")}(E.entities),O=R.next();!O.done;O=R.next()){var z=O.value,B=z.getComponent(Transform).position,M=z.getComponent(A).direction;switch(z.getComponent(A).mode){case"fixed":var V=z.getComponent(Transform).position.clone(),W=z.getComponent(A).pos;Vector3.Distance(V,this.positions[W])<.05?z.removeComponent(A):z.getComponent(Transform).position=Vector3.Lerp(V,this.positions[W],.04);break;case"free":"up"==M&&B.y<150&&(B.y+=.1),"down"==M&&(B.y>.2?B.y-=.1:z.removeComponent(A)),"forward"==M&&(B.z+=.1),"back"==M&&(B.z>1?B.z-=.1:z.removeComponent(A)),"right"==M&&(B.x+=.1),"left"==M&&(B.x>1?B.x-=.1:z.removeComponent(A))}}}catch(S){v={error:S}}finally{try{O&&!O.done&&(S=R.return)&&S.call(R)}finally{if(v)throw v.error}}},t}(),O=function(){function t(){var v=this;this.isSetup=!1,this.entities=[],this.numEntities=0,this.selectedEntityIndex=-1,this.selectionPointerScale=1,this.selectionPointerElevation=1,this.newEntityScale=.1,this.modePOSITION=0,this.modeROTATION=1,this.modeSCALE=2,this.mode=this.modePOSITION,this.snap=0,this.snapPosScale=1,this.snapRot=90,this.uiMaximized=!1,this.engineEntities=[],this.showingColliders=!1,this.transparent=new Texture("https://lsnft.mypinata.cloud/ipfs/QmaqcRuouE6Tip9acZmjxMyBftEA5aHASRDjn8Bmad87Ld"),this.scaffoldScale=new Vector3(1.2,1,1.2),this.transparentMat=new BasicMaterial,this.transparentMat.alphaTest=1,this.transparentMat.texture=this.transparent,this.scaffolding=new Entity,this.scaffolding.addComponent(new Transform({position:new Vector3(1,.3,1),scale:Vector3.Zero()})),engine.addEntity(this.scaffolding);var A=new Entity;A.addComponent(new Transform({position:new Vector3(-.5,1,-.5),scale:Vector3.One()})),A.setParent(this.scaffolding);var E=new Entity;E.addComponent(new BoxShape),E.addComponent(new Transform({position:new Vector3(2,0,.1),scale:new Vector3(4,.1,.1)})),E.setParent(A),E.getComponent(BoxShape).withCollisions=!1,E.addComponent(new Material),E.getComponent(Material).albedoColor=Color4.Red();var O=new Entity;O.addComponent(new TextShape("X")),O.addComponent(new Transform({position:new Vector3(3,.5,.4)})),O.addComponent(new Billboard(!1,!0,!1)),O.setParent(A);var z=new Entity;z.addComponent(new BoxShape),z.addComponent(new Transform({position:new Vector3(.1,2,.1),scale:new Vector3(.1,4,.1)})),z.setParent(A),z.getComponent(BoxShape).withCollisions=!1,z.addComponent(new Material),z.getComponent(Material).albedoColor=Color4.Green();var M=new Entity;M.addComponent(new TextShape("Y")),M.addComponent(new Transform({position:new Vector3(.5,3,.5)})),M.addComponent(new Billboard(!1,!0,!1)),M.setParent(A);var V=new Entity;V.addComponent(new BoxShape),V.addComponent(new Transform({position:new Vector3(.1,0,2),scale:new Vector3(.1,.1,4)})),V.setParent(A),V.addComponent(new Material),V.getComponent(BoxShape).withCollisions=!1,V.getComponent(Material).albedoColor=Color4.Blue();var W=new Entity;W.addComponent(new TextShape("Z")),W.addComponent(new Transform({position:new Vector3(.4,1,4)})),W.addComponent(new Billboard(!1,!0,!1)),W.setParent(A),this.scaffloor=new Entity,this.scaffloor.addComponent(new PlaneShape),this.scaffloor.addComponent(new Transform({position:new Vector3(0,0,0),rotation:Quaternion.Euler(90,0,0),scale:Vector3.One()})),this.scaffloor.addComponent(new Material),engine.addEntity(this.scaffloor),this.scaffloor.setParent(this.scaffolding),this.leftWall=new Entity,this.leftWall.addComponent(new PlaneShape),this.leftWall.addComponent(new Transform({position:new Vector3(0,-4.5,.6),rotation:Quaternion.Euler(0,180,0),scale:Vector3.Zero()})),this.leftWall.addComponent(this.transparentMat),this.leftWall.setParent(this.scaffolding),this.rightWall=new Entity,this.rightWall.addComponent(new PlaneShape),this.rightWall.addComponent(new Transform({position:new Vector3(0,-4.5,-.6),rotation:Quaternion.Euler(0,180,0),scale:Vector3.Zero()})),this.rightWall.addComponent(this.transparentMat),this.rightWall.setParent(this.scaffolding),this.frontWall=new Entity,this.frontWall.addComponent(new PlaneShape),this.frontWall.addComponent(new Transform({position:new Vector3(.6,-4.5,0),rotation:Quaternion.Euler(0,270,0),scale:Vector3.Zero()})),this.frontWall.addComponent(this.transparentMat),this.frontWall.setParent(this.scaffolding),this.backWall=new Entity,this.backWall.addComponent(new PlaneShape),this.backWall.addComponent(new Transform({position:new Vector3(-.6,-4.5,0),rotation:Quaternion.Euler(0,270,0),scale:Vector3.One()})),this.backWall.addComponent(this.transparentMat),this.backWall.setParent(this.scaffolding),this.selectionPointer=new Entity,this.selectionPointer.addComponent(new PlaneShape),this.selectionPointer.getComponent(PlaneShape).withCollisions=!1,this.selectionPointer.addComponent(new BasicMaterial),this.selectionPointer.getComponent(BasicMaterial).texture=new Texture("https://lsnft.mypinata.cloud/ipfs/QmWbKQtJjsLjgDFinoH6fvmbUoetLZd7LanChC1R4QkA2e"),this.selectionPointer.addComponent(new Transform({rotation:Quaternion.Euler(0,0,180),scale:Vector3.One()})),this.selectionPointer.addComponent(new Billboard(!1,!0,!1)),this.setupUI(),executeTask((function(){return e(v,void 0,void 0,(function(){return n(this,(function(v){switch(v.label){case 0:return[4,S.isPreviewMode()];case 1:return v.sent()?(log("in preview mode"),B.uiMinimizedContainer.visible=!0):(log("not in preview mode"),B.uiMinimizedContainer.visible=!1,B.uiMaximizedContainer.visible=!1,engine.removeEntity(this.selectionPointer)),[2]}}))}))})),this.unsavedContainer=new UIContainerRect(this.uiMaximizedContainer),this.unsavedContainer.hAlign="center",this.unsavedContainer.vAlign="center",this.unsavedContainer.width=160,this.unsavedContainer.height=20,this.unsavedContainer.positionY=225,this.unsavedContainer.positionX=0,this.unsavedContainer.color=Color4.Red(),this.unsavedContainer.visible=!1;var H=new UIText(this.unsavedContainer);H.hAlign="center",H.vAlign="center",H.positionY=0,H.positionX=0,H.height=10,H.fontSize=12,H.hTextAlign="center",H.value="** Unsaved Changes **",this.movingSystem=new R,engine.addSystem(this.movingSystem)}return t.prototype.setDefaultParent=function(v){this.defaultParent=v},t.prototype.setupUI=function(){return e(this,void 0,void 0,(function(){var v,S,A,E,R=this;return n(this,(function(O){return this.isSetup=!0,v=new Texture("https://lsnft.mypinata.cloud/ipfs/QmYyDWc67svskJWxQrZNJxjwNsvsXyG9dvVzXvJtYtmgAr"),this.canvas=new UICanvas,this.canvas.hAlign="center",this.canvas.vAlign="bottom",this.uiMinimizedContainer=new UIContainerRect(this.canvas),this.uiMinimizedContainer.hAlign="right",this.uiMinimizedContainer.vAlign="bottom",this.uiMinimizedContainer.width=70,this.uiMinimizedContainer.height=80,this.uiMinimizedContainer.positionY=100,this.uiMinimizedContainer.positionX=0,this.uiMinimizedContainer.color=new Color4(0,0,0,0),this.uiMinimizedContainer.visible=!1,this.maximizeButton=new UIImage(this.uiMinimizedContainer,v),this.maximizeButton.sourceLeft=826,this.maximizeButton.sourceTop=544,this.maximizeButton.sourceWidth=74,this.maximizeButton.sourceHeight=74,this.maximizeButton.hAlign="right",this.maximizeButton.vAlign="bottom",this.maximizeButton.positionX=-15,this.maximizeButton.positionY=30,this.maximizeButton.width=40,this.maximizeButton.height=40,this.maximizeButton.isPointerBlocker=!0,this.maximizeButton.onClick=new OnClick((function(){R.maximizeUI()})),this.uiMaximizedContainer=new UIContainerRect(this.canvas),this.uiMaximizedContainer.hAlign="right",this.uiMaximizedContainer.vAlign="bottom",this.uiMaximizedContainer.width=160,this.uiMaximizedContainer.height=430,this.uiMaximizedContainer.positionX=0,this.uiMaximizedContainer.positionY=100,this.uiMaximizedContainer.color=new Color4(0,0,0,.75),(S=new UIImage(this.uiMaximizedContainer,v)).sourceLeft=826,S.sourceTop=184,S.sourceWidth=74,S.sourceHeight=74,S.hAlign="right",S.vAlign="top",S.positionX=-60,S.positionY=-10,S.width=40,S.height=40,S.isPointerBlocker=!0,S.onClick=new OnClick((function(){R.toggleLift.sourceLeft=503,R.toggleColliders(!0),engine.addSystem(new M(S))})),this.toggleLift=new UIImage(this.uiMaximizedContainer,v),this.toggleLift.sourceLeft=584,this.toggleLift.sourceTop=544,this.toggleLift.sourceWidth=74,this.toggleLift.sourceHeight=74,this.toggleLift.hAlign="right",this.toggleLift.vAlign="top",this.toggleLift.positionX=-15,this.toggleLift.positionY=-10,this.toggleLift.width=40,this.toggleLift.height=40,this.toggleLift.isPointerBlocker=!0,this.toggleLift.onClick=new OnClick((function(){R.toggleColliders(!1),engine.addSystem(new M(R.toggleLift))})),this.toggleCamera=new UIImage(this.uiMaximizedContainer,v),this.toggleCamera.sourceLeft=16,this.toggleCamera.sourceTop=94,this.toggleCamera.sourceWidth=74,this.toggleCamera.sourceHeight=74,this.toggleCamera.hAlign="right",this.toggleCamera.vAlign="top",this.toggleCamera.positionX=-105,this.toggleCamera.positionY=-10,this.toggleCamera.width=40,this.toggleCamera.height=40,this.toggleCamera.isPointerBlocker=!0,this.toggleCamera.onClick=new OnClick((function(){R.toggleCameraOptions(),engine.addSystem(new M(R.toggleCamera))})),this.toggleCamera.visible=!1,this.scaffoldB=new UIImage(this.uiMaximizedContainer,v),this.scaffoldB.sourceLeft=340,this.scaffoldB.sourceTop=544,this.scaffoldB.sourceWidth=74,this.scaffoldB.sourceHeight=74,this.scaffoldB.hAlign="right",this.scaffoldB.vAlign="bottom",this.scaffoldB.positionX=-105,this.scaffoldB.positionY=335,this.scaffoldB.width=40,this.scaffoldB.height=40,this.scaffoldB.isPointerBlocker=!0,this.scaffoldB.onClick=new OnClick((function(){R.moveScaffold("q"),engine.addSystem(new M(R.scaffoldB))})),this.scaffoldU=new UIImage(this.uiMaximizedContainer,v),this.scaffoldU.sourceLeft=178,this.scaffoldU.sourceTop=544,this.scaffoldU.sourceWidth=74,this.scaffoldU.sourceHeight=74,this.scaffoldU.hAlign="right",this.scaffoldU.vAlign="bottom",this.scaffoldU.positionX=-60,this.scaffoldU.positionY=335,this.scaffoldU.width=40,this.scaffoldU.height=40,this.scaffoldU.isPointerBlocker=!0,this.scaffoldU.onClick=new OnClick((function(){R.moveScaffold("w"),engine.addSystem(new M(R.scaffoldU))})),this.scaffoldF=new UIImage(this.uiMaximizedContainer,v),this.scaffoldF.sourceLeft=422,this.scaffoldF.sourceTop=544,this.scaffoldF.sourceWidth=74,this.scaffoldF.sourceHeight=74,this.scaffoldF.hAlign="right",this.scaffoldF.vAlign="bottom",this.scaffoldF.positionX=-15,this.scaffoldF.positionY=335,this.scaffoldF.width=40,this.scaffoldF.height=40,this.scaffoldF.isPointerBlocker=!0,this.scaffoldF.onClick=new OnClick((function(){R.moveScaffold("e"),engine.addSystem(new M(R.scaffoldF))})),this.scaffoldL=new UIImage(this.uiMaximizedContainer,v),this.scaffoldL.sourceLeft=16,this.scaffoldL.sourceTop=544,this.scaffoldL.sourceWidth=74,this.scaffoldL.sourceHeight=74,this.scaffoldL.hAlign="right",this.scaffoldL.vAlign="bottom",this.scaffoldL.positionX=-105,this.scaffoldL.positionY=290,this.scaffoldL.width=40,this.scaffoldL.height=40,this.scaffoldL.isPointerBlocker=!0,this.scaffoldL.onClick=new OnClick((function(){R.moveScaffold("a"),engine.addSystem(new M(R.scaffoldL))})),this.scaffoldD=new UIImage(this.uiMaximizedContainer,v),this.scaffoldD.sourceLeft=259,this.scaffoldD.sourceTop=544,this.scaffoldD.sourceWidth=74,this.scaffoldD.sourceHeight=74,this.scaffoldD.hAlign="right",this.scaffoldD.vAlign="bottom",this.scaffoldD.positionX=-60,this.scaffoldD.positionY=290,this.scaffoldD.width=40,this.scaffoldD.height=40,this.scaffoldD.isPointerBlocker=!0,this.scaffoldD.onClick=new OnClick((function(){R.moveScaffold("s"),engine.addSystem(new M(R.scaffoldD))})),this.scaffoldR=new UIImage(this.uiMaximizedContainer,v),this.scaffoldR.sourceLeft=97,this.scaffoldR.sourceTop=544,this.scaffoldR.sourceWidth=74,this.scaffoldR.sourceHeight=74,this.scaffoldR.hAlign="right",this.scaffoldR.vAlign="bottom",this.scaffoldR.positionX=-15,this.scaffoldR.positionY=290,this.scaffoldR.width=40,this.scaffoldR.height=40,this.scaffoldR.isPointerBlocker=!0,this.scaffoldR.onClick=new OnClick((function(){R.moveScaffold("d"),engine.addSystem(new M(R.scaffoldR))})),this.displayName=new UIText(this.uiMaximizedContainer),this.displayName.hAlign="center",this.displayName.vAlign="top",this.displayName.positionY=-180,this.displayName.positionX=0,this.displayName.height=10,this.displayName.fontSize=12,this.displayName.hTextAlign="center",(A=new UIText(this.uiMaximizedContainer)).hAlign="center",A.vAlign="top",A.positionY=-160,A.positionX=0,A.height=10,A.fontSize=12,A.hTextAlign="center",A.value="Entity Label",this.displayPRS=new UIText(this.uiMaximizedContainer),this.displayPRS.hAlign="center",this.displayPRS.vAlign="top",this.displayPRS.positionY=-200,this.displayPRS.positionX=0,this.displayPRS.height=10,this.displayPRS.fontSize=12,this.displayPRS.hTextAlign="center",this.displayPRS.value="(0,0,0)",this.scaffoldTitle=new UIText(this.uiMaximizedContainer),this.scaffoldTitle.hAlign="center",this.scaffoldTitle.vAlign="top",this.scaffoldTitle.positionY=-25,this.scaffoldTitle.positionX=-45,this.scaffoldTitle.height=10,this.scaffoldTitle.fontSize=8,this.scaffoldTitle.hTextAlign="center",this.scaffoldTitle.value="Scaffold",this.selectPreviousButton=new UIImage(this.uiMaximizedContainer,v),this.selectPreviousButton.sourceLeft=16,this.selectPreviousButton.sourceTop=184,this.selectPreviousButton.sourceWidth=74,this.selectPreviousButton.sourceHeight=74,this.selectPreviousButton.hAlign="right",this.selectPreviousButton.vAlign="bottom",this.selectPreviousButton.positionX=-105,this.selectPreviousButton.positionY=30,this.selectPreviousButton.width=40,this.selectPreviousButton.height=40,this.selectPreviousButton.isPointerBlocker=!0,this.selectPreviousButton.onClick=new OnClick((function(){R.selectPrevious(),engine.addSystem(new M(R.selectPreviousButton))})),this.selectNextButton=new UIImage(this.uiMaximizedContainer,v),this.selectNextButton.sourceLeft=97,this.selectNextButton.sourceTop=184,this.selectNextButton.sourceWidth=74,this.selectNextButton.sourceHeight=74,this.selectNextButton.hAlign="right",this.selectNextButton.vAlign="bottom",this.selectNextButton.positionX=-60,this.selectNextButton.positionY=30,this.selectNextButton.width=40,this.selectNextButton.height=40,this.selectNextButton.isPointerBlocker=!0,this.selectNextButton.onClick=new OnClick((function(){R.selectNext(),engine.addSystem(new M(R.selectNextButton))})),this.saveButton=new UIImage(this.uiMaximizedContainer,v),this.saveButton.sourceLeft=745,this.saveButton.sourceTop=184,this.saveButton.sourceWidth=74,this.saveButton.sourceHeight=74,this.saveButton.hAlign="right",this.saveButton.vAlign="bottom",this.saveButton.positionX=-15,this.saveButton.positionY=75,this.saveButton.width=40,this.saveButton.height=40,this.saveButton.isPointerBlocker=!0,this.saveButton.onClick=new OnClick((function(){R.dump(),engine.addSystem(new M(R.saveButton))})),this.qButton=new UIImage(this.uiMaximizedContainer,v),this.qButton.sourceLeft=340,this.qButton.sourceTop=544,this.qButton.sourceWidth=74,this.qButton.sourceHeight=74,this.qButton.hAlign="right",this.qButton.vAlign="bottom",this.qButton.positionX=-105,this.qButton.positionY=165,this.qButton.width=40,this.qButton.height=40,this.qButton.isPointerBlocker=!0,this.qButton.onClick=new OnClick((function(v){R.adjustTransform("q"),engine.addSystem(new M(R.qButton))})),this.wButton=new UIImage(this.uiMaximizedContainer,v),this.wButton.sourceLeft=178,this.wButton.sourceTop=544,this.wButton.sourceWidth=74,this.wButton.sourceHeight=74,this.wButton.hAlign="right",this.wButton.vAlign="bottom",this.wButton.positionX=-60,this.wButton.positionY=165,this.wButton.width=40,this.wButton.height=40,this.wButton.isPointerBlocker=!0,this.wButton.onClick=new OnClick((function(){R.adjustTransform("w"),engine.addSystem(new M(R.wButton))})),this.eButton=new UIImage(this.uiMaximizedContainer,v),this.eButton.sourceLeft=422,this.eButton.sourceTop=544,this.eButton.sourceWidth=74,this.eButton.sourceHeight=74,this.eButton.hAlign="right",this.eButton.vAlign="bottom",this.eButton.positionX=-15,this.eButton.positionY=165,this.eButton.width=40,this.eButton.height=40,this.eButton.isPointerBlocker=!0,this.eButton.onClick=new OnClick((function(){R.adjustTransform("e"),engine.addSystem(new M(R.eButton))})),this.aButton=new UIImage(this.uiMaximizedContainer,v),this.aButton.sourceLeft=16,this.aButton.sourceTop=544,this.aButton.sourceWidth=74,this.aButton.sourceHeight=74,this.aButton.hAlign="right",this.aButton.vAlign="bottom",this.aButton.positionX=-105,this.aButton.positionY=120,this.aButton.width=40,this.aButton.height=40,this.aButton.isPointerBlocker=!0,this.aButton.onClick=new OnClick((function(){R.adjustTransform("a"),engine.addSystem(new M(R.aButton))})),this.sButton=new UIImage(this.uiMaximizedContainer,v),this.sButton.sourceLeft=259,this.sButton.sourceTop=544,this.sButton.sourceWidth=74,this.sButton.sourceHeight=74,this.sButton.hAlign="right",this.sButton.vAlign="bottom",this.sButton.positionX=-60,this.sButton.positionY=120,this.sButton.width=40,this.sButton.height=40,this.sButton.isPointerBlocker=!0,this.sButton.onClick=new OnClick((function(){R.adjustTransform("s"),engine.addSystem(new M(R.sButton))})),this.dButton=new UIImage(this.uiMaximizedContainer,v),this.dButton.sourceLeft=97,this.dButton.sourceTop=544,this.dButton.sourceWidth=74,this.dButton.sourceHeight=74,this.dButton.hAlign="right",this.dButton.vAlign="bottom",this.dButton.positionX=-15,this.dButton.positionY=120,this.dButton.width=40,this.dButton.height=40,this.dButton.isPointerBlocker=!0,this.dButton.onClick=new OnClick((function(){R.adjustTransform("d"),engine.addSystem(new M(R.dButton))})),this.modeButton=new UIImage(this.uiMaximizedContainer,v),this.modeButton.sourceLeft=259,this.modeButton.sourceTop=94,this.modeButton.sourceWidth=74,this.modeButton.sourceHeight=74,this.modeButton.hAlign="right",this.modeButton.vAlign="bottom",this.modeButton.positionX=-105,this.modeButton.positionY=75,this.modeButton.width=40,this.modeButton.height=40,this.modeButton.isPointerBlocker=!0,this.modeButton.onClick=new OnClick((function(){R.mode+=1,R.mode>R.modeSCALE&&(R.mode=R.modePOSITION),R.snap=0,R.setSnaps(),R.applyModeAndSnapLabels(),engine.addSystem(new M(R.modeButton))})),this.modeLabel=new UIText(this.modeButton),this.modeLabel.color=Color4.White(),this.modeLabel.hAlign="center",this.modeLabel.vAlign="bottom",this.modeLabel.paddingTop=0,this.modeLabel.paddingBottom=12,this.modeLabel.positionX=-30,this.modeLabel.paddingLeft=0,this.modeLabel.fontSize=12,this.modeLabel.fontWeight="bold",this.modeLabel.isPointerBlocker=!1,this.modeLabel.hTextAlign="center",this.snapButton=new UIImage(this.uiMaximizedContainer,v),this.snapButton.sourceLeft=259,this.snapButton.sourceTop=93,this.snapButton.sourceWidth=74,this.snapButton.sourceHeight=74,this.snapButton.hAlign="right",this.snapButton.vAlign="bottom",this.snapButton.positionX=-60,this.snapButton.positionY=75,this.snapButton.width=40,this.snapButton.height=40,this.snapButton.isPointerBlocker=!0,this.snapButton.onClick=new OnClick((function(){R.snap+=1,R.snap>3&&(R.snap=0),R.setSnaps(),R.applyModeAndSnapLabels(),engine.addSystem(new M(R.snapButton))})),this.snapLabel=new UIText(this.snapButton),this.snapLabel.color=Color4.White(),this.snapLabel.hAlign="right",this.snapLabel.vAlign="bottom",this.snapLabel.positionX=-30,this.snapLabel.paddingTop=0,this.snapLabel.paddingBottom=12,this.snapLabel.paddingLeft=0,this.snapLabel.fontSize=12,this.snapLabel.fontWeight="bold",this.snapLabel.hTextAlign="center",this.snapLabel.isPointerBlocker=!1,this.applyModeAndSnapLabels(!0),this.minimizeButton=new UIImage(this.uiMaximizedContainer,v),this.minimizeButton.sourceLeft=908,this.minimizeButton.sourceTop=544,this.minimizeButton.sourceWidth=74,this.minimizeButton.sourceHeight=74,this.minimizeButton.hAlign="right",this.minimizeButton.vAlign="bottom",this.minimizeButton.positionX=-15,this.minimizeButton.positionY=30,this.minimizeButton.width=40,this.minimizeButton.height=40,this.minimizeButton.isPointerBlocker=!0,this.minimizeButton.onClick=new OnClick((function(){R.minimizeUI(),engine.addSystem(new M(R.minimizeButton))})),(E=new UIText(this.uiMaximizedContainer)).value="Builder HUD",E.color=Color4.White(),E.hAlign="center",E.vAlign="bottom",E.paddingTop=0,E.paddingBottom=5,E.paddingLeft=15,E.fontSize=12,E.isPointerBlocker=!1,this.minimizeUI(),[2]}))}))},t.prototype.setSnaps=function(){switch(this.snap){case 0:this.snapPosScale=1,this.snapRot=90;break;case 1:this.snapPosScale=.1,this.snapRot=15;break;case 2:this.snapPosScale=.01,this.snapRot=5;break;case 3:this.snapPosScale=.001,this.snapRot=1}},t.prototype.applyModeAndSnapLabels=function(v){switch(this.mode){case this.modePOSITION:this.modeLabel.value="P";break;case this.modeROTATION:this.modeLabel.value="R";break;case this.modeSCALE:this.modeLabel.value="S";break;default:this.modeLabel.value="ERR"}switch(!v&&this.updateDisplayPRS(),this.snap){case 0:this.mode==this.modeROTATION?this.snapLabel.value="90":this.snapLabel.value="1";break;case 1:this.mode==this.modeROTATION?this.snapLabel.value="15":this.snapLabel.value="0.1";break;case 2:this.mode==this.modeROTATION?this.snapLabel.value="5":this.snapLabel.value="0.01";break;case 3:this.mode==this.modeROTATION?this.snapLabel.value="1":this.snapLabel.value="0.001";break;default:this.snapLabel.value="ERR"}},t.prototype.countDecimals=function(v){return Math.floor(v)===v?0:v.toString().split(".")[1].length||0},t.prototype.updateDisplayPRS=function(){switch(this.mode){case this.modePOSITION:this.displayPRS.value="POS: ("+this.entities[this.selectedEntityIndex].entity.getComponent(Transform).position.x.toFixed(this.countDecimals(this.snapPosScale))+","+this.entities[this.selectedEntityIndex].entity.getComponent(Transform).position.y.toFixed(this.countDecimals(this.snapPosScale))+","+this.entities[this.selectedEntityIndex].entity.getComponent(Transform).position.z.toFixed(this.countDecimals(this.snapPosScale))+")";break;case this.modeROTATION:this.displayPRS.value="ROT: ("+Math.ceil(this.entities[this.selectedEntityIndex].entity.getComponent(Transform).rotation.eulerAngles.x)+","+Math.ceil(this.entities[this.selectedEntityIndex].entity.getComponent(Transform).rotation.eulerAngles.y)+","+Math.ceil(this.entities[this.selectedEntityIndex].entity.getComponent(Transform).rotation.eulerAngles.z)+")";break;case this.modeSCALE:this.displayPRS.value="SCL: ("+this.entities[this.selectedEntityIndex].entity.getComponent(Transform).scale.x.toFixed(this.countDecimals(this.snapPosScale))+","+this.entities[this.selectedEntityIndex].entity.getComponent(Transform).scale.y.toFixed(this.countDecimals(this.snapPosScale))+","+this.entities[this.selectedEntityIndex].entity.getComponent(Transform).scale.z.toFixed(this.countDecimals(this.snapPosScale))+")"}},t.prototype.maximizeUI=function(){this.uiMinimizedContainer.visible=!1,this.uiMaximizedContainer.visible=!0,this.uiMaximized=!0,this.selectedEntityIndex>=0&&this.numEntities>0&&engine.addEntity(this.selectionPointer),this.mode=this.modePOSITION,this.applyModeAndSnapLabels(),this.displayName.value=this.entities[this.selectedEntityIndex].entity.name,this.updateDisplayPRS(),this.scaffolding.getComponent(Transform).scale=this.scaffoldScale},t.prototype.minimizeUI=function(){this.uiMaximizedContainer.visible=!1,this.uiMinimizedContainer.visible=!0,this.uiMaximized=!1,this.selectedEntityIndex>=0&&this.numEntities>0&&engine.removeEntity(this.selectionPointer),this.scaffolding.getComponent(Transform).scale=Vector3.Zero()},t.prototype.showUI=function(){this.canvas.visible=!0,this.canvas.isPointerBlocker=!0},t.prototype.hideUI=function(){this.canvas.visible=!1,this.canvas.isPointerBlocker=!1},t.prototype.updateSelectionPointerPOS=function(v){var S=v.position.clone();this.selectionPointer.getComponent(Transform).position=new Vector3(S.x,S.y+this.selectionPointerElevation,S.z)},t.prototype.selectEntity=function(v){this.selectedEntityIndex=v,null!=this.entities[v].entity&&(this.displayName.value=this.entities[this.selectedEntityIndex].entity.name,this.updateSelectionPointerPOS(this.entities[v].entity.getComponent(Transform)))},t.prototype.selectPrevious=function(){this.selectedEntityIndex>0&&this.selectEntity(this.selectedEntityIndex-1),this.updateDisplayPRS()},t.prototype.selectNext=function(){this.selectedEntityIndex<this.numEntities-1&&this.selectEntity(this.selectedEntityIndex+1),this.updateDisplayPRS()},t.prototype.discardSelected=function(){log("Discard Selected Entity isn't implemented at this time.")},t.prototype.toggleCameraOptions=function(){this.movingSystem.addCameraPosition(new Vector3(8,8,8)),log(this.movingSystem.positions),this.scaffolding.addComponent(new A("","fixed",0))},t.prototype.toggleColliders=function(v){584==this.toggleLift.sourceLeft?(this.toggleLift.sourceLeft=503,this.scaffloor.getComponent(Material).albedoColor=new Color4(.97,.27,.34),this.backWall.getComponent(Transform).scale=this.scaffoldScale,this.backWall.getComponent(Transform).position=new Vector3(-.6,1.5,0),this.frontWall.getComponent(Transform).scale=this.scaffoldScale,this.frontWall.getComponent(Transform).position=new Vector3(.6,1.5,0),this.leftWall.getComponent(Transform).scale=this.scaffoldScale,this.leftWall.getComponent(Transform).position=new Vector3(0,1.5,.6),this.rightWall.getComponent(Transform).scale=this.scaffoldScale,this.rightWall.getComponent(Transform).position=new Vector3(0,1.5,-.6)):(this.toggleLift.sourceLeft=584,this.backWall.getComponent(Transform).scale=Vector3.Zero(),this.frontWall.getComponent(Transform).scale=Vector3.Zero(),this.leftWall.getComponent(Transform).scale=Vector3.Zero(),this.rightWall.getComponent(Transform).scale=Vector3.Zero(),this.rightWall.getComponent(Transform).position=new Vector3(0,-41.5,-.6),this.backWall.getComponent(Transform).position=new Vector3(0,-4.5,-.6),this.frontWall.getComponent(Transform).position=new Vector3(0,-4.5,-.6),this.leftWall.getComponent(Transform).position=new Vector3(0,-4.5,-.6),this.scaffloor.getComponent(Material).albedoColor=Color4.White()),v&&(this.scaffolding.getComponent(Transform).position=new Vector3(1,.3,1))},t.prototype.moveScaffold=function(v){var S=this.scaffolding.getComponent(Transform);if(this.mode===this.modePOSITION)switch(S.position,v){case"a":this.scaffolding.hasComponent(A)?this.scaffolding.removeComponent(A):this.scaffolding.addComponent(new A("left","free"));break;case"s":this.scaffolding.hasComponent(A)?this.scaffolding.removeComponent(A):this.scaffolding.addComponent(new A("down","free"));break;case"d":this.scaffolding.hasComponent(A)?this.scaffolding.removeComponent(A):this.scaffolding.addComponent(new A("right","free"));break;case"q":this.scaffolding.hasComponent(A)?this.scaffolding.removeComponent(A):this.scaffolding.addComponent(new A("back","free"));break;case"w":this.scaffolding.hasComponent(A)?this.scaffolding.removeComponent(A):this.scaffolding.addComponent(new A("up","free"));break;case"e":this.scaffolding.hasComponent(A)?this.scaffolding.removeComponent(A):this.scaffolding.addComponent(new A("forward","free"))}},t.prototype.adjustTransform=function(v){this.unsavedContainer.visible=!0;var S=this.entities[this.selectedEntityIndex].entity.getComponent(Transform);switch(this.mode){case this.modePOSITION:var A=S.position;switch(v){case"a":A.x-=this.snapPosScale;break;case"s":A.y-=this.snapPosScale;break;case"d":A.x+=this.snapPosScale;break;case"q":A.z-=this.snapPosScale;break;case"w":A.y+=this.snapPosScale;break;case"e":A.z+=this.snapPosScale}this.updateSelectionPointerPOS(S);break;case this.modeROTATION:switch(v){case"a":S.rotate(Vector3.Left(),-this.snapRot);break;case"s":S.rotate(Vector3.Up(),this.snapRot);break;case"d":S.rotate(Vector3.Left(),this.snapRot);break;case"q":S.rotate(Vector3.Forward(),-this.snapRot);break;case"w":S.rotate(Vector3.Up(),-this.snapRot);break;case"e":S.rotate(Vector3.Forward(),this.snapRot)}break;case this.modeSCALE:var E=S.scale;switch(v){case"a":E.x-=this.snapPosScale;break;case"s":E.y-=this.snapPosScale;break;case"d":E.x+=this.snapPosScale;break;case"q":E.z-=this.snapPosScale;break;case"w":E.y+=this.snapPosScale;break;case"e":E.z+=this.snapPosScale}}this.updateDisplayPRS()},t.prototype.attachToEntity=function(v,S){return void 0===S&&(S=!0),e(this,void 0,void 0,(function(){return n(this,(function(A){return null==v?log("BuilderHUD attachToEntity called with a null entity"):B.isSetup&&(this.entities[this.numEntities]={entity:v,transform:v.getComponent(Transform),preexisting:S},S?(this.selectedEntityIndex=-1)&&this.selectEntity(0):this.selectEntity(this.numEntities),this.numEntities++),[2]}))}))},t.prototype.newEntity=function(){var v=Camera.instance,S=v.rotation.eulerAngles.y;S>=180?S-=180:S+=180;var A=0,E=0,R=0,O=1,z=1,B=1;if(null!=this.defaultParent){var M=this.defaultParent.getComponent(Transform);A=M.position.x,E=M.position.y,R=M.position.z,M.rotation.eulerAngles.x,M.rotation.eulerAngles.y,M.rotation.eulerAngles.z,O=M.scale.x,z=M.scale.y,B=M.scale.z}var V=new Transform({position:new Vector3((v.position.x-A)/O,(0-E)/z,(v.position.z-R)/B),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(this.newEntityScale/O,this.newEntityScale/z,this.newEntityScale/B)});V.rotate(Vector3.Up(),-S);var W=new Entity;if(W.name="Entity"+this.numEntities,W.addComponent(V),null==this.newEntityShape)try{this.newEntityShape=new GLTFShape("models/xyz/xyzLeftHand.glb")}catch(W){this.newEntityShape=new BoxShape,(new Material).albedoColor=Color3.Green()}W.addComponent(this.newEntityShape),null!=this.defaultParent&&W.setParent(this.defaultParent),engine.addEntity(W),this.attachToEntity(W,!1)},t.prototype.round=function(v){return Math.floor(1e3*(v+49e-5))/1e3},t.prototype.dump=function(){for(var v in this.unsavedContainer.visible=!1,log("--------------- BuilderHUD entities -------------"),this.entities){var S=null==this.entities[v].entity.name?"Existing":""+this.entities[v].entity.name,A=this.entities[v].transform,E=A.position,R=A.rotation.eulerAngles,O=A.scale,z="position: new Vector3("+this.round(E.x)+","+this.round(E.y)+","+this.round(E.z)+"), rotation: Quaternion.Euler("+this.round(R.x)+","+this.round(R.y)+","+this.round(R.z)+"), scale: new Vector3("+this.round(O.x)+","+this.round(O.y)+","+this.round(O.z)+")";log(S+" {"+z+"}")}log("-------------------------------------------------")},t.prototype.destroy=function(){for(var v in this.dump(),this.entities)this.entities[v].preexisting||(this.entities[v].entity.setParent(null),engine.removeEntity(this.entities[v].entity));this.entities=[],this.numEntities=0,this.refreshDisplay()},t.prototype.refreshDisplay=function(){},t}(),z=function(){function t(v){this.timer=4,this.entities=[],this.hud=v}return t.prototype.pendingEntity=function(v){this.entities.push(v)},t.prototype.update=function(v){if(this.timer>0)this.timer-=v;else{this.timer=4;for(var S=0;S<this.entities.length;S++)log("here"),this.hud.attachToEntity(this.entities[S],!0);this.entities=[]}},t}(),B=new O;B.pendingEntityAdd=new z(B),engine.addSystem(B.pendingEntityAdd);var M=function(){function t(v){this.timer=.1,this.uiIMage=v}return t.prototype.update=function(v){this.timer>0?(this.uiIMage.opacity-=.3,this.timer-=v):(this.timer=.1,this.uiIMage.opacity=1,engine.removeSystem(this))},t}();v.hud=B,Object.defineProperty(v,"__esModule",{value:!0})}));var __extends=this&&this.__extends||function(){var extendStatics=function(v,S){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,S){v.__proto__=S}||function(v,S){for(var A in S)Object.prototype.hasOwnProperty.call(S,A)&&(v[A]=S[A])},extendStatics(v,S)};return function(v,S){if("function"!=typeof S&&null!==S)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function __(){this.constructor=v}extendStatics(v,S),v.prototype=null===S?Object.create(S):(__.prototype=S.prototype,new __)}}();define("GameObjects/NPC",["require","exports","@dcl/ecs-scene-utils","@dcl/npc-scene-utils","@decentraland/RestrictedActions"],(function(v,S,A,E,R){Object.defineProperty(S,"__esModule",{value:!0}),S.createNPC=void 0,S.createNPC=function(v,S){void 0===S&&(S=new Vector3(8,0,4));var O=[{name:"greeting",text:"Heey! My name is Zoe. I am a fashion model in the Jomsy world!"},{name:"main menu",text:"Let me show you around a bit..",isQuestion:!0,buttons:[{label:"About",triggeredActions:function(){z.followPath({path:[S,new Vector3(10,0,8)],loop:!1,totalDuration:4,curve:!0,startingPoint:0,onFinishCallback:function(){var v=z.getComponent(Transform).rotation,S=Quaternion.Euler(0,180,0);z.addComponent(new A.RotateTransformComponent(v,S,1))}})},goToDialog:"follow me1"},{label:"Jomsy Book",goToDialog:"follow me2"},{label:"Visit Jomsy",triggeredActions:function(){openExternalURL("https://jomsyfashion.com/")},goToDialog:"main menu"},{label:"Creators of building",triggeredActions:function(){openExternalURL("https://www.digitalandarchitects.com/")},goToDialog:"main menu"}]},{name:"follow me1",text:"Follow me.."},{name:"history intro",text:"Let me tell you a bit about history of Jomsy...",isQuestion:!0,buttons:[{label:"Go on..",triggeredActions:function(){},goToDialog:"story1"}]},{name:"story1",text:"It all started more than 10 years ago in Los Angeles, California: the sunshine state, with the creation of JOMSY and its first branch: Jomsy Fashion."},{name:"story2",text:"Jomsy Fashion was nominated: innovative company of the year, by the Los Angeles Business Journal, for its contribution to young fashion designers without experience and training, thanks to a methodology that opens the doors to this particularly difficult industry.",triggeredByNext:function(){z.followPath({loop:!1,totalDuration:4,curve:!0,startingPoint:0,path:[new Vector3(10,0,8),S]})}},{name:"done1",text:"Do you want to give us a visit?",isQuestion:!0,buttons:[{label:"Sure!",triggeredActions:function(){openExternalURL("https://jomsyfashion.com/")},goToDialog:"main menu"},{label:"Later",triggeredActions:function(){},goToDialog:"main menu"}],isEndOfDialog:!0},{name:"follow me2",isQuestion:!0,buttons:[{label:"Teleport Me!",triggeredActions:function(){(0,R.movePlayerTo)({x:6,y:9,z:4},{x:5,y:7.9,z:1})},goToDialog:"main menu"}],text:"Jomsy book is finally ready! Go upstairs and check it out!",isEndOfDialog:!0}],z=new E.NPC({position:S,rotation:Quaternion.Euler(0,180,0),scale:new Vector3(1,1,1)},"src/resources/Model_animation character_009.glb",(function(){z.stopWalking(),z.talk(O)}),{idleAnim:"idle animation",walkingAnim:"walk animation",faceUser:!0,continueOnWalkAway:!1,reactDistance:4,textBubble:!1})}})),define("GameObjects/HideShow",["require","exports","@dcl/ecs-scene-utils"],(function(v,S,A){Object.defineProperty(S,"__esModule",{value:!0}),S.Video=S.ShowHideObjects=void 0;var E=!0;S.ShowHideObjects=function(v,S,R){var O=v.getComponent(GLTFShape);E&&(O.visible=!1,log("book is hide for the first time "),E=!1);var z=new A.TriggerBoxShape(R,S);v.addComponent(new A.TriggerComponent(z,{onCameraEnter:function(){O.visible=!0,log("book is visible")},onCameraExit:function(){O.visible=!1,log("book is invisible")}}))},S.Video=function(v,S){var E=new Vector3(1.5,1.5,8),R=new Vector3(15,7,19),O=new A.TriggerBoxShape(R,E);v.addComponent(new A.TriggerComponent(O,{onCameraEnter:function(){S.play()},onCameraExit:function(){S.pause()}}))}})),define("GameObjects/Book",["require","exports","GameObjects/HideShow"],(function(v,S,A){Object.defineProperty(S,"__esModule",{value:!0}),S.createBook=void 0,S.createBook=function(v,S){var E=this;void 0===S&&(S=new Vector3(1.1,8.7,6.5)),this.currentPage=0;var R=new Entity;engine.addEntity(R),R.setParent(v),this.animator=new Animator,R.addComponent(this.animator);for(var O=1;O<5;O++)this.animator.addClip(new AnimationState(O+"book anim opening",{looping:!1,layer:1,speed:1}));this.animator.addClip(new AnimationState("4book anim closing",{looping:!1,layer:1,speed:1}));var z=new Entity;z.addComponent(new Transform({position:new Vector3(-.9,0,0),scale:new Vector3(1.75,.5,2.5)}));var B=new BoxShape;B.withCollisions=!1,B.visible=!0,z.setParent(R),z.addComponent(B);var M=new Material;M.albedoColor=new Color4(1,1,1,0),z.addComponent(M),z.addComponent(new OnPointerDown((function(){E.turnPage()}))),R.addComponent(new Transform({position:S,scale:new Vector3(1,1,1),rotation:Quaternion.Euler(70,180,0)})),R.addComponent(new GLTFShape("src/resources/book animation_003.glb")),this.turnPage=function(){var v;3===this.currentPage?(v=this.animator.getClip("4book anim closing"),this.currentPage=0):(this.currentPage=this.currentPage+1,v=this.animator.getClip(this.currentPage+"book anim opening")),v.play()};var V=new Vector3(1.5,1.5,8),W=new Vector3(15,7,19);(0,A.ShowHideObjects)(R,V,W)}})),define("GameObjects/Panel",["require","exports","GameObjects/HideShow"],(function(v,S,A){Object.defineProperty(S,"__esModule",{value:!0}),S.createVideo=void 0,S.createVideo=function(v,S,E,R,O,z){void 0===S&&(S="src/resources/video.mp4"),void 0===E&&(E=new Vector3(7,10.6,-2.3)),void 0===R&&(R=Quaternion.Euler(0,-90,0)),void 0===O&&(O=!0),void 0===z&&(z=!1);var B=new VideoClip(S),M=new VideoTexture(B);M.loop=!0;var V=new Material;V.albedoTexture=M,V.roughness=1,V.specularIntensity=0,V.metallic=0;var W=new Entity;W.addComponent(new PlaneShape),W.addComponent(new Transform({position:E,rotation:R,scale:new Vector3(5,2.5,1)})),W.addComponent(V),W.setParent(v),(0,A.Video)(W,M)}})),define("GameObjects/NFTs",["require","exports","dcl-builder-hud"],(function(v,S,A){Object.defineProperty(S,"__esModule",{value:!0}),S.createNFT=void 0,S.createNFT=function(v,S,E,R){var O=new Entity,z=new NFTShape(S);O.addComponent(z),O.addComponent(new Transform({position:E,rotation:R,scale:new Vector3(6,6,1)})),engine.addEntity(O),O.addComponent(new OnPointerDown((function(v){openNFTDialog(S,"Jomsy Fashion NFT")}))),A.hud.attachToEntity(O)}})),define("game",["require","exports","GameObjects/NPC","GameObjects/Book","GameObjects/Panel","GameObjects/NFTs"],(function(v,S,A,E,R,O){Object.defineProperty(S,"__esModule",{value:!0});var z=new Entity("_scene");engine.addEntity(z);var B=new Transform({position:new Vector3(0,0,0),rotation:new Quaternion(0,0,0,1),scale:new Vector3(1,1,1)});z.addComponentOrReplace(B);var M=new Entity("jomsyfashion");engine.addEntity(M),M.setParent(z);var V=new Transform({position:new Vector3(8,0,8),rotation:Quaternion.Euler(0,180,0),scale:new Vector3(1,1,1)});M.addComponentOrReplace(V);var W=new GLTFShape("src/resources/jomsyfashion_building_009.glb");W.withCollisions=!0,W.isPointerBlocker=!0,M.addComponentOrReplace(W),W.visible=!0;var H=new Entity;engine.addEntity(H),H.addComponent(new CylinderShape);var X=new Transform({position:new Vector3(14.25,.5,14.5),rotation:new Quaternion(0,0,0,1),scale:new Vector3(.8,.5,.8)});H.addComponent(X),H.getComponent(CylinderShape).visible=!0;var Q=new Color4(0,0,0,0),Z=new Material;Z.albedoColor=Q,H.addComponent(Z),H.addComponent(new OnPointerDown((function(){openExternalURL("https://www.digitalandarchitects.com/")})));var J=new Entity;engine.addEntity(J),J.addComponent(new BoxShape);var K=new Transform({position:new Vector3(10.65,3.2,11.5),rotation:new Quaternion(0,0,0,1),scale:new Vector3(2,2,.5)});J.addComponent(K),J.getComponent(BoxShape).visible=!0,J.addComponent(Z),J.addComponent(new OnPointerDown((function(){openExternalURL("https://jomsy.com/")})));var $=new Entity;$.addComponent(new BoxShape);var et=new Transform({position:new Vector3(8,1.5,8),rotation:new Quaternion(0,0,0,1),scale:new Vector3(3,1,.5)});$.addComponent(et),$.getComponent(BoxShape).visible=!0,$.addComponent(Z),$.addComponent(new OnPointerDown((function(){openExternalURL("https://jomsy.com/")})));var nt=new Entity;nt.addComponent(new BoxShape);var it=new Transform({position:new Vector3(8.75,2,4.7),rotation:new Quaternion(0,0,0,1),scale:new Vector3(4.5,5,.5)});nt.addComponent(it),nt.getComponent(BoxShape).visible=!0,nt.addComponent(Z),nt.addComponent(new OnPointerDown((function(){openExternalURL("https://jomsy.com/")}))),new E.createBook(M),new R.createVideo(M),(0,A.createNPC)(z);var ot=new Entity;engine.addEntity(ot),ot.addComponent(new BoxShape);var rt=new Transform({position:new Vector3(4.5,9,1),scale:new Vector3(1,1,1)});ot.addComponent(rt),ot.getComponent(BoxShape).visible=!0,ot.addComponent(Z),ot.addComponent(new OnPointerDown((function(){openExternalURL("https://ebook.fashiondesignentrepreneurshipcourse.com")}),{hoverText:"Buy the Book here!"}));var st=new Entity;engine.addEntity(st);var at=new Transform({position:new Vector3(5.6,7,7),rotation:Quaternion.Euler(0,0,0),scale:new Vector3(.8,.5,.8)});st.addComponent(at),st.addComponent(new GLTFShape("src/resources/Roof_living.glb"));var ht=new Entity;engine.addEntity(ht);var lt=new Transform({position:new Vector3(7.1,7,7),rotation:Quaternion.Euler(0,180,0),scale:new Vector3(.8,.5,.8)});ht.addComponent(lt),ht.addComponent(new GLTFShape("src/resources/Roof_living.glb")),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507732384874496001",new Vector3(2.3,2.8,6.3),Quaternion.Euler(360,270,360)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507731285362868225",new Vector3(2.3,2.8,11.6),Quaternion.Euler(360,270,360)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507733484386123777",new Vector3(4.8,2.8,2.3),Quaternion.Euler(360,180,0)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507734583897751553",new Vector3(11.1,2.8,2.3),Quaternion.Euler(360,180,0)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507723588781473793",new Vector3(5.7,10.7,15.5),Quaternion.Euler(0,360,360)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507722489269846017",new Vector3(10.7,10.7,15.5),Quaternion.Euler(0,360,360)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507720290246590465",new Vector3(11.2,11.7,.29),Quaternion.Euler(360,180,0)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507721389758218241",new Vector3(4.4,11.7,.29),Quaternion.Euler(360,180,0)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507734583897751553",new Vector3(15.4,17,12.8),Quaternion.Euler(0,90,0)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507735683409379329",new Vector3(15.4,17,8),Quaternion.Euler(0,90,0)),(0,O.createNFT)(M,"ethereum://0x495f947276749ce646f68ac8c248420045cb7b5e/70792207985028855681838444929965013283356645235908534210838507733484386123777",new Vector3(15.4,17,3.2),Quaternion.Euler(0,90,0))})),define("Prefabs/Button",["require","exports"],(function(v,S){Object.defineProperty(S,"__esModule",{value:!0}),S.Button=void 0;var A=function(v){function Button(S,A,E){void 0===E&&(E=new Vector3(0,0,0));var R=v.call(this)||this,O=R;return O.addComponent(new ConeShape),R.transform0=new Transform({position:new Vector3(E.x,E.y,E.z),rotation:Quaternion.Euler(40,0,0),scale:new Vector3(.01,.3,.3)}),O.addComponent(R.transform0),O.addComponent(new OnPointerDown((function(v){S.goToNextPage()}))),R}return __extends(Button,v),Button.prototype.add=function(v){this.setParent(v)},Button}(Entity);S.Button=A}));